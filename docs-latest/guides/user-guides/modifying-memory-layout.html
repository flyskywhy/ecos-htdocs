<HTML
><HEAD
><TITLE
>Modifying the memory
layout</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.33"><LINK
REL="HOME"
TITLE="eCos Users
Guide"
HREF="user-guides.html"><LINK
REL="UP"
TITLE="Manual configuration"
HREF="manual-configuration.html"><LINK
REL="PREVIOUS"
TITLE="Editing the sources"
HREF="editing-the-sources.html"><LINK
REL="NEXT"
TITLE="Managing the package repository"
HREF="managing-the-package-repository.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
><SPAN
CLASS="TRADEMARK"
>eCos</SPAN
><SUP
><FONT
SIZE="-4"
>TM</FONT
></SUP
> User&#8217;s
Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="editing-the-sources.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 7. Manual configuration</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="managing-the-package-repository.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="MODIFYING-MEMORY-LAYOUT"
>Modifying the memory
layout</A
></H1
><P
>Each <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> platform package is supplied
with linker script fragments which describe the location of memory
regions on the evaluation board and the location of memory sections
within these regions. The correct linker script fragment for a particular combination
of target architecture, platform and start-up type is selected by <B
CLASS="COMMAND"
>pkgconf.tcl</B
> and
is included in the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> linker script <TT
CLASS="FILENAME"
>target.ld</TT
> when <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> is
built.</P
><P
>It is not necessary to modify
the default memory layouts in order to start development with 
<SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
>. However, it will be necessary to
edit a linker script fragment when the memory map of the evaluation
board is changed. For example, if additional memory is added, the
linker must be notified that the new memory is available for use.
As a minimum, this would involve modifying the length of the corresponding
memory region. Where the available memory is non-contiguous, it
may be necessary to declare a new memory region and reassign certain
linker output sections to the new region.</P
><P
>Linker script fragments should be edited
within the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> build tree. They are
located at <TT
CLASS="FILENAME"
>pkgconf/*.ldi</TT
>.
For example, the fragment for ROM start-up is located at <TT
CLASS="FILENAME"
>pkgconf/rom.ldi</TT
>.
Where multiple start-up types are in use, it will be necessary to edit
multiple linker script fragments. A typical fragment is shown below:</P
><DIV
CLASS="EXAMPLE"
><P
><B
>Example 7-1. eCos
linker script fragment</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>MEMORY
{
 rom : ORIGIN = 0x40000000, LENGTH = 0x80000
 ram : ORIGIN = 0x48000000, LENGTH = 0x200000
}

SECTIONS
{
 SECTIONS_BEGIN
 SECTION_rom_vectors (rom, 0x40000000, LMA_EQ_VMA)
 SECTION_text (rom, ALIGN (0x1), LMA_EQ_VMA)
 SECTION_fini (rom, ALIGN (0x1), LMA_EQ_VMA)
 SECTION_rodata (rom, ALIGN (0x1), LMA_EQ_VMA)
 SECTION_rodata1 (rom, ALIGN (0x1), LMA_EQ_VMA)
 SECTION_fixup (rom, ALIGN (0x1), LMA_EQ_VMA)
 SECTION_gcc_except_table (rom, ALIGN (0x1), LMA_EQ_VMA)
 SECTION_data (ram, 0x48000000, FOLLOWING (.gcc_except_table))
 SECTION_bss (ram, ALIGN (0x4), LMA_EQ_VMA)
 SECTIONS_END
}</PRE
></TD
></TR
></TABLE
></DIV
><P
>The file consists of two blocks, the <TT
CLASS="CLASSNAME"
>MEMORY</TT
> block
contains lines describing the address (<TT
CLASS="CLASSNAME"
>ORIGIN</TT
>)
and the size (<TT
CLASS="CLASSNAME"
>LENGTH</TT
>) of each memory region.
The <TT
CLASS="CLASSNAME"
>MEMORY</TT
> block is followed by the <TT
CLASS="CLASSNAME"
>SECTIONS</TT
> block
which contains lines describing each of the linker output sections.
Each section is represented by a macro call. The arguments of these
macros are ordered as follows: <P
></P
><OL
TYPE="1"
><LI
><P
>The
memory region in which the section will finally reside.</P
></LI
><LI
><P
>The final address (<TT
CLASS="CLASSNAME"
>VMA</TT
>) of
the section. This is expressed using one of the following forms:</P
><P
></P
><DL
><DT
><I
CLASS="EMPHASIS"
>n</I
></DT
><DD
><P
>at the absolute address specified by the unsigned integer <I
CLASS="EMPHASIS"
>n</I
></P
></DD
><DT
>ALIGN (<I
CLASS="EMPHASIS"
>n</I
>)</DT
><DD
><P
>following the final location of the previous section with alignment to the next <I
CLASS="EMPHASIS"
>n</I
>-byte boundary</P
></DD
></DL
></LI
><LI
><P
>The initial address (<TT
CLASS="CLASSNAME"
>LMA</TT
>)
of the section. This is expressed using one of the following forms:</P
><P
></P
><DL
><DT
>LMA_EQ_VMA</DT
><DD
><P
>the <TT
CLASS="CLASSNAME"
>LMA</TT
> equals the <TT
CLASS="CLASSNAME"
>VMA</TT
> (no
relocation)</P
></DD
><DT
>AT (<I
CLASS="EMPHASIS"
>n</I
>)</DT
><DD
><P
>at the absolute address specified by the unsigned
integer <I
CLASS="EMPHASIS"
>n</I
></P
></DD
><DT
>FOLLOWING (.<I
CLASS="EMPHASIS"
>name</I
>)</DT
><DD
><P
>following the initial location of section <I
CLASS="EMPHASIS"
>name</I
></P
></DD
></DL
></LI
></OL
> </P
><P
>In order to maintain compatibility with linker script fragments
exported by the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> <SPAN
CLASS="APPLICATION"
>Configuration
Tool</SPAN
>, the use of other expressions within linker script
fragments is not recommended.</P
><P
>Note that the names of the linker output sections will vary
between target architectures. A description of these sections can
be found in the specific <I
CLASS="CITETITLE"
>GNUPro Toolkit Reference manual</I
> for
your architecture.</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="editing-the-sources.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="user-guides.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="managing-the-package-repository.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Editing the sources</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="manual-configuration.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Managing the package repository</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>