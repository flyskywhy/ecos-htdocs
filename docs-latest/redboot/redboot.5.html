<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD><!--version 1.2/Mon Mar  5 17:23:09  2001--><!--version 1.2/Mon Mar  5 17:21:56  2001-->
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<LINK REL="STYLESHEET" HREF="cygnus.css">
<TITLE> Rebuilding RedBoot</TITLE></HEAD>
<BODY BGCOLOR="#ffffff">
<DIV>
<TABLE STYLE="ECOS" WIDTH="98%" BORDER="0" ALIGN="LEFT" CELLPADDING="1"><TR><TH COLSPAN="3" ALIGN="center"><P CLASS="Gotos">Rebuilding RedBoot</P></TH></TR><TR><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.html">Contents</A></P></TD><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.4.html">To&nbsp;previous&nbsp;page</A></P></TD><TD ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.6.html">To&nbsp;next&nbsp;page</A></P></TD></TR></TABLE><P ALIGN="LEFT">&nbsp;</P><BR><BR><HR ALIGN="center"></DIV>
<H2 CLASS="ChapterTitle">
<A NAME="pgfId=2639328">
 </A>
<A NAME="marker=2655571">
 </A>
Rebuilding RedBoot<DIV>
<IMG SRC="botclear.gif">
</DIV>
</H2>
<P CLASS="Body">
<A NAME="pgfId=2654407">
 </A>
In normal circumstances it is only necessary to rebuild RedBoot if it has been modified, for example if you have extended the command set or applied patches. See the <EM CLASS="Emphasis">
Getting Started with eCos</EM>
 document, which provides information about the portability and extendability of RedBoot in an eCos environment.</P>
<P CLASS="Body">
<A NAME="pgfId=2656004">
 </A>
Some platform HALs provide configuration export files. Before proceding with the following procedures, check <A HREF="redboot.5.html#35348" CLASS="XRef">
 Configuration export files</A>
 first, which may simplify the process for your platform.</P>
<P CLASS="Body">
<A NAME="pgfId=2655918">
 </A>
RedBoot is configured and built using configuration technology based on Configuration Description Language (CDL). The simplest version of RedBoot can be built by typing: </P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2655919"> </A>
ecosconfig new PLATFORM redboot  
ecosconfig tree   
make </PRE>
<P CLASS="Body">
<A NAME="pgfId=2655920">
 </A>
where <TT CLASS="Code">
PLATFORM</TT>
 is the eCos name for the desired platform, for example <TT CLASS="Code">
assabet</TT>
. This command sequence will build the simplest version of RedBoot possible, not including any networking nor FLASH support (since these are very target specific).  To include these in the example, type:   </P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2655921"> </A>
ecosconfig new PLATFORM redboot  
ecosconfig add flash 
ecosconfig add pcmcia net_drivers cf_eth_drivers  
ecosconfig tree  
make</PRE>
<P CLASS="Body">
<A NAME="pgfId=2655922">
 </A>
This set of commands will build a version of RedBoot suitable for testing. In particular, the result will run from RAM.  Since RedBoot needs to be installed in ROM/FLASH, type the following:</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2655923"> </A>
cat &gt;RedBoot_ROM.cfg &lt;&lt;EOF  
cdl_component CYG_HAL_STARTUP {
       user_value ROM  
};  
EOF  
ecosconfig import RedBoot_ROM.cfg  
ecosconfig tree  
make</PRE>
<P CLASS="Body">
<A NAME="pgfId=2655924">
 </A>
This set of commands will adjust the configuration to be ROM oriented.</P>
<P CLASS="Body">
<A NAME="pgfId=2655925">
 </A>
Each of these command sequences creates multiple versions of RedBoot in different file formats.  The choice of which file to use will depend upon the actual target hardware and the tools available for programming ROM/FLASH. The files produced (typically) are:</P>
<P CLASS="BodyHang1">
<A NAME="pgfId=2655926">
 </A>
<TT CLASS="Code">
install/bin/redboot.elf </TT>
This is the complete version of RedBoot, represented in ELF format.  It is most useful for testing with tools such as embedded ICE, or other debug tools.</P>
<P CLASS="BodyHang1">
<A NAME="pgfId=2655927">
 </A>
<TT CLASS="Code">
install/bin/redboot.srec </TT>
This version has been converted to Motorola S-record format.</P>
<P CLASS="BodyHang1">
<A NAME="pgfId=2655928">
 </A>
<TT CLASS="Code">
install/bin/redboot.bin </TT>
This version has been flattened; that is, all formatting information removed and just the raw image which needs to be placed in ROM/FLASH remains.</P>
<P CLASS="Body">
<A NAME="pgfId=2655929">
 </A>
The details of putting the RedBoot code into ROM/FLASH are target specific.  Once complete, the system should come up with the RedBoot prompt.  For example, the version built using the commands above looks like:</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2655930"> </A>
RedBoot(tm) debug environment - built 07:54:25, Oct 16 2000 
Platform: Assabet development system (StrongARM 1110)  
Copyright (C) 2000, Red Hat, Inc.
RAM: 0x00000000-0x02000000  
FLASH: 0x50000000 - 0x50400000, 32 blocks of 0x00020000 bytes ea.  
Socket Communications, Inc: Low Power Ethernet CF Revision C 5V/3.3V 08/27/98  
IP: 192.168.1.29, Default server: 192.168.1.101  
RedBoot&gt; </PRE>
<H4 CLASS="Heading3">
<A NAME="pgfId=2653867">
 </A>
<A NAME="35348">
 </A>
Configuration export files</H4>
<P CLASS="Body">
<A NAME="pgfId=2656010">
 </A>
To help with rebuilding RedBoot from source, some platforms HALs provide configuration export files.  First locate the configuration export files for your platform in the eCos source repository. The RAM and ROM startup configuration exports can usually be found in a directory named &quot;misc&quot; in the platform HAL in the eCos source repository, named either:</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656015"> </A>
2164 Nov 29 14:59 misc/redboot_RAM.cfg
2221 Nov 29 14:59 misc/redboot_ROM.cfg</PRE>
<P CLASS="Body">
<A NAME="pgfId=2656017">
 </A>
   or</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656018"> </A>
1432 Feb  1 13:27 misc/redboot_RAM.ecm
1487 Feb  1 14:38 misc/redboot_ROM.ecm
</PRE>
<P CLASS="Body">
<A NAME="pgfId=2656098">
 </A>
Having located these files, copy them to /tmp or some other directory, to save typing.</P>
<P CLASS="Body">
<A NAME="pgfId=2656021">
 </A>
(All dates and sizes are just examples.)</P>
<P CLASS="Body">
<A NAME="pgfId=2656022">
 </A>
To make RedBoot for RAM startup:</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656024"> </A>
mkdir redboot.RAM</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656025"> </A>
cd redboot.RAM</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656026"> </A>
ecosconfig new TARGET redboot</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656027"> </A>
ecosconfig import /tmp/redboot_RAM.ecm</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656028"> </A>
ecosconfig tree</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656029"> </A>
make</PRE>
<P CLASS="Body">
<A NAME="pgfId=2656030">
 </A>
To build the ROM version, in a different build/config directory, just use the config export redboot_ROM.ecm (or .cfg) instead.</P>
<P CLASS="Body">
<A NAME="pgfId=2656033">
 </A>
The resulting files will be, in each of the ROM and RAM startup build places:</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656036"> </A>
70456     ..../install/bin/redboot.bin</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656037"> </A>
433104     ..../install/bin/redboot.elf</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656038"> </A>
91407     ..../install/bin/redboot.img</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2656039"> </A>
194732     ..../install/bin/redboot.srec</PRE>
<P CLASS="Body">
<A NAME="pgfId=2656040">
 </A>
The .elf and .srec files have the obvious relationship to those supplied in the &quot;loaders/PLATFORM&quot; directory in the install.</P>
<P CLASS="Body">
<A NAME="pgfId=2656057">
 </A>
</P>
<TABLE>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
</TD>
</TR>
</TABLE>
<HR ALIGN="center"><TABLE STYLE="ECOS" WIDTH="98%" BORDER="0" ALIGN="LEFT" CELLPADDING="1"><TR><TH COLSPAN="3" ALIGN="center"><P CLASS="Gotos">Rebuilding RedBoot</P></TH></TR><TR><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.html">Contents</A></P></TD><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.4.html">To&nbsp;previous&nbsp;page</A></P></TD><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.6.html">To&nbsp;next&nbsp;page</A></P></TD></TR></TABLE></BODY>
</HTML>
