<!-- Copyright (C) 2001 Red Hat, Inc.                                -->
<!-- This material may be distributed only subject to the terms      -->
<!-- and conditions set forth in the Open Publication License, v1.0  -->
<!-- or later (the latest version is presently available at          -->
<!-- http://www.opencontent.org/openpub/).                           -->
<!-- Distribution of substantively modified versions of this         -->
<!-- document is prohibited without the explicit permission of the   -->
<!-- copyright holder.                                               -->
<!-- Distribution of the work or derivative of the work in any       -->
<!-- standard (paper) book form is prohibited unless prior           -->
<!-- permission is obtained from the copyright holder.               -->
<HTML
><HEAD
><TITLE
>Atmel AT91 Evaluation Board (EB40)</TITLE
><meta name="MSSmartTagsPreventParsing" content="TRUE">
<META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"><LINK
REL="HOME"
TITLE="RedBoot&#8482; User's Guide"
HREF="redboot.html"><LINK
REL="UP"
TITLE="Installation and Testing"
HREF="installation-and-testing.html"><LINK
REL="PREVIOUS"
TITLE="x86 Based PC"
HREF="x86pc.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>RedBoot&#8482; User's Guide: Document Version 1.5m, July 2001</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x86pc.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Installation and Testing</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
>&nbsp;</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AT91"
>Atmel AT91 Evaluation Board (EB40)</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2040"
>Overview</A
></H2
><P
>RedBoot supports
both serial ports. The default serial port settings are 38400,8,N,1. RedBoot
also supports minimal flash management on the EB40.  However, since the flash
device (AT29LV1024) is so small (only the upper 64K is available for general
use), only 'fconfig' is supported, along with the simple flash write command,
'fis write'. Two basic RedBoot configurations are supported: <P
></P
><UL
><LI
><P
>RedBoot running from RAM, but contained in the board's flash
boot sector (ROMRAM mode).</P
></LI
><LI
><P
>RedBoot running from RAM with RedBoot in the flash boot sector.</P
></LI
></UL
> The RAM version is only used during the initialization of
RedBoot the first time.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2054"
>Initial Installation Method</A
></H2
><P
>This development board comes with ARM's debug tool, Angel, installed
in flash. At this time, Angel will not be replaced.  Rather, RedBoot will
be placed in the alternate half of flash.  Switch SW1 is used which monitor
to boot.  Selecting SW1 to "lower mem" will choose Angel.  Select SW1 to "Upper
mem" for RedBoot once it has been installed.</P
><P
>Set SW1 to "lower mem" and connect serial port A to a host computer.
 Using GDB from the host and Angel on the board, download the RAM based version
of RedBoot to the board.  Once this is started, the Angel session must be
interrupted (on Linux this can be done using ^Z).  Follow this by connecting
to the board using minicom at 38400-8N1.  At this point, RedBoot will be running
on the board in RAM.  Now, download the ROMRAM version and program it to flash.
 Be sure and first set SW1 to "upper mem". <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>arm-elf-gdb redboot_RAM.elf
(gdb) tar rdi s=/dev/ttyS0
Angel Debug Monitor (serial) 1.04 (Advanced RISC Machines SDT 2.5) for AT91EB40 (2.00)
Angel Debug Monitor rebuilt on Apr 07 2000 at 12:40:31
Serial Rate:   9600
Connected to ARM RDI target.
(gdb) set $ps=0xd3
(gdb) lo
Loading section .rom_vectors, size 0x40 lma 0x2020000
Loading section .text, size 0x7fd8 lma 0x2020040
Loading section .rodata, size 0x15a0 lma 0x2028018
Loading section .data, size 0x2e4 lma 0x20295b8
Start address 0x2020040 , load size 39068
Transfer rate: 6250 bits/sec, 500 bytes/write.
(gdb) c
Continuing.</PRE
></TD
></TR
></TABLE
> At this point, interrupt the Angel session and
start minicom. <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>RedBoot&#62; ve

RedBoot(tm) bootstrap and debug environment, version UNKNOWN - built 14:09:27, Jul 20 2001

Platform: Atmel AT91/EB40 (ARM7TDMI) 
Copyright (C) 2000, 2001, Red Hat, Inc.

RAM: 0x02000000-0x02080000, 0x020116d8-0x0207fd00 available
FLASH: 0x01010000 - 0x01020000, 256 blocks of 0x00000100 bytes each.

RedBoot&#62; load -b 0x02040000</PRE
></TD
></TR
></TABLE
> Use minicom to send the file
redboot_ROMRAM.srec. <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>RedBoot&#62; fi wr -f 0x01010000 -b 0x02040000 -l 0xe000</PRE
></TD
></TR
></TABLE
> Press the "reset" pushbutton and RedBoot should come up
on the board.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2061"
>Flash management</A
></H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN2063"
>Updating the RedBoot image in flash</A
></H3
><P
>Since the primary RedBoot runs from RAM, it can be used to update itself
directly. Simply follow the steps above, starting with a connection to RedBoot
running on the board.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2066"
>Special RedBoot Commands</A
></H2
><P
>None.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2069"
>Memory Maps</A
></H2
><P
>This processor has no MMU, so the only memory map is for physical addresses. <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>Physical Address Range     Description 
-----------------------    ---------------------------------- 
0x00000000 - 0x00000fff    On-chip SRAM
0x01000000 - 0x0101ffff    Flash
0x02000000 - 0x0207ffff    RAM
0xffe00000 - 0xffffffff    I/O registers

The flash based RedBoot image occupies virtual addresses 0x01010000 - 0x0101dfff</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2073"
>Resource Usage</A
></H2
><P
>The RAM based RedBoot image occupies RAM addresses 0x02020000 - 0x0203ffff.
RAM addresses from 0x02040000 to the end of RAM are available for general
use such as a temporary scratchpad for downloaded images before they are written
to flash. </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2076"
>Rebuilding RedBoot</A
></H2
><P
>The instructions in <A
HREF="rebuilding-redboot.html"
>Chapter 3</A
> should be followed.
The values for PLATFORM_DIR on this platform is &#8220;at91&#8221;. The value
for TARGET is &#8220;eb40&#8221;. Note that the configuration export files
supplied in the <TT
CLASS="COMPUTEROUTPUT"
>hal/arm/at91/<TT
CLASS="REPLACEABLE"
><I
>VERSION</I
></TT
>/misc</TT
> directory in the RedBoot source tree should be used. The
ROMRAM configuration should be used to build the RedBoot image to be programmed
into flash.  The RAM configuration is used for the initial download of RedBoot.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x86pc.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="redboot.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>&nbsp;</TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>x86 Based PC</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="installation-and-testing.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>&nbsp;</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>