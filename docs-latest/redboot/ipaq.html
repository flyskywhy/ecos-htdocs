<!-- Copyright (C) 2001 Red Hat, Inc.                                -->
<!-- This material may be distributed only subject to the terms      -->
<!-- and conditions set forth in the Open Publication License, v1.0  -->
<!-- or later (the latest version is presently available at          -->
<!-- http://www.opencontent.org/openpub/)                            -->
<!-- Distribution of substantively modified versions of this         -->
<!-- document is prohibited without the explicit permission of the   -->
<!-- copyright holder.                                               -->
<!-- Distribution of the work or derivative of the work in any       -->
<!-- standard (paper) book form is prohibited unless prior           -->
<!-- permission obtained from the copyright holder                   -->
<HTML
><HEAD
><TITLE
>Compaq iPAQ PocketPC</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"><LINK
REL="HOME"
TITLE="RedBoot&#8482; User's Guide"
HREF="redboot.html"><LINK
REL="UP"
TITLE="Installation and Testing"
HREF="installation_and_testing.html"><LINK
REL="PREVIOUS"
TITLE="ARM ARM7 PID, Dev7 and Dev9"
HREF="pid.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>RedBoot&#8482; User's Guide: Document Version 1.3, April 2001</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="pid.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Installation and Testing</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
>&nbsp;</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="IPAQ"
>Compaq iPAQ PocketPC</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1342"
>Overview</A
></H2
><P
>RedBoot supports the serial port via cradle or cable, and Compact Flash
ethernet cards if fitted for communication and downloads. The LCD touchscreen
may also be used for the console, although by default RedBoot will switch
exclusively to one channel once input arrives. </P
><P
>The default serial port settings are 38400,8,N,1. RedBoot runs from
and supports flash management for the system flash region. </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1346"
>Initial Installation</A
></H2
><P
>Prebuilt images for the OSloader, redboot_Compaq.bin, redboot_ROM.bin
and redboot_WinCE.bin images mentioned in the instructions below are provided.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1349"
>Installing RedBoot on the iPAQ using Windows/CE</A
></H3
><P
>The first step in installing RedBoot on the iPAQ actually involves Windows/CE,
since that is the native environment on the unit.  Using WinCE, you need to
install an application which will run a RAM based version of RedBoot. Once
this is installed and running, RedBoot can be used to update the flash with
a native/ROM version of RedBoot.       <P
></P
><UL
><LI
><P
>Using ActiveSync, copy the file OSloader to your iPAQ. </P
></LI
><LI
><P
>Using ActiveSync, copy the file redboot_WinCE.bin to the iPAQ
as bootldr in it's root directory.  Note: this is not the top level folder
displayed by Windows (Mobile Device), but rather the 'My Pocket PC' folder
within it.</P
></LI
><LI
><P
>Execute OSloader.  If you didn't create a shortcut, then you
will have to poke around for it using the WinCE file explorer.</P
></LI
><LI
><P
>Choose the <SPAN
CLASS="GUIMENUITEM"
>Tools-&#62;BootLdr-&#62;Run after loading
from file</SPAN
> menu item.   </P
></LI
></UL
>At this point, the RAM based version of RedBoot should be running.
 You should be able to return to this point by just executing the last two
steps of the previous process if necessary.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1362"
>Installing RedBoot on the iPAQ - using the Compaq boot loader</A
></H3
><P
>If you already have the Compaq boot loader installed on the iPAQ, then
you can install RedBoot this way.        <P
></P
><UL
><LI
><P
>Install RedBoot to the flash, using the command:         
      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>boot&#62; load flash 0x40000</PRE
></TD
></TR
></TABLE
>       </P
></LI
><LI
><P
>Send the file redboot_Compaq.bin using xmodem            
   <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>Bytes Sent: 168320   BPS:2771
Transfer complete                      
                 lash...erasing ...             
Erasing sector 00040000             
writing flash..             
addr: 00040000 data: EA00000E             
addr: 00050000 data: E5953054             
addr: 00060000 data: 2B2B2B2E             
verifying ... done.             
boot&#62;</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>Execute RedBoot                <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>boot&#62; jump 0x4000</PRE
></TD
></TR
></TABLE
></P
></LI
></UL
>Note: sometimes it has been necessary to reset the iPAQ before
issuing the 'jump' command.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="IPAQ_INSTALL_RB_PERMANENTLY"
>Setting up and testing RedBoot</A
></H3
><P
>When RedBoot first comes up, it will want to initialize its LCD touch
screen parameters. It does this by displaying a keyboard graphic and asks
you to press certain keys.  Using the stylus, press and hold until the prompt
is withdrawn. When you lift the stylus, RedBoot will continue with the next
calibration.    </P
><P
>Once the LCD touchscreen has been calibrated, RedBoot will start. The
calibration step can be skipped by pressing the <SPAN
CLASS="GUIBUTTON"
>return/abort</SPAN
>
button on the unit (right most button with a curved arrow icon). Additionally,
the unit will assume default values if the screen is not touched within about
15 seconds.   </P
><P
>Once RedBoot has started, you should get information similar to this
on the LCD screen.  It will also appear on the serial port at 38400,8,N,1.
         <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>RedBoot(tm) bootstrap and debug environment - built 06:17:41, Mar 19 2001       
Platform: Compaq iPAQ Pocket PC (StrongARM 1110)         

Copyright (C) 2000, 2001, Red Hat, Inc.         

RAM: 0x00000000-0x01fc0000, 0x00022400-0x01f70000 available       
FLASH: 0x50000000 - 0x51000000, 64 blocks of 0x00040000 bytes each.</PRE
></TD
></TR
></TABLE
>Since
the LCD touchscreen is only 30 characters wide, some of this data will be
off the right hand side of the display. The joypad may be used to pan left
and right in order to see the full lines.   </P
><P
>If you have a Compact Flash ethernet card, RedBoot should find it. 
You'll need to have BOOTP enabled for this unit (see your sysadmin for details).
 If it does, it will print a message like:         <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>... Waiting for network card: .Ready!       
Socket Communications Inc: CF+ LPE Revision E 08/04/99       
IP: 192.168.1.34, Default server: 192.168.1.101</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1384"
>ipaq_install_rb_permanently. Installing RedBoot permanently</A
></H3
><P
>Once you are satisfied with the setup and that RedBoot is operating
properly in your environment, you can set up your iPAQ unit to have RedBoot
be the bootstrap application.    <DIV
CLASS="CAUTION"
><P
></P
><TABLE
CLASS="CAUTION"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>CAUTION</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>This step will destroy your Windows/CE environment.</P
><P
>Before you take this step, you might want to save your WinCE FLASH contents.
This can  be done using the Compaq OSloader:     <P
></P
><UL
><LI
><P
>Using OSloader on the iPAQ, select the <SPAN
CLASS="GUIMENUITEM"
>Tools-&#62;Flash-&#62;Save
to files...</SPAN
>.  menu item.</P
></LI
><LI
><P
>Four (4) files, 4MB each in size will be created.</P
></LI
><LI
><P
>After each file is created, copy the file to your computer,
then delete the file from the iPAQ to make room in the WinCE ramdisk for the
next file.</P
></LI
></UL
></P
></TD
></TR
></TABLE
></DIV
>You will need to download the version of RedBoot designed as the
ROM bootstrap. Then install it permanently  using these commands:        
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>RedBoot&#62; lo -r -b 0x100000 /tftpboot/redboot_ROM.bin       
RedBoot&#62; fi unl -f 0x50000000 -l 0x40000       
RedBoot&#62; fis init       
RedBoot&#62; fi cr RedBoot -b 0x100000       
RedBoot&#62; fi loc -f 0x50000000 -l 0x40000       
RedBoot&#62; reboot</PRE
></TD
></TR
></TABLE
>   <DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>WARNING</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
></TD
></TR
></TABLE
></DIV
>You must type these commands exactly! Failure to do so may render
your iPAQ totally useless. Once you've done this, RedBoot should come up every
time you reset.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1402"
>Restoring Windows/CE</A
></H3
><P
>To restore Windows/CE from the backup taking in <A
HREF="ipaq.html#IPAQ_INSTALL_RB_PERMANENTLY"
>the section called <I
>Setting up and testing RedBoot</I
></A
>,
visit http://www.handhelds.org/projects/wincerestoration.html for directions.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1406"
>Flash Management</A
></H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1408"
>Additional config options</A
></H3
><P
>The <TT
CLASS="COMPUTEROUTPUT"
>exec</TT
> command to run Linux kernels
is supported for this board (see <A
HREF="executing_programs.html"
>the section called <I
>Executing Programs from RedBoot</I
> in Chapter 2</A
>). The <TT
CLASS="COMPUTEROUTPUT"
>exec</TT
> parameters used for the iPAQ are:</P
><P
>-b &lt;addr&#62; - Location Linux kernel was loaded to -l
&lt;len&#62; - Length of kernel  -c "params" - Parameters passed
to kernel  -r &lt;addr&#62; - 'initrd' ramdisk location -s
&lt;len&#62;  - Length of initrd ramdisk </P
><P
>Linux kernels may be run on the iPAQ using the sources from the anonymous
CVS repository at the Handhelds project ( http://www.handhelds.org/ ) with
the elinux.patch file applied. This file can be found in the misc/ subdirectory
of the iPAQ platform HAL in the RedBoot sources, normally hal/arm/sa11x0/ipaq/VERSION/misc/
  </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1416"
>Updating the secondary RedBoot image</A
></H3
><P
>To update the secondary RedBoot images, follow the procedures detailed
in <A
HREF="updating_redboot.html#DIFFERENT_VERSION_FROM_RAM"
>the section called <I
>Load and start a different version of RedBoot, running from RAM</I
> in Chapter 4</A
>, relying on default location
and size of the image. If is also possible to explicitly specify the options
- the appropriate options for the iPAQ are:   <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>-f 0x50040000
-b 0x00020000
-r 0x00020000
-e 0x00020040
-l 0x40000</PRE
></TD
></TR
></TABLE
>When updating the image, the flash should be unlocked
before programming, and relocked afterwards. This is done with the commands:
    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>fis unlock -f 0x50040000 -l 0x40000</PRE
></TD
></TR
></TABLE
>and<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>fis lock -f 0x50040000 -l 0x40000</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1423"
>Updating the primary RedBoot image</A
></H3
><P
>To update the primary RedBoot images, follow the procedures detailed
in <A
HREF="updating_redboot.html#UPDATE_PRIMARY_IMAGE"
>the section called <I
>Update the primary RedBoot flash image</I
> in Chapter 4</A
>, relying on default location and
size of the image. If is also possible to explicitly specify the options -
the appropriate options for the iPAQ are:    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>-f 0x50000000
-b 0x00100000
-l 0x40000</PRE
></TD
></TR
></TABLE
> When updating the image, the flash should be unlocked
before programming, and relocked afterwards. This is done with the commands:
    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>fis unlock -f 0x50000000 -l 0x4000</PRE
></TD
></TR
></TABLE
>and<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>fis lock -f 0x50000000 -l 0x4000</PRE
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1430"
>Memory Maps</A
></H2
><P
>RedBoot sets up the following memory map on the iPAQ:   The first level
page table is located at physical address 0xc0004000.  No second level tables
are used.   <DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>NOTE:: </B
>The virtual memory maps in this section use a C and B column to indicate
whether or not the region is cached (C) or buffered (B).</P
></BLOCKQUOTE
></DIV
> <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>Physical Address Range     Description 
-----------------------    ---------------------------------- 
0x00000000 - 0x01ffffff    16Mb to 32Mb FLASH (nCS0) 
0x30000000 - 0x3fffffff    Compact Flash 
0x48000000 - 0x4bffffff    iPAQ internal registers    
0x80000000 - 0xbfffffff    SA-1110 Internal Registers 
0xc0000000 - 0xc1ffffff    DRAM Bank 0 - 32Mb SDRAM 
0xe0000000 - 0xe7ffffff    Cache Clean   

Virtual Address Range    C B  Description 
-----------------------  - -  ---------------------------------- 
0x00000000 - 0x01ffffff  Y Y  DRAM - 32Mb 
0x30000000 - 0x3fffffff  N N  Compact Flash 
0x48000000 - 0x4bffffff  N N  iPAQ internal registers    
0x50000000 - 0x51ffffff  Y Y  Up to 32Mb FLASH (nCS0) 
0x80000000 - 0xbfffffff  N N  SA-1110 Internal Registers 
0xc0000000 - 0xc1ffffff  N Y  DRAM Bank 0: 32Mb  
0xe0000000 - 0xe7ffffff  Y Y  Cache Clean   </PRE
></TD
></TR
></TABLE
> </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1437"
>Resource Usage</A
></H2
><P
>The flash based RedBoot image occupies flash addresses 0x50000000 -
0x5003fff. RedBoot also reserves RAM (0x00000000 - 0x0001ffff) for RedBoot
runtime uses. RAM based RedBoot configurations are designed to run from RAM
at physical addresses 0x00020000 - 0x0003ffff. RAM physical addresses from
0x00040000 to the end of RAM arae available for general use, such as a temporary
scratchpad for downloaded images, before they are written to flash. An exception
is RAM from 0x01F70000 - 0x01FFFFFF which are reserved for use by the LCD
display.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1440"
>Rebuilding RedBoot</A
></H2
><P
>The instructions for chapter 3: Redbuilding RedBoot may be followed,
but note that the configuration export files supplied in the <TT
CLASS="COMPUTEROUTPUT"
>hal/arm/sa11x0/ipaq/VERSION/misc</TT
> directory in the RedBoot
sources should be used.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="pid.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="redboot.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>&nbsp;</TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ARM ARM7 PID, Dev7 and Dev9</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="installation_and_testing.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>&nbsp;</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>