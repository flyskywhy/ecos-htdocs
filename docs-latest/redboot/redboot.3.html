<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD><!--version 1.2/Mon Mar  5 17:23:02  2001--><!--version 1.2/Mon Mar  5 17:21:49  2001-->
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<LINK REL="STYLESHEET" HREF="cygnus.css">
<TITLE> Getting Started with RedBoot</TITLE></HEAD>
<BODY BGCOLOR="#ffffff">
<DIV>
<TABLE STYLE="ECOS" WIDTH="98%" BORDER="0" ALIGN="LEFT" CELLPADDING="1"><TR><TH COLSPAN="3" ALIGN="center"><P CLASS="Gotos">Getting Started with RedBoot</P></TH></TR><TR><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.html">Contents</A></P></TD><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.2.html">To&nbsp;previous&nbsp;page</A></P></TD><TD ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.4.html">To&nbsp;next&nbsp;page</A></P></TD></TR></TABLE><P ALIGN="LEFT">&nbsp;</P><BR><BR><HR ALIGN="center"></DIV>
<H2 CLASS="ChapterTitle">
<A NAME="pgfId=2636228">
 </A>
<A NAME="marker=2653423">
 </A>
Getting Started with RedBoot<DIV>
<IMG SRC="botclear.gif">
</DIV>
</H2>
<P CLASS="Body">
<A NAME="pgfId=2652733">
 </A>
RedBoot<B CLASS="Superscript">
&#174;</B>
 is an acronym for &quot;Red Hat Embedded Debug and Bootstrap&quot;, and is the standard embedded system debug/bootstrap environment from Red Hat, replacing the existing debug/boot tools: <A NAME="marker=2653424">
 </A>
CygMon and <A NAME="marker=2653425">
 </A>
GDB stubs. It provides a complete bootstrap environment for a range of embedded operating systems, such as embedded Linux and eCos<EM CLASS="FmSymbol">&#153,</EM>
 and includes facilities such as network downloading and debugging. It also provides a simple flash file system for boot images.</P>
<P CLASS="Body">
<A NAME="pgfId=2652768">
 </A>
RedBoot provides a wide set of tools for downloading and executing programs on embedded target systems, as well as tools for manipulating the target system's environment. It can be used for both product development (debug support) and for end product deployment (FLASH and network booting).<BR>
Here are some highlights of <A NAME="marker=2653427">
 </A>
RedBoot's capabilities:  </P>
<UL>
<P><P><LI>
<A NAME="pgfId=2636857">
 </A>
Serial and network (Ethernet) based debugging  support, providing connectivity between host and target systems</LI>
<P><P><LI>
<A NAME="pgfId=2652980">
 </A>
FLASH memory management, including the downloading, updating and erasure of mutiple FLASH boot images, direct boot from FLASH, and persistent configuration data and script storage.  </LI>
<P><P><LI>
<A NAME="pgfId=2652913">
 </A>
Boot scripting support</LI>
<P><P><LI>
<A NAME="pgfId=2636859">
 </A>
Simple command line interface for RedBoot configuration and management, accessible via serial (terminal) or Ethernet (telnet) </LI>
<P><P><LI>
<A NAME="pgfId=2653031">
 </A>
Integrated GDB stubs for connection to a host-based debugger via serial or ethernet. (Ethernet connectivity is limited to local network only)</LI>
<P><P><LI>
<A NAME="pgfId=2653191">
 </A>
Attribute Configuration - user control of aspects such as system time and date (if applicable), default Flash image to boot from, default failsafe image, static IP address, etc.</LI>
<P><P><LI>
<A NAME="pgfId=2653242">
 </A>
Configurable and extensible, specifically adapted to the target environment</LI>
<P><P><LI>
<A NAME="pgfId=2653088">
 </A>
Network bootstrap support including setup and download, via BOOTP, DHCP and TFTP </LI>
<P><P><LI>
<A NAME="pgfId=2653099">
 </A>
X/YModem support for image download via serial</LI>
<P><P><LI>
<A NAME="pgfId=2653159">
 </A>
Power On Self Test</LI>
</UL>
<P CLASS="Body">
<A NAME="pgfId=2653269">
 </A>
Although RedBoot is derived from Red Hat eCos, it may be used as a generalized system debug and bootstrap control software for any embedded system and any operating system. For example, with appropriate additions, RedBoot could replace the commonly used BIOS of PC (and certain other) architectures. Red Hat is currently installing RedBoot on all embedded platforms as a standard practice, and RedBoot is now generally included as part of all Red Hat Embedded Linux and eCos ports. Users who specifically wish to use RedBoot with the eCos operating system should refer to the <EM CLASS="Emphasis">
Getting Started with eCos</EM>
 document, which provides information about the portability and extendability of RedBoot in an eCos environment.</P>
<P CLASS="Body">
<A NAME="pgfId=2653325">
 </A>
This chapter explains how to install and configure RedBoot for your target. </P>
<DIV>
<H3 CLASS="Heading1">
<A NAME="pgfId=2637463">
 </A>
<A NAME="marker=2653428">
 </A>
Installing RedBoot</H3>
<P CLASS="Body">
<A NAME="pgfId=2653500">
 </A>
To install the RedBoot package, follow the procedures detailed in the accompanying README.</P>
<P CLASS="Body">
<A NAME="pgfId=2654321">
 </A>
Although there are other possible configurations, RedBoot is usually run from the target platform's FLASH boot sector or boot ROM, and is designed to run when your system is initially powered on. The method used to install the RedBoot image into non-volatile storage varies from platform to platform. In general, it requires that the image be programmed into FLASH in situ or programmed into the FLASH or ROM using a device programmer. In some cases this will be done at manufacturing time; the platform being delivered with RedBoot already in place. In other cases, you will have to program RedBoot into the appropriate device(s) yourself. Installing to FLASH in situ may require special cabling or interface devices and software provided by the board manufacturer. The details of this installation process for a given platform will be found in <A HREF="redboot.7.html#14546" CLASS="XRef">
 Installation and Testing</A>
.</P>
<P CLASS="Body">
<A NAME="pgfId=2654513">
 </A>
Once installed, user-specific configuration options may be applied, using the <TT CLASS="Code">
fconfig</TT>
 command, providing that persistent data storage in FLASH is present in the relevant RedBoot version. See <A HREF="redboot.3.html#17228" CLASS="XRef">
 Configuring the RedBoot Environment</A>
 for details.</P>
</DIV>
<DIV>
<H3 CLASS="Heading1">
<A NAME="pgfId=2654521">
 </A>
<A NAME="marker=2654520">
 </A>
User Interface</H3>
<P CLASS="Body">
<A NAME="pgfId=2653940">
 </A>
RedBoot provides a command line user interface (CLI).  At the minimum, this interface is normally available on a serial port on the platform. If more than one serial interface is available, RedBoot is normally configured to try to use any one of the ports for the CLI. Once command input has been received on one port, that port is used exclusively until reset. If the platform has networking capabilities, the RedBoot CLI is also accessible using the <TT CLASS="Code">
telnet</TT>
<A NAME="marker=2654075">
 </A>
 access protocol. By default, RedBoot runs <TT CLASS="Code">
telnet</TT>
 on port TCP/9000, but this is configurable and/or settable by the user.</P>
<P CLASS="Body">
<A NAME="pgfId=2653949">
 </A>
RedBoot also contains a set of <A NAME="marker=2654076">
 </A>
GDB &quot;stubs&quot;, consisting of code which supports the GDB remote protocol.  GDB stub mode is automatically invoked when the '$' character appears as the first character of a command line. The platform will remain in GDB stub mode until explicitly disconnected (via the GDB protocol). The GDB stub mode is available regardless of the connection method; either serial or network.  Note that if a GDB connection is made via the network, then special care must be taken to preserve that connection when running user code. eCos contains special network sharing code to allow for this situation, and can be used as a model if this methodology is required in other OS environments.</P>
</DIV>
<DIV>
<H3 CLASS="Heading1">
<A NAME="pgfId=2636697">
 </A>
<A NAME="marker=2653429">
 </A>
<A NAME="17228">
 </A>
Configuring the RedBoot Environment</H3>
<P CLASS="Body">
<A NAME="pgfId=2636698">
 </A>
Once installed, RedBoot will operate fairly generically. However, there are some features that can be configured for a particular installation. These depend primarily on whether <A NAME="marker=2653430">
 </A>
FLASH and/or networking support are available. The remainder of this discussion assumes that support for both of these options is included in RedBoot.</P>
<H3 CLASS="Heading2">
<A NAME="pgfId=2636699">
 </A>
<A NAME="marker=2653431">
 </A>
Target <A NAME="marker=2653432">
 </A>
Network Configuration</H3>
<P CLASS="Body">
<A NAME="pgfId=2636700">
 </A>
Each node in a networked system needs to have a unique address. Since the network support in RedBoot is based on <A NAME="marker=2653433">
 </A>
TCP/IP, this address is an IP (Internet Protocol) address. There are two ways for a system to &quot;know&quot; its IP address. First, it can be stored locally on the platform. This is known as having a static IP address. Second, the system can use the network itself to discover its IP address. This is known as a dynamic IP address. RedBoot supports this dynamic IP address mode by use of the <A NAME="marker=2653434">
 </A>
BOOTP (a subset of <A NAME="marker=2653435">
 </A>
DHCP) protocol. In this case, RedBoot will ask the network (actually some generic server on the network) for the IP address to use.</P>
<H3 CLASS="Label">
<A NAME="pgfId=2636701">
 </A>
NOTE</H3>
<P CLASS="Note">
<A NAME="pgfId=2638350">
 </A>
Currently, RedBoot only supports BOOTP. In future releases, DHCP may also be supported, but such support will be limited to additional data items, not lease-based address allocation.</P>
<P CLASS="Body">
<A NAME="pgfId=2636702">
 </A>
The choice of <A NAME="marker=2653437">
 </A>
IP address type is made via the <TT CLASS="Code">
fconfig</TT>
<A NAME="marker=2653436">
 </A>
 command. Once a selection is made, it will be stored in FLASH memory.  RedBoot only queries the FLASH configuration information at reset, so any changes will require restarting the platform.</P>
<P CLASS="Body">
<A NAME="pgfId=2636703">
 </A>
Here is an example of the RedBoot <TT CLASS="Code">
fconfig</TT>
 command, showing network addressing:    </P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2637077"> </A>
RedBoot&gt; <KBD CLASS="CodeVariant">fconfig  -1</KBD>
  
Run script at boot: false   
Use BOOTP for network configuration: false 
Local IP address: 192.168.1.29   
Default server IP address: 192.168.1.101   
GDB connection port: 9000   
Network debug at boot time: false </PRE>
<P CLASS="Body">
<A NAME="pgfId=2636704">
 </A>
In this case, the board has been configured with a static IP address listed as the <TT CLASS="Code">
Local IP address</TT>
. The <TT CLASS="Code">
default server IP address</TT>
 specifies which network node to communicate with for TFTP service. This address can be overridden directly in the <A NAME="marker=2653438">
 </A>
TFTP commands.</P>
<P CLASS="Body">
<A NAME="pgfId=2636705">
 </A>
If the selection for <TT CLASS="Code">
Use BOOTP for network configuration</TT>
 had been <TT CLASS="Code">
true</TT>
, these IP addresses would be determined at boot time, via the BOOTP protocol.</P>
<P CLASS="Body">
<A NAME="pgfId=2636706">
 </A>
The final number which needs to be configured, regardless of IP address selection mode, is the <TT CLASS="Code">
GDB connection port</TT>
<A NAME="marker=2653439">
 </A>
. RedBoot allows for incoming commands on either the available serial ports or via the network. This port number is the TCP port that RedBoot will use to accept incoming connections. </P>
<P CLASS="Body">
<A NAME="pgfId=2637110">
 </A>
These connections can be used for GDB sessions, but they can also be used for generic RedBoot commands. In particular, it is possible to communicate with RedBoot via the <TT CLASS="Code">
telnet</TT>
<A NAME="marker=2653440">
 </A>
 protocol. For example, on Linux<B CLASS="Superscript">
&#174;</B>
:   </P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2637111"> </A>
% telnet redboot_board 9000  
Connected to redboot_board   
Escape character is '^]'.
RedBoot&gt; </PRE>
<H3 CLASS="Heading2">
<A NAME="pgfId=2636708">
 </A>
<A NAME="marker=2653441">
 </A>
Host Network Configuration</H3>
<P CLASS="Body">
<A NAME="pgfId=2636710">
 </A>
RedBoot may require two different classes of service from a network host:   </P>
<UL>
<P><P><LI>
<A NAME="pgfId=2637119">
 </A>
dynamic IP address allocation, using BOOTP   </LI>
<P><P><LI>
<A NAME="pgfId=2637120">
 </A>
TFTP service for file downloading </LI>
</UL>
<P CLASS="Body">
<A NAME="pgfId=2637337">
 </A>
Depending on the host system, these services may or may not be available or enabled by default.  See your system documentation for more details.</P>
<P CLASS="Body">
<A NAME="pgfId=2636711">
 </A>
In particular, on Red Hat Linux, neither of these services will be configured out of the box. The following will provide a limited explanation of how to set them up. These configuration setups must be done as <TT CLASS="Code">
root</TT>
 on the host or server machine.</P>
<H4 CLASS="Heading3">
<A NAME="pgfId=2636712">
 </A>
Enable <A NAME="marker=2653442">
 </A>
TFTP on Red Hat Linux 6.2</H4>
<OL>
<P><P><LI>
<A NAME="pgfId=2636713">
 </A>
Ensure that you have the <TT CLASS="Code">
tftp-server</TT>
 RPM package installed.  By default, this installs the TFTP server in a disabled state.  These steps will enable it:    <BR>
<TT CLASS="Code">
</TT>
</LI>
<P><P><LI>
<A NAME="pgfId=2636715">
 </A>
Make sure that the following line is uncommented in the control file <BR>
<TT CLASS="Code">
/etc/inetd.conf <BR>
<BR>
tftp dgram   udp     wait    root    /usr/sbin/tcpd  \<BR>
     /usr/sbin/in.tftpd</TT>
</LI>
<P><P><LI>
<A NAME="pgfId=2636716">
 </A>
If it was necessary to change the line in Step 2, then the <TT CLASS="Code">
inetd</TT>
 server must be restarted, which can be done via the command:   <BR>
<TT CLASS="Code">
# service inet reload</TT>
</LI>
</OL>
<H4 CLASS="Heading3">
<A NAME="pgfId=2654953">
 </A>
Enable <A NAME="marker=2654952">
 </A>
TFTP on Red Hat Linux 7.0</H4>
<OL>
<P><P><LI>
<A NAME="pgfId=2654925">
 </A>
Ensure that the xinetd RPM is installed.</LI>
<P><P><LI>
<A NAME="pgfId=2654926">
 </A>
Ensure that the tftp-server RPM is installed.</LI>
<P><P><LI>
<A NAME="pgfId=2655064">
 </A>
Enable TFTP by means of the following:</LI>
</OL>
<P CLASS="NumberedFollow">
<A NAME="pgfId=2655066">
 </A>
<TT CLASS="Code">
/sbin/chkconfig tftp on</TT>
</P>
<P CLASS="NumberedFollow">
<A NAME="pgfId=2655071">
 </A>
Reload the xinetd configuration using the command:<BR>
<TT CLASS="Code">
/sbin/service xinetd reload</TT>
</P>
<P CLASS="NumberedFollow">
<A NAME="pgfId=2654932">
 </A>
Create the directory /tftpboot using the command<BR>
<TT CLASS="Code">
mkdir /tftpboot</TT>
</P>
<H3 CLASS="Label">
<A NAME="pgfId=2654935">
 </A>
NOTE:</H3>
<P CLASS="Note">
<A NAME="pgfId=2655018">
 </A>
Under Red Hat 7 you must address files by absolute pathnames, for example:<BR>
<TT CLASS="Code">
/tftpboot/boot.img</TT>
 not <TT CLASS="Code">
/boot.img</TT>
, as you may have done with other implementations.</P>
<H4 CLASS="Heading3">
<A NAME="pgfId=2636717">
 </A>
Enable <A NAME="marker=2653443">
 </A>
DHCP and <A NAME="marker=2653444">
 </A>
BOOTP server</H4>
<P CLASS="Body">
<A NAME="pgfId=2636718">
 </A>
First, ensure that you have the proper package, <TT CLASS="Code">
dhcp</TT>
 (not <TT CLASS="Code">
dhcpd</TT>
) installed. The DHCP server provides <TT CLASS="Code">
Dynamic Host Configuration</TT>
, that is, IP address and other data to hosts on a network. It does this in different ways. Next, there can be a fixed relationship between a certain node and the data, based on that node's unique Ethernet Station Address (ESA, sometimes called a MAC address).  The other possibility is simply to assign addresses that are free. The sample DHCP configuration file shown does both. Refer to the DHCP documentation for more details.</P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2638615"> </A>
--------------- /etc/dhcpd.conf -----------------------------------
default-lease-time 600; 
max-lease-time 7200; 
option subnet-mask 255.255.255.0; 
option broadcast-address 192.168.1.255; 
option domain-name-servers 63.225.98.241, 206.196.128.1, 205.180.230.20,205.180.230.21; 
option domain-name &quot;bogus.com&quot;; 
allow bootp;</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2636721"> </A>
shared-network BOGUS {   
subnet 192.168.1.0 netmask 255.255.255.0 {
         option routers 192.168.1.101;
         range 192.168.1.1 192.168.1.254;   
}
 }</PRE>
<PRE CLASS="CodeExample"><A NAME="pgfId=2636722"> </A>
host mbx {
         hardware ethernet 08:00:3E:28:79:B8;
         fixed-address 192.168.1.20;
         filename &quot;/tftpboot/192.168.1.21/zImage&quot;;
         default-lease-time -1;
         server-name &quot;srvr.bugus.com&quot;;
         server-identifier 192.168.1.101;
         option host-name &quot;mbx&quot;;
}</PRE>
<P CLASS="Body">
<A NAME="pgfId=2655091">
 </A>
Once the DHCP package has been installed and the configuration file set up, type:   </P>
<PRE CLASS="CodeExample"><A NAME="pgfId=2655092"> </A>
# service dhcpd start</PRE>
<P CLASS="Body">
<A NAME="pgfId=2655089">
 </A>
</P>
<H4 CLASS="Heading3">
<A NAME="pgfId=2654811">
 </A>
RedBoot network gateway</H4>
<P CLASS="Body">
<A NAME="pgfId=2654895">
 </A>
RedBoot cannot communicate with machines on different subnets because it does not support routing. It always assumes that it can get to an address directly, therefore it always tries to ARP and then send packets directly to that unit. This means that whatever it talks to must be on the same subnet. If you need to talk to a host on a different subnet (even if it's on the same 'wire'), you need to go through an ARP proxy, providing that there is a Linux box connected to the network which is able to route to the TFTP server. For example:</P>
<P CLASS="Body">
<A NAME="pgfId=2654818">
 </A>
<TT CLASS="Code">
/proc/sys/net/ipv4/conf/&lt;interface&gt;/proxy_arp</TT>
</P>
<P CLASS="Body">
<A NAME="pgfId=2654812">
 </A>
where <TT CLASS="Code">
&lt;interface&gt;</TT>
 should be replaced with whichever network interface is nearest to the board.</P>
<H3 CLASS="Heading2">
<A NAME="pgfId=2654603">
 </A>
Verification</H3>
<P CLASS="Body">
<A NAME="pgfId=2654609">
 </A>
Once your network setup has been configured, perform simple verification tests as follows:</P>
<UL>
<P><P><LI>
<A NAME="pgfId=2654610">
 </A>
Reboot your system, to enable the setup, and then try to 'ping' the target board from a host.</LI>
<P><P><LI>
<A NAME="pgfId=2654615">
 </A>
Once communication has been established, try using the RedBoot load command to download a file from a host.</LI>
<TABLE>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
</TD>
</TR>
</TABLE>
</UL>
</DIV>
<HR ALIGN="center"><TABLE STYLE="ECOS" WIDTH="98%" BORDER="0" ALIGN="LEFT" CELLPADDING="1"><TR><TH COLSPAN="3" ALIGN="center"><P CLASS="Gotos">Getting Started with RedBoot</P></TH></TR><TR><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.html">Contents</A></P></TD><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.2.html">To&nbsp;previous&nbsp;page</A></P></TD><TD  ALIGN="center"><P CLASS="Gotos"><A HREF="redboot.4.html">To&nbsp;next&nbsp;page</A></P></TD></TR></TABLE></BODY>
</HTML>
