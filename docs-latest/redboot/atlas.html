<!-- Copyright (C) 2001 Red Hat, Inc.                                -->
<!-- This material may be distributed only subject to the terms      -->
<!-- and conditions set forth in the Open Publication License, v1.0  -->
<!-- or later (the latest version is presently available at          -->
<!-- http://www.opencontent.org/openpub/).                           -->
<!-- Distribution of substantively modified versions of this         -->
<!-- document is prohibited without the explicit permission of the   -->
<!-- copyright holder.                                               -->
<!-- Distribution of the work or derivative of the work in any       -->
<!-- standard (paper) book form is prohibited unless prior           -->
<!-- permission is obtained from the copyright holder.               -->
<HTML
><HEAD
><TITLE
>MIPS Atlas Board with CoreLV 4Kc and CoreLV 5Kc </TITLE
><meta name="MSSmartTagsPreventParsing" content="TRUE">
<META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"><LINK
REL="HOME"
TITLE="RedBoot&#8482; User's Guide"
HREF="redboot.html"><LINK
REL="UP"
TITLE="Installation and Testing"
HREF="installation-and-testing.html"><LINK
REL="PREVIOUS"
TITLE="Intel SA1110 (Assabet) "
HREF="assabet.html"><LINK
REL="NEXT"
TITLE="PMC-Sierra MIPS RM7000 Ocelot"
HREF="ocelot.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>RedBoot&#8482; User's Guide: Document Version 1.5m, July 2001</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="assabet.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 5. Installation and Testing</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="ocelot.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="ATLAS"
>MIPS Atlas Board with CoreLV 4Kc and CoreLV 5Kc</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1256"
>Overview</A
></H2
><P
>RedBoot supports the DgbSer
serial port and the built in ethernet port for communication and downloads.
The default serial port settings are 115200,8,N,1. RedBoot runs from and supports
flash management for the system flash region. These configurations are supported: <P
></P
><UL
><LI
><P
>RedBoot running from the system flash boot sector.</P
></LI
><LI
><P
>RedBoot running from RAM with RedBoot in the system flash
boot sector.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1270"
>Initial Installation</A
></H2
><P
>RedBoot is installed using the code download facility built into the
Atlas board. See the Atlas User manual for details, and also the Atlas download
format in <A
HREF="atlas.html#ATLAS-DOWNLOAD-FORMAT"
>the section called <I
>Atlas download format</I
></A
>.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1274"
>Quick download instructions</A
></H3
><P
>Here are quick start instructions for downloading the prebuilt RedBoot
image. </P
><P
></P
><OL
TYPE="1"
><LI
><P
>Locate the prebuilt files in the bin directory: <TT
CLASS="COMPUTEROUTPUT"
>deleteall.dl</TT
> and <TT
CLASS="COMPUTEROUTPUT"
>redboot.dl</TT
>. </P
></LI
><LI
><P
>Make sure switch S1-1 is OFF and switch S5-1 is ON. Reset
the board and verify that the LED display reads <TT
CLASS="COMPUTEROUTPUT"
>Flash DL</TT
>. </P
></LI
><LI
><P
>Make sure your parallel port is connected to the 1284 port
Of the Atlas board. </P
></LI
><LI
><P
>Send the deleteall.dl file to the parallel port to erase previous
images: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>% cat deleteall.dl &#62;/dev/lp0</PRE
></TD
></TR
></TABLE
> When
this is complete, the LED display should read &#8220;Deleted.&#8221; </P
></LI
><LI
><P
>Send the RedBoot image to the board: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>% cat redboot.dl &#62;/dev/lp0</PRE
></TD
></TR
></TABLE
>When this is complete, the LED display should show the last
address programmed. This will be something like: <TT
CLASS="COMPUTEROUTPUT"
>1fc17000</TT
>. </P
></LI
><LI
><P
>Change switch S5-1 to OFF and reset the board. The LED display
should read &#8220;RedBoot&#8221;. </P
></LI
><LI
><P
>Run the RedBoot <TT
CLASS="COMPUTEROUTPUT"
>fis init</TT
>
and <TT
CLASS="COMPUTEROUTPUT"
>fconfig</TT
> commands to initialize the flash.
See <A
HREF="atlas.html#ATLAS-ADDITIONAL-FCONFIG-OPTIONS"
>the section called <I
>Additional config options</I
></A
>, <A
HREF="flash-image-system.html"
>the section called <I
>Flash Image System (FIS)</I
> in Chapter 2</A
>
and <A
HREF="persistent-state-flash.html"
>the section called <I
>Persistent State Flash-based Configuration and Control</I
> in Chapter 2</A
> for details. </P
></LI
></OL
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="ATLAS-DOWNLOAD-FORMAT"
>Atlas download format</A
></H3
><P
>In order to download RedBoot to the Atlas board, it must be converted
to the Atlas download format. There are different ways of doing this depending
on which version of the developer's kit is shipped with the board.   </P
><P
>The <I
CLASS="CITETITLE"
>Atlas Developer's Kit</I
> CD contains an <TT
CLASS="COMPUTEROUTPUT"
>srec2flash</TT
> utility. The source code for this utility is part
of the <TT
CLASS="COMPUTEROUTPUT"
>yamon/yamon-src-01.01.tar.gz</TT
> tarball
on the Dev Kit CD. The path in the expanded tarball is <TT
CLASS="COMPUTEROUTPUT"
>yamon/bin/tools</TT
>.   To use <TT
CLASS="COMPUTEROUTPUT"
>srec2flash</TT
> to
convert the S-record file:     <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>% srec2flash -EL -S29 redboot.srec &#62;redboot.dl</PRE
></TD
></TR
></TABLE
> The <I
CLASS="CITETITLE"
>Atlas/Malta Developer's Kit</I
> CD
contains an <TT
CLASS="COMPUTEROUTPUT"
>srecconv.pl</TT
> utility which requires
Perl. This utilty is part of the <TT
CLASS="COMPUTEROUTPUT"
>yamon/yamon-src-02.00.tar.gz</TT
> tarball on the Dev Kit CD. The path in the expanded tarball
is <TT
CLASS="COMPUTEROUTPUT"
>yamon/bin/tools</TT
>.   To use <TT
CLASS="COMPUTEROUTPUT"
>srecconv</TT
> to convert the S-record file:     <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>% cp redboot_ROM.srec redboot_ROM.rec   
% srecconv.pl -ES L -A 29 redboot_ROM </PRE
></TD
></TR
></TABLE
>  The resulting file
is named redboot_ROM.fl.</P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1319"
>Flash management</A
></H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="ATLAS-ADDITIONAL-FCONFIG-OPTIONS"
>Additional config options</A
></H3
><P
>The ethernet MAC address is stored in flash manually using the <TT
CLASS="COMPUTEROUTPUT"
>fconfig</TT
> command. You can use the YAMON <TT
CLASS="COMPUTEROUTPUT"
>setenv
ethaddr</TT
> command to print out the board ethernet address.
Typically, it is:    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>00:0d:a0:00:xx:xx</PRE
></TD
></TR
></TABLE
> where
xx.xx is the hex representation of the board serial number.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1327"
>Updating the secondary RedBoot image</A
></H3
><P
>To update the secondary RedBoot images, follow the procedures detailed
in <A
HREF="updating-redboot.html#DIFFERENT-VERSION-FROM-RAM"
>the section called <I
>Load and start a different version of RedBoot, running from RAM</I
> in Chapter 4</A
>, but the actual numbers used
with the flags in the sample commands should be: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>-f 0x9dc40000
-b 0x80020000
-r 0x80020000
-l 0x40000</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1332"
>Updating the primary RedBoot image</A
></H3
><P
>To update the primary RedBoot images, follow the procedures detailed
in <A
HREF="updating-redboot.html#UPDATE-PRIMARY-IMAGE"
>the section called <I
>Update the primary RedBoot flash image</I
> in Chapter 4</A
>, but the actual numbers used with
the flags in the sample commands should be:        <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>-f 0x9dc00000      
-b 0x80080000      
-l 0x40000</PRE
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1337"
>Additional commands</A
></H2
><P
>The <TT
CLASS="COMPUTEROUTPUT"
>exec</TT
> command which allows the 
loading and execution of Linux kernels, is supported for this architecture
 (see <A
HREF="executing-programs.html"
>the section called <I
>Executing Programs from RedBoot</I
> in Chapter 2</A
>). The  <TT
CLASS="COMPUTEROUTPUT"
>exec</TT
>
parameters used for MIPS boards are:</P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
>-b <TT
CLASS="REPLACEABLE"
><I
>&lt;addr&#62;</I
></TT
></DT
><DD
><P
>Location to store command line and environment passed to kernel</P
></DD
><DT
>-w <TT
CLASS="REPLACEABLE"
><I
>&lt;time&#62;</I
></TT
></DT
><DD
><P
>Wait time in seconds before starting kernel</P
></DD
><DT
>-c <TT
CLASS="REPLACEABLE"
><I
>"params"</I
></TT
></DT
><DD
><P
>Parameters passed to kernel</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>&lt;addr&#62;</I
></TT
></DT
><DD
><P
>Kernel entry point, defaulting to the entry point of the last image
loaded</P
></DD
></DL
></DIV
><P
>Linux kernels on MIPS platforms expect the entry point to be called
with arguments in the registers equivalent to a C call with prototype: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>void Linux(int argc, char **argv, char **envp);</PRE
></TD
></TR
></TABLE
></P
><P
>RedBoot will place the appropriate data at the offset specified by the <TT
CLASS="PARAMETER"
><I
>-b</I
></TT
> parameter, or by default at address 0x80080000, and will set
the arguments accordingly when calling into the kernel.</P
><P
>The default entry point, if no image with explicit entry point has been
loaded and none is specified, is 0x80000750.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1369"
>Interrupts</A
></H2
><P
>RedBoot uses an interrupt vector table which is located at address 0x80000400.
Entries in this table are pointers to functions with this protoype:      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>int irq_handler( unsigned vector, unsigned data )</PRE
></TD
></TR
></TABLE
>On an atlas
board, the vector argument is one of 25 interrupts defined in <TT
CLASS="COMPUTEROUTPUT"
>hal/mips/atlas/<TT
CLASS="REPLACEABLE"
><I
>VERSION</I
></TT
>/include/plf_intr.h</TT
>: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#define CYGNUM_HAL_INTERRUPT_SER                 0 
#define CYGNUM_HAL_INTERRUPT_TIM0                1 
#define CYGNUM_HAL_INTERRUPT_2                   2 
#define CYGNUM_HAL_INTERRUPT_3                   3 
#define CYGNUM_HAL_INTERRUPT_RTC                 4 
#define CYGNUM_HAL_INTERRUPT_COREHI              5 
#define CYGNUM_HAL_INTERRUPT_CORELO              6 
#define CYGNUM_HAL_INTERRUPT_7                   7 
#define CYGNUM_HAL_INTERRUPT_PCIA                8 
#define CYGNUM_HAL_INTERRUPT_PCIB                9 
#define CYGNUM_HAL_INTERRUPT_PCIC               10 
#define CYGNUM_HAL_INTERRUPT_PCID               11 
#define CYGNUM_HAL_INTERRUPT_ENUM               12 
#define CYGNUM_HAL_INTERRUPT_DEG                13 
#define CYGNUM_HAL_INTERRUPT_ATXFAIL            14 
#define CYGNUM_HAL_INTERRUPT_INTA               15 
#define CYGNUM_HAL_INTERRUPT_INTB               16 
#define CYGNUM_HAL_INTERRUPT_INTC               17 
#define CYGNUM_HAL_INTERRUPT_INTD               18 
#define CYGNUM_HAL_INTERRUPT_SERR               19
#define CYGNUM_HAL_INTERRUPT_HW1                20
#define CYGNUM_HAL_INTERRUPT_HW2                21
#define CYGNUM_HAL_INTERRUPT_HW3                22
#define CYGNUM_HAL_INTERRUPT_HW4                23
#define CYGNUM_HAL_INTERRUPT_HW5                24</PRE
></TD
></TR
></TABLE
>The data
passed to the ISR is pulled from a data table (<TT
CLASS="COMPUTEROUTPUT"
>hal_interrupt_data</TT
>) which immediately follows the interrupt vector table. With
25 interrupts, the data table starts at address 0x80000464 on atlas.</P
><P
>An application may create a normal C function with the above prototype
to be an ISR. Just poke its address into the table at the correct index and
enable the interrupt at its source. The return value of the ISR is ignored
by RedBoot. </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1378"
>Memory Maps</A
></H2
><P
>Memory Maps RedBoot sets up the following memory map on the Atlas board. <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>Physical Address Range Description  
----------------------- -------------  
0x00000000 - 0x07ffffff SDRAM  
0x08000000 - 0x17ffffff PCI Memory Space  
0x18000000 - 0x1bdfffff PCI I/O Space  
0x1be00000 - 0x1bffffff System Controller  
0x1c000000 - 0x1dffffff System flash  
0x1e000000 - 0x1e3fffff Monitor flash  
0x1f000000 - 0x1fbfffff FPGA</PRE
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1382"
>Resource Usage</A
></H2
><P
>The flash based RedBoot image occupies flash addresses 0x1fc00000 -
0x1fc1ffff. RedBoot also reserves RAM (0x00000000 - 0x0001ffff) for RedBoot
runtime uses. RAM based RedBoot configurations are designed to run from RAM
at physical addresses 0x00020000 - 0x0003ffff. RAM physical addresses from
0x00040000 to the end of RAM are available for general use, such as a temporary
scratchpad for downloaded images, before they are written to flash.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1385"
>Rebuilding RedBoot</A
></H2
><P
>The instructions in <A
HREF="rebuilding-redboot.html"
>Chapter 3</A
> should be followed.
The values for TARGET, ARCH_DIR and PLATFORM_DIR on this platform are &#8220;atlas_mips32_4kc&#8221;
or &#8220;atlas_mips64_5kc&#8221;, &#8220;mips&#8221; and &#8220;atlas&#8221;
respectively. Note that the configuration export files supplied in the <TT
CLASS="COMPUTEROUTPUT"
>hal/mips/atlas/<TT
CLASS="REPLACEABLE"
><I
>VERSION</I
></TT
>/misc</TT
> directory
in the RedBoot source tree should be used.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="assabet.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="redboot.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="ocelot.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Intel SA1110 (Assabet)</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="installation-and-testing.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>PMC-Sierra MIPS RM7000 Ocelot</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>