<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Generator" content="Microsoft Word 97">
   <meta name="GENERATOR" content="Mozilla/4.6 [en] (WinNT; U) [Netscape]">
   <title>GNUPRO&Ocirc; TOOLS</title>
</head>
<body link="#0000FF">
<font size=+1>&nbsp;<b><font face="Arial">GNUPro<sup>&reg;</sup>
Toolkit</font></b></font>
<br>&nbsp;
<p>&nbsp;<b><i><font size=+3>GNUPro Toolkit Reference for eCos<font face="AvantGarde">PowerPC</font></font></i></b>
<hr WIDTH="100%">
<div align=right><b><font size=+2>September, 1999</font></b></div>

<br>&nbsp;
<br>&nbsp;
<div ALIGN=right>
<h2 CLASS="TitleCompany">
<a NAME="pgfId-1069373"></a>CYGNUS</h2></div>

<p><br><font size=+1>&nbsp;<a href="#Table of Contents">Table of Contents</a></font>
<hr WIDTH="100%">
<br>&nbsp;
<div CLASS="Body"><a NAME="pgfId-1069374"></a><font size=-1>Copyright&copy;1998,
1999 <i>CYGNUS SOLUTIONS, Inc.</i> All rights reserved.</font></div>

<div CLASS="Body"><a NAME="pgfId-1069375"></a><font size=-1>No part of
this document may be reproduced in any form or by any means without the
prior express written consent of <i>CYGNUS SOLUTIONS, Inc.</i></font></div>

<div CLASS="Body"><a NAME="pgfId-1069376"></a><font size=-1>No part of
this document may be changed and/or modified without the prior express
written consent of
<i>CYGNUS SOLUTIONS, Inc.</i></font></div>

<div CLASS="Body"><a NAME="pgfId-1069377"></a><font size=-1>GNUPro<i> &reg;</i>
, the GNUPro<i> &reg;</i> logo, and the Cygnus Solutions logo are all registered
trademarks of <i>CYGNUS SOLUTIONS, Inc.</i> All other brand and product
names are trademarks of their respective owners.</font></div>

<h5>
<a NAME="pgfId-1069378"></a><font face="Arial"><font size=-1>Part #: 300-400-1010046-1.2.7</font></font></h5>

<h2 CLASS="Heading1">
<a NAME="pgfId-1069379"></a>GNUPro warranty
<hr WIDTH="100%"></h2>
&nbsp;
<div CLASS="Body"><a NAME="pgfId-1069380"></a>The GNUPro Toolkit is free
software, covered by the GNU General Public License, and you are welcome
to change it and/or distribute copies of it under certain conditions. This
version of GNUPro Toolkit is supported for customers of Cygnus.</div>

<div CLASS="Body"><a NAME="pgfId-1069381"></a>For non-customers, GNUPro
Toolkit software has NO WARRANTY.</div>

<div CLASS="Body"><a NAME="pgfId-1069382"></a>Because this software is
licensed free of charge, there are no warranties for it, to the extent
permitted by applicable law. Except when otherwise stated in writing, the
copyright holders and/or other parties provide the software "as is" without
warranty of any kind, either expressed or implied, including, but not limited
to, the implied warranties of merchantability and fitness for a particular
purpose. The entire risk as to the quality and performance of the software
is with you. Should the software prove defective, you assume the cost of
all necessary servicing, repair or correction.</div>

<div CLASS="Body"><a NAME="pgfId-1069383"></a>In no event, unless required
by applicable law or agreed to in writing, will any copyright holder, or
any other party who may modify and/or redistribute the program as permitted
above, be liable to you for damages, including any general, special, incidental
or consequential damages arising out of the use or inability to use the
program (including but not limited to loss of data or data being rendered
inaccurate or losses sustained by you or third parties or a failure of
the program to operate with any other programs), even if such holder or
other party has been advised of the possibility of such damages.</div>

<h2 CLASS="Heading1">
<a NAME="pgfId-1069389"></a><a NAME="_Toc370542055"></a><a NAME="_Ref385833133"></a><a NAME="_Toc400851455"></a><a NAME="_Toc400854523"></a><a NAME="_Toc404473862"></a>How
to contact Cygnus
<hr WIDTH="100%"></h2>

<div CLASS="Body"><a NAME="pgfId-1069390"></a>Use the following means to
contact Cygnus.</div>

<div CLASS="BodyHang1"><a NAME="pgfId-1069391"></a><b>Cygnus Headquarters</b></div>
1325 Chesapeake Terrace
<br>Sunnyvale, CA 94089 USA
<br>Telephone (toll free)<i> : </i>+1 800 CYGNUS-1
<br>Telephone (main line)<i> : </i>+1 408 542 9600
<br>Telephone (hotline)<i> : </i>+1 408 542 9601
<br>FAX<i> : </i>+1-408 542 9699
<br>(Faxes are answered 8 a.m.-5 p.m., Monday through Friday.)
<br>email: <tt>info@cygnus.com</tt>
<br>Website: <tt>www.cygnus.com</tt><i>.</i>

<p CLASS="BodyHang1"><a NAME="pgfId-1069392"></a><b>Cygnus Japan</b>
<br>Nihon Cygnus Solutions
<br>Madre Matsuda Building
<br>4-13 Kioi-cho Chiyoda-ku
<br>Tokyo 102-0094
<br>Telephone: +81 3 3234 3896
<br>FAX: +81 3 3239 3300
<br>email: <tt>info@cygnus.co.jp</tt>
<br>Website: <tt>http://www.cygnus.co.jp/</tt>

<p CLASS="BodyHang1"><a NAME="pgfId-1069393"></a><b>Cygnus Europe</b>
<br>35-36 Cambridge Place
<br>Cambridge CB2 1NS
<br>United Kingdom
<br>Telephone: +44 1223 728728
<br>FAX: +44 1223 7287777
<br>email: <tt>euroinfo@cygnus.com</tt>

<p CLASS="BodyListFollow"><a NAME="pgfId-1069394"></a>

<p CLASS="Body"><a NAME="pgfId-1069395"></a>Use the hotline (+1 408 542
9601) to get help, although the most reliable and most expedient means
to resolve problems with GNUPro Toolkit is by using the Cygnus Web Support
site:

<p CLASS="BodyListFollow"><a NAME="pgfId-1069396"></a><tt>http://support.cygnus.com</tt>
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<p><a NAME="Table of Contents"></a><b><font size=+3>Table of Contents</font></b>
<br>
<hr WIDTH="100%">
<p><b><font size=-1><a href="#_Toc434049264">Introduction</a></font></b>
<ul><font size=-1><a href="#_Toc434049265">Tool naming conventions</a></font>
<br><font size=-1><a href="#_Toc434049266">Toolkit features</a></font>
<ul><i><font size=-1><a href="#_Toc434049267">Processor version(s)</a></font></i>
<br><i><font size=-1><a href="#_Toc434049269">Hosts Supported</a></font></i>
<br><i><font size=-1><a href="#_Toc434049270">Object file format</a></font></i></ul>
<font size=-1><a href="#_Toc434049271">GNUPro on Windows NT</a></font>
<ul><i><font size=-1><a href="#_Toc434049272">Windows environment settings</a></font></i>
<br><i><font size=-1><a href="#WinNT_heading">Rebuilding from source</a></font></i>
<br><i><font size=-1><a href="#_Toc434049273">Case Sensitivity</a></font></i></ul>
<font size=-1><a href="#BIG_UNIX">GNUPro on Unix</a></font>
<ul><font size=-1><a href="#UNIX_1">eCos Developer's Kit user's</a></font>
<br><font size=-1><a href="#UNIX_2">Sourceware distribution user's</a></font>
<br><font size=-1><a href="#UNIX_3">Unix environment settings</a></font>
<br><font size=-1><a href="#UNIX_4">Rebuilding from source</a></font></ul>
</ul>
<b><font size=-1><a href="#RFS">Rebuilding the GNUPro tools from source</a></font></b>
<p><b><font size=-1><a href="#_Toc434049275">Reference</a></font></b>
<dir><font size=-1><a href="#_Toc434049276">Compiler</a></font>
<dir><i><font size=-1><a href="#_Toc434049277">PowerPC-specific command-line
options</a></font></i>
<br><i><font size=-1><a href="#_Toc434049278">Preprocessor symbols</a></font></i>
<br><i><font size=-1><a href="#_Toc434049279">PowerPC-specific attributes</a></font></i></dir>
<font size=-1><a href="#_Toc434049280">New compiler and linker features</a></font>
<dir><i><font size=-1><a href="#_Toc434049281">Initialization prioritization</a></font></i>
<br><i><font size=-1><a href="#_Toc434049282">Selective linking</a></font></i></dir>
<font size=-1><a href="#_Toc434049283">EABI Summary</a></font>
<dir><i><font size=-1><a href="#_Toc434049284">Data type sizes and alignments</a></font></i>
<br><i><font size=-1><a href="#_Toc434049285">Subroutine calls</a></font></i>
<br><i><font size=-1><a href="#_Toc434049286">The Stack Frame</a></font></i>
<br><i><font size=-1><a href="#_Toc434049287">Parameter Assignment to Registers</a></font></i>
<br><i><font size=-1><a href="#_Toc434049288">Structure passing</a></font></i>
<br><i><font size=-1><a href="#_Toc434049289">Varargs handling</a></font></i>
<br><i><font size=-1><a href="#_Toc434049290">Function Return Values</a></font></i></dir>
<font size=-1><a href="#_Toc434049291">Assembler</a></font>
<dir><i><font size=-1><a href="#_Toc434049292">PowerPC-specific command-line
options</a></font></i>
<br><i><font size=-1><a href="#_Toc434049293">Syntax</a></font></i>
<br><i><font size=-1><a href="#_Toc434049294">Register names</a></font></i>
<br><i><font size=-1><a href="#_Toc434049295">Assembler directives</a></font></i></dir>
<font size=-1><a href="#_Toc434049296">Linker</a></font>
<dir><i><font size=-1><a href="#_Toc434049297">PowerPC-specific command-line
options</a></font></i></dir>
<font size=-1><a href="#_Toc434049298">Debugger</a></font>
<dir><i><font size=-1><a href="#_Toc434049299">PowerPC-specific command-line
options</a></font></i>
<br><i><font size=-1><a href="#_Toc434049300">Debugging programs with multiple
threads</a></font></i></dir>
<font size=-1><a href="#_Toc434049301">Simulator</a></font>
<dir><i><font size=-1><a href="#_Toc434049302">Features</a></font></i>
<br><i><font size=-1><a href="#_Toc434049303">Simulator-specific command
line options</a></font></i>
<br><i><font size=-1><a href="#_Toc434049304">Using the simulator</a></font></i>
<br><i><font size=-1><a href="#_Toc434049305">Simulator exceptions within
GDB</a></font></i></dir>
</dir>
<b><font size=-1><a href="#_Toc434049306">Appendix A: Bibliography</a></font></b>
<br>&nbsp;
<p><a NAME="_Toc434049264"></a><b><font size=+3>Introduction</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><a NAME="_Toc382726584"></a><font size=+0>The GNUPro Toolkit for eCos
is a complete solution for C and C++ development for the PowerPC. The tools
include the compiler, assembler, linker, simulator and interactive debugger.
Simulator, linker and debugger support is also included for the Cogent
CMA287-23 (MPC823), CMA287-50 (MPC850), and CMA286-60 (MPC860) evaluation
boards.&nbsp; In addition to this manual, please read "</font><b><i>Getting
started with eCos</i></b>."</dir>
</dir>
<a NAME="_Toc434049265"></a><b><font size=+2>Tool naming conventions</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>Cross-development tools in the Cygnus GNUPro Toolkit
normally have names that reflect the target processor and the object file
format output by the tools (for example ELF). This makes it possible to
install more than one set of tools in the same binary directory, including
both native and cross-development tools.</font>
<p><font size=+0>The complete tool name is a three-part hyphenated string.
The first part indicates the processor family</font> ('<font face="Courier New"><font size=-1>powerpc</font></font>'<font size=+0>).
The second part is ('</font><font face="Courier New"><font size=-1>eabi</font></font>'<font size=+0>).
The third part is the generic tool name ('</font><font face="Courier New"><font size=-1>gcc</font></font>'<font size=+0>).
For example, the GCC compiler for the Motorola PowerPC is '</font><font face="Courier New"><font size=-1>powerpc-eabi-gcc</font></font>'<font size=+0>.</font>
<p><font size=+0>The Motorola MPC860 package includes the following supported
tools:</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="444" >
<tr>
<td VALIGN=TOP WIDTH="35%"><b><font size=-1>Tool Description</font></b></td>

<td VALIGN=TOP WIDTH="65%"><b><font size=-1>Tool Name</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>GCC compiler</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-gcc</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>C++ compiler</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-c++</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>GAS assembler</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-as</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>GLD linker</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-ld</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>Standalone simulator</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-run</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>Binary Utilities</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-ar</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-nm</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-objcopy</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-objdump</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-ranlib</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-size</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-strings</font></font>
<br><font face="Courier New"><font size=-1>powerpc-eabi-strip</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="35%"><font size=-1>GDB debugger</font></td>

<td VALIGN=TOP WIDTH="65%"><font face="Courier New"><font size=-1>powerpc-eabi-gd</font><font size=-2>b</font></font></td>
</tr>
</table></center>

<dir>
<dir><font size=+0>The binaries for a Windows NT hosted toolchain are installed
with an '</font><font face="Courier New"><font size=-1>.exe</font></font>'<font size=+0>
suffix. However, the '</font><font face="Courier New"><font size=-1>.exe</font></font>'
<font size=+0>suffix
does not need to be specified when running the executable.</font></dir>
</dir>
<a NAME="_Toc399038257"></a><a NAME="_Toc425129974"></a><a NAME="_Toc425237788"></a><a NAME="_Toc425129976"></a><a NAME="_Toc425237790"></a><a NAME="_Toc434049266"></a><b><font size=+2>Toolkit
features</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The following describes PowerPC-specific features of
the GNUPro Toolkit.</font></dir>
</dir>
<a NAME="_Toc434049267"></a><b><font size=+1>Processor version(s)</font></b>
<dir>
<dir><font size=+0>Motorola MPC823, MPC850, and MPC860</font></dir>
</dir>
<a NAME="_Toc434049269"></a><b><font size=+1>Hosts Supported</font></b>
<center><table BORDER CELLPADDING=7 WIDTH="469" >
<tr>
<td VALIGN=TOP WIDTH="23%"><b><font size=+0>CPU</font></b></td>

<td VALIGN=TOP WIDTH="39%"><b><font size=+0>Operating System</font></b></td>

<td VALIGN=TOP WIDTH="39%"><b><font size=+0>Vendor</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="23%"><font size=+0>x86</font></td>

<td VALIGN=TOP WIDTH="39%"><font size=+0>Windows NT 4.0</font></td>

<td VALIGN=TOP WIDTH="39%"><font size=+0>Microsoft</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="23%"><font size=+0>x86</font></td>

<td VALIGN=TOP WIDTH="39%"><font size=+0>Redhat Linux 5.x, 6.0</font></td>

<td VALIGN=TOP WIDTH="39%"><font size=+0>Redhat</font></td>
</tr>
</table></center>
<a NAME="_Toc434049270"></a><b><font size=+1>Object file format</font></b>
<dir>
<dir><font size=+0>The PowerPC tools support the ELF object file format.
Refer to Chapter 4, <b><i>System V Application Binary Interface</i></b>
(Prentice Hall, 1990.). Use '</font><font face="Courier New"><font size=-1>ld</font></font>'<font size=+0>
(refer to <b><i>Using LD</i> in<i> GNUPro Utilities</i></b>) or '</font><font face="Courier New"><font size=-1>objcopy</font></font>'
<font size=+0>(refer
to <b><i>The GNU Binary Utilities</i> in<i> GNUPro Utilities</i></b>) to
produce S-records.</font></dir>
</dir>
<a NAME="_Toc434049271"></a><b><font size=+2>GNUPro on Windows NT</font></b>
<br>
<hr WIDTH="100%">
<br>&nbsp;
<br>&nbsp;
<p><a NAME="_Toc434049272"></a><b><font size=+1>Windows environment settings</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The Windows NT hosted toolchain requires the following
environmental settings to function properly. Assume the release is installed
in:</font>
<p><font face="Courier New"><font size=-1>C:\cygnus\gnupro\i686-cygwin32\powerpc-eabi\<i>&lt;release></i></font></font>
<br>&nbsp;
<dir><font face="Courier New"><font size=-1>SET PROOT=C:\cygnus\gnupro\i686-cygwin32\powerpc-eabi\<i>&lt;release></i></font></font>
<br><a NAME="_Toc368474905"></a><font face="Courier New"><font size=-1>SET
PATH=%PROOT%\H-i686-cygwin32\bin;%PATH%</font></font>
<br><font face="Courier New"><font size=-1>SET INFOPATH=%PROOT%\info</font></font>
<br><font face="Courier New"><font size=-1>REM Set TMPDIR to point to a
ramdisk if you have one</font></font>
<br><font face="Courier New"><font size=-1>SET TMPDIR=C:\TEMP</font></font>
<br>&nbsp;
<p><b><font face="Courier New">Note:</font></b>
<br><font face="Courier New"><font size=-1>The variable '<i>&lt;release></i>'
indicates the release directory name found on the CD.</font></font>
<br>&nbsp;
<br>&nbsp;</dir>
For the Sourceware release of eCos, ensure that the Cygwin B20.1 tools
are also installed. Assuming these are installed in their default location
in
<br>&nbsp;
<dir><font face="Courier New,Courier"><font size=-1>C:\cygnus\cygwin-b20</font></font></dir>
then add the environmental setting
<br>:
<dir><font face="Courier New,Courier"><font size=-1>SET PATH=C:\cygnus\cygwin-b20\H-i586-cygwin32\bin;%PATH%</font></font></dir>
<font size=+0>If you are using the eCos Developer's Kit CD release (not
included in the sourceware release), a working environment can be established
by using the following shortcut from the Windows Start menu:</font>
<br>&nbsp;
<dir><font face="Arial"><font size=-1>Programs->Cygnus eCos->eCos Development
Environment</font></font></dir>
<font size=+0>This will bring up a window running "bash", and your Windows
environment will be automatically set up.</font></dir>
</dir>

<h3>
<a NAME="WinNT_heading"></a>Rebuilding from source
<hr WIDTH="100%"></h3>
If you wish to rebuild the tools from the source code, see the section
"Rebuilding the GNUPro tools from source."
<br>&nbsp;
<p><a NAME="_Toc433628179"></a><a NAME="_Toc434049273"></a><b><font size=+1>Case
Sensitivity</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The following strings are case sensitive under Windows
NT:</font></dir>
</dir>

<ul>
<ul>
<ul>
<li>
<font size=+0>command line options</font></li>

<li>
<font size=+0>assembler labels</font></li>

<li>
<font size=+0>linker script commands</font></li>

<li>
<font size=+0>section names</font></li>
</ul>
</ul>
</ul>

<dir>
<dir><font size=+0>The following strings are not case sensitive under Windows
NT:</font></dir>
</dir>

<ul>
<ul>
<ul>
<li>
<font size=+0>gdb commands</font></li>

<li>
<font size=+0>assembler instructions and register names</font></li>
</ul>
</ul>
</ul>

<dir>
<dir><font size=+0>Case sensitivity for Windows NT is dependent on system
configuration. By default, file names under Windows NT are not case sensitive.</font></dir>
</dir>

<div CLASS="BodyAfterHead">
<h2 CLASS="Heading1">
<a NAME="BIG_UNIX"></a>GNUPro on Unix
<hr WIDTH="100%"></h2>

<div CLASS="Heading1">In the following examples two variables have been
used. The variable '<i><font face="Courier New,Courier"><font size=-1>&lt;version></font></font></i>'
should be replaced with the directory name that the installer made when
the GNUPro tools were installed (or eCos was installed). For example, something
like</div>

<div CLASS="Heading1"><font face="Courier New,Courier"><font size=-1>'ecos-99r1-990828</font></font>'
or '<font face="Courier New,Courier"><font size=-1>gnupro-99r1p1</font></font>'.
The variable '<i><font face="Courier New,Courier"><font size=-1>&lt;host></font></font>'</i>should
be replaced with the "host triplet" of your build system. You can determine
the host triplet by running the script '<font face="Courier New,Courier"><font size=-1>config.guess</font></font>'
at the top of the source tree. Typical examples include '<font face="Courier New,Courier"><font size=-1>i686-cygwin32</font></font>',
'<font face="Courier New,Courier"><font size=-1>i686-pc-linux-gnu</font></font>'
or '<font face="Courier New,Courier"><font size=-1>sparc-sun-solaris2.6</font></font>'.</div>

<h3 CLASS="Heading1">
<a NAME="UNIX_1"></a>eCos Developer's Kit users
<hr WIDTH="100%"></h3>

<div CLASS="Heading1">The eCos Developer's Kit is supplied with tested
prebuilt development tools for this host and target. By default, the installation
script supplied in the tools distribution will install the tools in</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>/usr/cygnus/&lt;version>/H-&lt;host>/bin.</font></font></blockquote>
</div>

<div CLASS="Heading1">If you wish to rebuild the tools from the sources,
then please see the section "Rebuilding the GNUPro tools from source".</div>

<h3 CLASS="Heading1">
<a NAME="UNIX_2"></a>Sourceware distribution users
<hr WIDTH="100%"></h3>

<div CLASS="Heading1">The GNUPro Tools for Redhat Linux are supplied in
a ZIP format file. Detailed instructions for installation can be found
on the eCos sourceware site:</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>http://sourceware.cygnus.com/ecos/</font></font></blockquote>
</div>

<div CLASS="Heading1">By following the instructions there, you should have
the sources installed in:</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>&nbsp;/usr/cygnus/&lt;version>/src</font></font></blockquote>
</div>

<div CLASS="Heading1">and the tools built in:</div>

<blockquote>
<div CLASS="Heading1"><font face="Courier New,Courier"><font size=-1>/usr/cygnus/&lt;version>/H-&lt;host>/bi</font></font>n</div>
</blockquote>

<h3 CLASS="Heading1">
<a NAME="UNIX_3"></a>Unix environment settings
<hr WIDTH="100%"></h3>

<div CLASS="Heading1">After the tools have been built (if applicable) and
installed, we recommend you have the following settings in your appropriate
shell startup script, assuming the tools were installed in '/usr/cygnus/&lt;version>'.</div>

<div CLASS="Heading1">For Bourne shell compatible shells:</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>PROOT=/usr/cygnus/&lt;version></font></font>
<br><font face="Courier New,Courier"><font size=-1>PATH=$PROOT/H-&lt;host>/bin:$PATH</font></font>
<br><font face="Courier New,Courier"><font size=-1>INFOPATH=$PROOT/info:${INFOPATH-/usr/local/info:/usr/info}</font></font>
<br><font face="Courier New,Courier"><font size=-1>MANPATH=$PROOT/man:${MANPATH-/usr/local/man:/usr/man}</font></font>
<br><font face="Courier New,Courier"><font size=-1>export PATH INFOPATH
MANPATH</font></font></blockquote>
</div>

<div CLASS="Heading1">For C-shell compatible shells:</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>setenv PROOT
/usr/cygnus/&lt;version></font></font>
<br><font face="Courier New,Courier"><font size=-1>if ( "$?MANPATH" ==
"0" ) then</font></font>
<br><font face="Courier New,Courier"><font size=-1>setenv MANPATH "/usr/local/man:/usr/man"</font></font>
<br><font face="Courier New,Courier"><font size=-1>endif</font></font>
<br><font face="Courier New,Courier"><font size=-1>if ( "$?INFOPATH" ==
"0" ) then</font></font>
<br><font face="Courier New,Courier"><font size=-1>setenv INFOPATH "/usr/local/info:/usr/info"</font></font>
<br><font face="Courier New,Courier"><font size=-1>endif</font></font>
<br><font face="Courier New,Courier"><font size=-1>setenv MANPATH $PROOT/man:$MANPATH</font></font>
<br><font face="Courier New,Courier"><font size=-1>setenv INFOPATH $PROOT/info:$INFOPATH</font></font>
<br><font face="Courier New,Courier"><font size=-1>set path = ( $PROOT/H-&lt;host>/bin
$path )</font></font></blockquote>
</div>

<h3 CLASS="Heading1">
<a NAME="UNIX_4"></a>Rebuilding from source
<hr WIDTH="100%"></h3>

<div CLASS="Heading1">If you wish to rebuild the tools from the source
code, see the next section "Rebuilding the GNUPro tools from source."</div>

<br>&nbsp;
<br>&nbsp;
<h2 CLASS="Heading1">
<a NAME="RFS"></a>Rebuilding the GNUPro tools from source
<hr WIDTH="100%"></h2>

<div CLASS="Heading1">This section outlines the steps to rebuild the GNUPro
tools from source code.</div>

<div CLASS="Heading1">In the following examples two variables have been
used. The variable '<i><font face="Courier New,Courier"><font size=-1>&lt;version></font></font></i>'
should be replaced with the directory name that the installer made when
the GNUPro tools were installed (or eCos was installed). For example, something
like</div>

<div CLASS="Heading1"><font face="Courier New,Courier"><font size=-1>'ecos-99r1-990828'</font></font>
or '<font face="Courier New,Courier"><font size=-1>gnupro-99r1p1'</font></font>.
The variable '<i><font face="Courier New,Courier"><font size=-1>&lt;host></font></font></i>'
should be replaced with the "host triplet" of your build system. You can
determine the host triplet by running the script '<font face="Courier New,Courier"><font size=-1>config.guess</font></font>'
at the top of the source tree. Typical examples include '<font face="Courier New,Courier"><font size=-1>i686-cygwin32</font></font>',
'<font face="Courier New,Courier"><font size=-1>i686-pc-linux-gnu</font></font>'
or '<font face="Courier New,Courier"><font size=-1>sparc-sun-solaris2.6</font></font>'.</div>

<div CLASS="Heading1">If you wish to rebuild the tools from the sources,
then assuming the sources have been installed into '<font face="Courier New,Courier"><font size=-1>/usr/cygnus/&lt;version>/src'</font></font>,
the steps to take are as follows:
<div CLASS="Heading1">
<ol>
<li>
On Windows hosts, you must start a Cygwin bash shell. Customers with the
eCos Developer's Kit can invoke a bash shell using the following shortcut:</li>
</ol>
</div>

<blockquote>
<div CLASS="Heading1"><font face="Arial,Helvetica">Start->Programs->Cygnus
eCos->eCos Development Environment</font></div>
</blockquote>

<div CLASS="Heading1">
<ol START=2>
<li>
You must have a native GNU compiler ('<font face="Courier New,Courier"><font size=-1>gcc</font></font>')
installed on your system.</li>
</ol>
</div>

<div CLASS="Heading1">
<blockquote>On Windows hosts this will be part of your Cygwin tools installation.</blockquote>
</div>

<ol>
<div CLASS="Heading1">On Unix hosts, if you have not been provided with
a native GNU compiler, you will need to build one from the sources provided.
You can do this by following these instructions but omitting the '--target'&nbsp;
parameter in step 4, and altering step 5 to:</div>

<ol>
<div CLASS="Heading1"><font face="Courier New,Courier"><font size=-1>make
-w all-gcc install LANGUAGES=c > make.out 2>&amp;1</font></font></div>
</ol>
</ol>
</div>

<div CLASS="Heading1">
<div CLASS="Heading1"><b><font size=+1>Warning:</font></b></div>

<div CLASS="Heading1">If you have '<font face="Courier New,Courier">.</font>'&nbsp;
in your PATH environment variable, make sure that it comes after the GNU
native compiler tools directory. The following build procedure will fail
if '<font face="Courier New,Courier">.</font>' is ahead of the GNU native
compiler tools in the path.</div>
</div>
</div>

<div CLASS="Heading1">
<ol START=3>
<li>
Create an object directory for your builds:</li>
</ol>
</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>mkdir /tmp/build</font></font>
<br><font face="Courier New,Courier"><font size=-1>cd /tmp/build</font></font></blockquote>
</div>

<div CLASS="Heading1">
<ol START=4>
<li>
Configure the tools, saving the output to configure.out. Users of the '<font face="Courier New,Courier"><font size=-1>csh</font></font>'
and '<font face="Courier New,Courier"><font size=-1>tcsh</font></font>'
shells should replace</li>

<br>'<font face="Courier New,Courier"><font size=-1>> filename.out 2>&amp;1</font></font>'
with '<font face="Courier New,Courier"><font size=-1>>&amp; filename.out</font></font>'
throughout:</ol>
</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>/usr/cygnus/&lt;version>/src/configure
-v \</font></font>
<br><font face="Courier New,Courier"><font size=-1>&nbsp;--prefix=INSTALLDIR
\</font></font>
<br><font face="Courier New,Courier"><font size=-1>&nbsp;--exec-prefix=INSTALLDIR/H-&lt;host>
\</font></font>
<br><font face="Courier New,Courier"><font size=-1>&nbsp;--target=TARGET
> configure.out 2>&amp;1</font></font></blockquote>
</div>

<div CLASS="Heading1">INSTALLDIR is the installation directory into which
the tools should be installed. If the old tools were to be replaced completely,
this could be set to '<font face="Courier New,Courier"><font size=-1>/usr/cygnus/&lt;version></font></font>',
although if this is done we strongly recommend moving the old tools to
a safe place beforehand.</div>

<div CLASS="Heading1">TARGET is the "target triplet" you are compiling
for. This is the same as the tool name prefix given in the earlier section
"Tool naming conventions."</div>

<div CLASS="Heading1">
<ol START=5>
<li>
Build and install the tools, saving the output to make.out:</li>
</ol>
</div>

<div CLASS="Heading1">
<blockquote><font face="Courier New,Courier"><font size=-1>make -w all
install LANGUAGES="c c++" > make.out 2>&amp;1</font></font></blockquote>
</div>
<a NAME="_Toc434049275"></a><b><font size=+3>Reference</font></b>
<br>
<hr WIDTH="100%">
<br>&nbsp;
<br>&nbsp;
<p><a NAME="_Toc434049276"></a><b><font size=+2>Compiler</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>This section describes PowerPC-specific features of
the GNUPro Compiler.</font></dir>
</dir>
<a NAME="_Ref413205429"></a><a NAME="_Ref413205467"></a><a NAME="_Toc434049277"></a><b><font size=+1>PowerPC-specific
command-line options</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>For a list of available generic compiler options, refer
to "GNU CC Command Options" in <i>Using GNU CC </i>in <b><i>GNUPro Compiler
Tools</i></b>. In addition, the following PowerPC-specific command-line
options are supported:</font>
<p><font size=+0>These '</font><font face="Courier New"><font size=-1>-m</font></font>'<font size=+0>
options are defined for the PowerPC.</font>
<dir>&nbsp;</dir>
<font face="Courier New,Courier"><font size=-1>-mbig</font></font>
<br><font face="Courier New,Courier"><font size=-1>-mbig-endian</font></font>
<dir><font size=+0>This option is on by default. On System V.4 and embedded
PowerPC systems compile code for the processor in big endian mode.</font></dir>
<font face="Courier New,Courier"><font size=-1>-mcpu=860</font></font>
<dir><font size=+0>Specifically set the architecture type, register usage,
choice of mnemonics, and instruction scheduling parameters for machine
type. Supported value is '</font><font face="Courier New"><font size=-1>860</font></font>'<font size=+0>.</font></dir>
<font face="Courier New,Courier"><font size=-1>-mmpc860c0[=NUM]</font></font>
<ol>This option is only applicable to MPC860 chips when producing ELF executables
with the GNU linker. It does not cause any changes to the .o files but
causes the linker to perform a check for "problematic" conditional branches
and implement a work around.
<br>The problem is that some chips may treat the target instruction as
a no-op, given the following conditions:
<br>&nbsp;
<li>
&nbsp;The processor is an MPC860, version C0 or earlier.</li>

<li>
&nbsp;A forward conditional branch is executed.</li>

<li>
&nbsp;The branch is predicted as not taken.</li>

<li>
&nbsp;The branch is taken.</li>

<li>
&nbsp;The branch is located in the last 5 words of a page.</li>

<li>
&nbsp;The branch target is located on a subsequent page.</li>

<p><br>The optional argument is the number of words that are checked at
the end of each text page. It may be any value from 1 to 10 and defaults
to 5.
<br>&nbsp;</ol>
<font face="Courier New,Courier"><font size=-1>-msoft-float</font></font>
<dir><font size=+0>This option is on by default. It causes the compiler
to generate output containing library calls for floating point operations.</font></dir>
</dir>
</dir>
<a NAME="_Toc434049278"></a><b><font size=+1>Preprocessor symbols</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The compiler supports the following preprocessor symbols:</font>
<dir>&nbsp;</dir>
<font face="Courier New,Courier"><font size=-1>__powerpc__</font></font>
<dir><font size=+0>Is always defined.</font></dir>
<font face="Courier New,Courier"><font size=-1>__embedded__</font></font>
<dir><font size=+0>Is always defined.</font></dir>
</dir>
</dir>
<a NAME="_Toc434049279"></a><b><font size=+1>PowerPC-specific attributes</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>There are no PowerPC-specific attributes. See "Declaring
Attributes of Functions" and "Specifying Attributes of Variables" in "Extensions
to the C Language Family" in <i>Using GNU CC</i> in <b><i>GNUPro Compiler
Tools</i></b> for more information.</font></dir>
</dir>
<a NAME="_Toc395075402"></a><a NAME="_Toc415038407"></a>
<p><a NAME="_Toc434049280"></a><b><font size=+2>New compiler and linker
features</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The GNUPro compiler and linker have been improved by
Cygnus to provide even more benefits for customers developing for embedded
targets. These features are guaranteed order of initialization at startup,
and selective linking.</font></dir>
</dir>
<a NAME="_Toc434049281"></a><b><font size=+1>Initialization prioritization</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>In C++, you can define static and global objects with
constructors, or initialize static and global variables from a function.
This means that the constructors or functions are run before the rest of
your program starts. However, when you have these objects spread over multiple
files the C++ standard does not specify the order in which they are initialized,
and for all practical purposes the order is random. For an embedded system,
this can be a problem, as you may want to ensure that a static scheduler
object is initialized before static threads can attach to it, or that devices
are initialized before they are used. GNUPro solves this problem by allowing
you to define a priority when the static or global is declared. The following
example shows the syntax:</font>
<p><font face="Courier New,Courier"><font size=-1>static object_t myobj
__attribute__((init_priority (30000) ));</font></font>
<p><font size=+0>The syntax is slightly different if the object takes any
arguments to its constructor:</font>
<p><font face="Courier New"><font size=-1>static object_t myobj __attribute__((init_priority
(30000) )) = \</font></font>
<br><font face="Courier New"><font size=-1>object_t(arg1, arg2);</font></font>
<p><font size=+0>The numeric priority can be from 1 to 65535, with 1 being
the highest priority, and 65535 being the lowest. The default priority
for objects without this attribute is 65535. Constructors with a higher
priority are guaranteed execution before constructors with lower priority.</font>
<p><font size=+0>In all cases, you must provide the argument '</font><font face="Courier New"><font size=-1>-finit-priority</font></font>'<font size=+0>
to the compiler on its command-line for it to recognize this attribute
when you are compiling your C++ source files.</font>
<p><font size=+0>If you are using eCos, be warned that eCos uses initialization
priorities internally. Ensure you choose an appropriate priority level
so that other eCos subsystems will have initialized before you refer to
them in your own constructor.</font>
<br>&nbsp;
<br>&nbsp;</dir>
</dir>
<a NAME="_Toc434049282"></a><b><font size=+1>Selective linking</font></b>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>When writing C and C++ code, it is sometimes natural
to include more than one function in a source file. For example in C++,
it is common to have all methods for a particular class contained in the
same C++ source file. However, there is a drawback that, conventionally,
if you use just one of these functions, then all the functions defined
in that file also get included in the final executable image. For an embedded
system, this can substantially and unnecessarily increase the size of the
final image stored in ROM, or loaded into RAM when debugging.</font>
<p><font size=+0>The GNUPro C and C++ compilers can now optionally remove
these unnecessary functions from the final image. They also ensure that
any shared global data is removed that is only referenced by functions
that are removed. This can be done by including the options '</font><font face="Courier New"><font size=-1>-ffunction-sections</font></font>'<font size=+0>
and '</font><font face="Courier New,Courier"><font size=-1>-fdata-sections</font></font>'<font size=+0>
on the command-line, when you invoke the C or C++ compiler. The '</font><font face="Courier New"><font size=-1>-ffunction-sections</font></font>'<font size=+0>
option removes unnecessary functions, and the '</font><font face="Courier New,Courier"><font size=-1>-fdata-sections</font></font>'<font size=+0>
option removes unnecessary data.</font>
<p><font size=+0>In addition, when classes define virtual methods in C++,
it is possible to remove any unused methods from the final image by passing
the option</font> '<font face="Courier New"><font size=-1>-fvtable-gc</font></font>'<font size=+0>
to the C++ compiler on its command-line.</font>
<p><font size=+0>In all cases, you must also supply a command-line option
when linking. If invoking the linker ('</font><font face="Courier New,Courier"><font size=-1>ld</font></font><font size=+0>')
directly, use '</font><font face="Courier New"><font size=-1>--gc-sections</font></font>'<font size=+0>
on its command-line; alternatively, if you are using the preferred method
of linking your executable, using the form</font>
<br><font face="Courier New,Courier"><font size=-1>'gcc -o <i>&lt;program
name></i> <i>&lt;file1>.o &lt;file2>.o</i></font></font>'<font size=+0>,
then also pass the option '</font><font face="Courier New"><font size=-1>-Wl,--gc-sections</font></font>'<font size=+0>
on the compiler command-line, for example:</font>
<br>&nbsp;
<dir><font face="Courier New,Courier"><font size=-1>gcc -o prog f1.o f2.o
-Wl,--gc-sections</font></font></dir>
</dir>
</dir>
<a NAME="_Toc434049283"></a><b><font size=+2>EABI Summary</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>This section describes the V.4 EABI. The PowerPC tools
adhere<b> </b>to the V.4 EABI. The Motorola MPC 860 does not have hardware
floating-point support.</font></dir>
</dir>
<a NAME="_Toc434049284"></a><b><font size=+1>Data type sizes and alignments</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The following table shows the size and alignment for
all data types:</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="432" >
<tr>
<td VALIGN=TOP WIDTH="33%"><b><font size=+0>Type</font></b></td>

<td VALIGN=TOP WIDTH="33%"><b><font size=+0>Size (bytes)</font></b></td>

<td VALIGN=TOP WIDTH="33%"><b><font size=+0>Alignment (bytes)</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>char</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>1 byte</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>1 byte</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>short</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>2 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>2 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>int</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>unsigned</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>long</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>long
long</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>8 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>8 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>float</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font face="Courier New"><font size=-1>double</font></font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>8 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>8 bytes</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>pointer</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>

<td VALIGN=TOP WIDTH="33%" HEIGHT="21"><font size=+0>4 bytes</font></td>
</tr>
</table></center>

<ul>
<ul>
<ul>
<li>
<font size=+0>Alignment within aggregates (structs and unions) is as above,
with padding added if needed</font></li>

<li>
<font size=+0>Aggregates have alignment equal to that of their most aligned
member</font></li>

<li>
<font size=+0>Aggregates have sizes which are a multiple of their alignment</font></li>
</ul>
</ul>
</ul>
<a NAME="_Toc434049285"></a><b><font size=+1>Subroutine calls</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The following describes the calling conventions for
subroutine calls. The first table outlines the registers used for passing
and returning parameters. The second table outlines other register usage.</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="342" >
<tr>
<td VALIGN=TOP COLSPAN="2"><b>Parameter registers:</b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>general-purpose</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r3-r10</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>return general-purpose</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r3-r4</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>floating point</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>f1-f8</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>return floating point</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>f1</font></font></td>
</tr>
</table></center>

<center><table BORDER CELLPADDING=7 WIDTH="342" >
<tr>
<td VALIGN=TOP COLSPAN="2"><b>Register usage:</b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>function linkage</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r0, r11,
r12, r31</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>stack pointer</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r1</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>kernel reserved</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r2</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>small data pointer</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r13</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>volatile</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r0, r3-r13,
f0-f13, lr, ctr, xer, fpscr, cr0, cr1, cr5-cr7</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>non-volatile</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>r14-r31,
f14-f31</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="47%"><font size=+0>return address</font></td>

<td VALIGN=TOP WIDTH="53%"><font face="Courier New"><font size=-1>lr</font></font></td>
</tr>
</table></center>

<ul>
<ul>
<ul>
<li>
<font size=+0>General-purpose and floating-point parameter registers are
allocated independently.</font></li>

<li>
<font size=+0>Structures that are less than or equal to 32 bits are passed
as values.</font></li>

<li>
<a NAME="_Toc395075405"></a><a NAME="_Toc415038408"></a><font size=+0>Structures
that are greater than 32 bits are passed as pointers.</font></li>

<li>
<font size=+0>Bit 6 of '</font><font face="Courier New"><font size=-1>cr1</font></font>'
<font size=+0>is
set if a variable-argument function is passed floating-point arguments
in registers.</font></li>
</ul>
</ul>
</ul>
<a NAME="_Toc434049286"></a><b><font size=+1>The Stack Frame</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>This section describes the PowerPC stack frame:</font></dir>
</dir>

<ul>
<ul>
<ul>
<li>
<font size=+0>The stack grows downwards from high addresses to low addresses.</font></li>

<li>
<font size=+0>A leaf function need not allocate a stack frame if it does
not need one.</font></li>

<li>
<font size=+0>A frame pointer need not be allocated.</font></li>

<li>
<font size=+0>The stack pointer shall always be aligned to 4 byte boundaries.</font></li>
</ul>
</ul>
</ul>

<dir>
<dir><font size=+0>Stack frames for functions that take a fixed number
of arguments look like this:</font>
<br>&nbsp;
<br>&nbsp;
<p><img SRC="Image10.gif" height=528 width=327>
<p><font size=+0>When alloca is executed, the back chain to the caller's
stack frame and the link register save area must be updated.</font>
<p><font size=+0>The parameter save area does not contain space to store
the 8 integer arguments. If it is desired that they be stored, the callee
must allocate space to save it in the local variable area of the stack.
Structures and unions are copied into temporary slots and an address of
the temporary slot is passed as the argument.</font>
<br>&nbsp;</dir>
</dir>

<hr WIDTH="100%">
<dir>
<dir>&nbsp;
<p><font size=+0>Stack frames for functions that take a variable number
of arguments look like this:</font>
<p><img SRC="Image11.gif" height=538 width=336>
<br>&nbsp;
<br>&nbsp;</dir>
</dir>
<a NAME="_Toc434049287"></a><b><font size=+1>Parameter Assignment to Registers</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>Consider the parameters in a function call as ordered
from left (first parameter) to right. In this algorithm, 'FR</font>'<font size=+0>
contains the number of the next available</font>
<br><font size=+0>floating-point register, 'GR</font>'<font size=+0> contains
the number of the next available general-purpose register, and 'STARG</font>'<font size=+0>
is the address of the next available stack parameter word.</font></dir>
</dir>
<b>INITIALIZE:</b>
<dir>
<dir><font size=+0>Set 'GR=r3</font>'<font size=+0>, </font>'<font size=+0>FR=f1</font>'<font size=+0>,
and 'STARG</font>'<font size=+0> to point to parameter word 1.</font></dir>
</dir>
<b>SCAN:</b>
<dir>
<dir><font size=+0>If there are no more parameters, terminate. Otherwise,
select one of the following depending on the type of the next parameter:</font>
<p><b><font size=+0>DOUBLE OR FLOAT:</font></b>
<p><font size=+0>If 'FR > f8</font>'<font size=+0>, go to 'STACK</font>'<font size=+0>.
Otherwise, load the parameter value into</font>
<br><font size=+0>floating-point register 'FR</font>' <font size=+0>and
advance 'FR</font>'<font size=+0> to the next floating-point register.
Then go to 'SCAN</font>'<font size=+0>.</font>
<p><b><font size=+0>SIMPLE ARG:</font></b>
<p><font size=+0>A SIMPLE ARG is one of the following:</font></dir>
</dir>

<ul>
<ul>
<ul>
<li>
<font size=+0>One of the simple integer types which will fit into a general-purpose
register</font></li>

<li>
<font size=+0>A pointer to an object of any type</font></li>

<li>
<font size=+0>A struct or union small enough to fit in a register</font></li>

<li>
<font size=+0>A larger struct or union, which shall be treated as a pointer
to a copy of that object</font></li>
</ul>
</ul>
</ul>

<dir>
<dir><font size=+0>If 'GR > r10</font>'<font size=+0>, go to </font>'<font size=+0>STACK</font>'<font size=+0>.
Otherwise, load the parameter value into general-purpose register </font>'<font size=+0>GR</font>'<font size=+0>
and advance </font>'<font size=+0>GR</font>'<font size=+0> to the next
general-purpose register. Values shorter than the register size are sign-extended
or zero-extended depending on whether they are signed or unsigned. Then
go to </font>'<font size=+0>SCAN</font>'<font size=+0>.</font>
<p><b><font size=+0>LONG LONG:</font></b>
<p><font size=+0>If </font>'<font size=+0>GR > r8</font>'<font size=+0>,
go to </font>'<font size=+0>STACK</font>'<font size=+0>. Otherwise, if
</font>'<font size=+0>GR</font>'<font size=+0>
is even, advance </font>'<font size=+0>GR</font>'<font size=+0> to the
next register. Load the 64-bit </font>'<font face="Courier New"><font size=-1>long
long</font></font>'<font size=+0> value into register pair </font>'<font size=+0>GR</font>'<font size=+0>
and </font>'<font size=+0>GR+1</font>'<font size=+0>. Advance </font>'<font size=+0>GR</font>'<font size=+0>
to </font>'<font size=+0>GR+2</font>'<font size=+0> and go to </font>'<font size=+0>SCAN</font>'<font size=+0>.</font>
<br>&nbsp;
<p><b><font size=+0>STACK:</font></b>
<p><font size=+0>Parameters not otherwise handled above are passed in the
parameter words of the caller's stack frame. SIMPLE ARGs, as defined above,
are considered to have size and alignment equal to the size of a general-purpose
register, with simple argument types shorter than this sign-extended or
zero-extended to this width. '</font><font face="Courier New,Courier"><font size=-1>float</font></font><font size=+0>'
arguments are considered to have size and alignment equal to the 32 bits.
'</font><font face="Courier New"><font size=-1>double</font></font>'<font size=+0>
and '</font><font face="Courier New"><font size=-1>long long</font></font>'<font size=+0>
are considered to have size and alignment equal to 64 bits. Round 'STARG</font>'<font size=+0>
up to a multiple of the alignment requirement of the parameter and copy
the argument byte-for-byte into 'STARG</font>'<font size=+0>, 'STARG+1</font>'<font size=+0>,
... 'STARG+size-1</font>'<font size=+0>. Set 'STARG</font>'<font size=+0>
to 'STARG+size</font>'<font size=+0> and go to 'SCAN</font>'<font size=+0>.</font></dir>
</dir>
<a NAME="_Toc434049288"></a><b><font size=+1>Structure passing</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>As noted above, code, which passes structures and unions
by value is implemented specially; in this section, "struct" will refer
to structures and unions inclusively. Structs small enough to fit in a
register are passed by value in a single general-purpose register or in
a 32-bit stack slot. Larger structures are handled by the caller making
a copy of the structure, in order to preserve the pass-by-value semantics,
and passing a pointer to the copy. The copy is made in the local variable
area of the caller's stack.</font></dir>
</dir>
<a NAME="_Toc434049289"></a><b><font size=+1>Varargs handling</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>Varargs are handled differently in the V.4 EABI than
they are for most other ABIs. Variable argument functions must store the
registers used for passing arguments that aren't used for fixed arguments
into a 96-word area in the local variable section of the stack. If bit
6 of the CR is not 1, it doesn't have to save the floating-point registers.
The V.4 EABI never passes floating-point arguments in general-purpose registers.
The registers used to hold arguments are saved in a separate save area,
and '</font><font face="Courier New"><font size=-1>va_list</font></font>'<font size=+0>
is an array of 1 element of a structure that contains pointers to the stack
and register save area, and two char values indicating how many general-purpose
and floating-point registers have been processed.</font>
<p><font size=+0>The '</font><font face="Courier New"><font size=-1>va_list</font></font>'<font size=+0>
type is defined as follows:</font>
<br>&nbsp;
<dir><font face="Courier New,Courier"><font size=-1>typedef struct {</font></font>
<dir><font face="Courier New,Courier"><font size=-1>char gpr; /* index
to next saved gp register */</font></font>
<br><font face="Courier New,Courier"><font size=-1>char fpr; /* index to
next saved fp register */</font></font>
<br><font face="Courier New,Courier"><font size=-1>char *ovf_arg_area;
/* pointer to next overflow arg */</font></font>
<br><font face="Courier New,Courier"><font size=-1>char *reg_save_area;
/* pointer to register save area */</font></font></dir>
<font face="Courier New,Courier"><font size=-1>} va_list[1];</font></font></dir>
</dir>
</dir>
<a NAME="_Toc434049290"></a><b><font size=+1>Function Return Values</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>Data types and register usage for return values:</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="438" >
<tr>
<td VALIGN=TOP WIDTH="33%"><b><font size=+0>Type</font></b></td>

<td VALIGN=TOP WIDTH="67%"><b><font size=+0>Register</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>int</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>r3</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>short</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>r3</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>long</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>r3</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>long
long</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>r3+r4</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>float</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>f1</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>double</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>f1</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="33%" HEIGHT="22"><font face="Courier New,Courier"><font size=-1>struct/union</font></font></td>

<td VALIGN=TOP WIDTH="67%" HEIGHT="22"><font size=+0>see below</font></td>
</tr>
</table></center>

<dir>
<dir><font size=+0>Structures and unions that will fit into two general-purpose
registers are returned in '</font><font face="Courier New"><font size=-1>r3</font></font>'<font size=+0>,
or in '</font><font face="Courier New"><font size=-1>r3</font></font>'<font size=+0>
and </font>'<font face="Courier New"><font size=-1>r4</font></font>'<font size=+0>
if necessary. The caller handles larger structures and unions by passing,
as a "hidden" first argument, a pointer to space allocated to receive the
return value.</font></dir>
</dir>
<a NAME="_Toc415038410"></a><a NAME="_Toc434049291"></a><b><font size=+2>Assembler</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><a NAME="_Toc415038411"></a><font size=+0>This section describes PowerPC-specific
features of the GNUPro Assembler.</font></dir>
</dir>
<a NAME="_Toc434049292"></a><b><font size=+1>PowerPC-specific command-line
options</font></b>
<hr WIDTH="100%">
<br>&nbsp;
<dir>
<dir><font size=+0>For a list of available generic assembler options, refer
to "Command-Line Options" in <i>Using AS</i> in <b><i>GNUPro Utilities</i></b>.</font></dir>
</dir>
<a NAME="wednesday"></a><a NAME="_Toc415038412"></a><a NAME="_Toc434049293"></a><b><font size=+1>Syntax</font></b>
<hr WIDTH="100%">
<br>&nbsp;
<dir>
<dir><a NAME="_Ref371824657"></a><font size=+0>For more information about
the PowerPC instruction set and PowerPC assembly conventions, see <b><i>The
PowerPC (tm) Architecture:A SPECIFICATION FOR A NEW FAMILIY OF RISC PROCESSORS
</i></b>(Morgan
Kaufmann Publishers, Inc.)</font>
<br><font size=+0>or</font>
<br><font size=+0><b><i>PowerPC (tm) Microprocessor Family:The Programming
Environments </i></b>(Published by both IBM (MPRPPCFPE-01) and Motorola
(MPCFPE/AD))</font></dir>
</dir>
<a NAME="_Toc415038413"></a><a NAME="_Toc434049294"></a><b><font size=+1>Register
names</font></b>
<hr WIDTH="100%">
<br>&nbsp;
<dir>
<dir><font size=+0>There are 32 32-bit general (integer) registers, named
'</font><font face="Courier New,Courier"><font size=-1>r0</font></font>'
<font size=+0>through
</font>'<font face="Courier New"><font size=-1>r31</font></font>'<font size=+0>.
There are 32 64-bit floating-point registers, named '</font><font face="Courier New"><font size=-1>f0</font></font><font size=+0>'
through '</font><font face="Courier New"><font size=-1>f31</font></font><font size=+0>'.</font>
<p><font size=+0>The compiler will generate assembly code, which uses the
numbers </font>'<font size=+0>0</font>'<font size=+0> through </font>'<font size=+0>31</font>'<font size=+0>
to represent general-purpose registers.</font>
<p><font size=+0>The following symbols can be used as aliases for individual
registers:</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="264" >
<tr>
<td VALIGN=TOP WIDTH="41%"><b><font size=+0>Symbol</font></b></td>

<td VALIGN=TOP WIDTH="59%"><b><font size=+0>Register</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="41%"><font face="Courier New,Courier"><font size=-1>sp</font></font></td>

<td VALIGN=TOP WIDTH="59%"><font face="Courier New,Courier"><font size=-1>r1</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="41%"><font face="Courier New,Courier"><font size=-1>toc</font></font></td>

<td VALIGN=TOP WIDTH="59%"><font face="Courier New,Courier"><font size=-1>r2</font></font></td>
</tr>
</table></center>

<dir>
<dir><font size=+0>Furthermore, the GNU tools recognize the PowerPC's special
registers:</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="258" >
<tr>
<td VALIGN=TOP WIDTH="42%"><b><font size=+0>Symbol</font></b></td>

<td VALIGN=TOP WIDTH="58%"><b><font size=+0>Register</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="42%"><font face="Courier New"><font size=-1>lr</font></font></td>

<td VALIGN=TOP WIDTH="58%"><font size=+0>the link register</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="42%"><font face="Courier New"><font size=-1>ctr</font></font></td>

<td VALIGN=TOP WIDTH="58%"><font size=+0>the count register</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="42%"><font face="Courier New"><font size=-1>cr0 ...
cr7</font></font></td>

<td VALIGN=TOP WIDTH="58%"><font size=+0>the condition registers</font></td>
</tr>
</table></center>

<dir>
<dir><font size=+0>Other PowerPC special registers (</font>'<font face="Courier New"><font size=-1>xer</font></font>'<font size=+0>,
</font>'<font face="Courier New"><font size=-1>fpscr</font></font>'<font size=+0>,
etc.) are supported by the GNU tools, but do not have names since they
are used implicitly by specific instructions (</font>'<font face="Courier New"><font size=-1>qv:
mcrxr</font></font>'<font size=+0>): these registers may also be referenced
in assembly language by number.</font></dir>
</dir>
<a NAME="_Toc434049295"></a><b><font size=+1>Assembler directives</font></b>
<br>
<hr WIDTH="100%">
<br>&nbsp;
<ul><font size=+0>This is a complete list of the PowerPC assembler directives.</font></ul>

<center><table BORDER CELLPADDING=7 WIDTH="528" >
<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.abicalls</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb.b</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.fail</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.irepc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.psize</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.abort</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb.d</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.file</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.irp</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.purgem</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.aent</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb.l</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.fill</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.irpc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.quad</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.align</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb.s</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.float</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.lcomm</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.rdata</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.appfile</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb.w</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.fmask</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.lflags</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.rep</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.appline</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb.x</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.format</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.linkonce</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.rept</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ascii</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.debug</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.frame</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.list</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.rva</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.asciiz</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.double</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.global</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.livereg</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.sbttl</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.asciz</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.globl</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.llen</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.sdata</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.balign</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.b</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.gpword</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.loc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.set</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.balignl</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.d</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.half</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.long</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.short</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.balignw</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.l</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.hword</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.lsym</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.single</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.bgnb</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.p</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.if</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.macro</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.skip</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.bss</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.s</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.mask</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.space</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.byte</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.w</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifdef</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.mexit</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.spc</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.comm</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ds.x</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifeq</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.mri</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.stabd</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.common</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dword</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifeqs</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.name</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.stabn</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.common.s</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.eject</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifge</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.noformat</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.stabs</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.cpadd</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.else</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifgt</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.nolist</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.string</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.cpload</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.elsec</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifle</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.nopage</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.struct</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.cprestore</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.end</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.iflt</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.octa</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.text</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.data</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.endb</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifnc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.offset</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.title</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.endc</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifndef</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.option</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ttl</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc.b</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.endif</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifne</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.org</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.verstamp</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc.d</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ent</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifnes</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.p2align</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.word</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc.l</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.equ</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.ifnotdef</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.p2alignl</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.xcom</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc.s</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.equiv</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.include</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.p2alignw</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.xdef</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc.w</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.err</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.insn</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.page</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.xref</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dc.x</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.exitm</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.int</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.plen</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.xstabs</font></font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.dcb</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.extern</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.irep</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.print</font></font></td>

<td VALIGN=TOP WIDTH="20%" HEIGHT="22"><font face="Courier New"><font size=-1>.zero</font></font></td>
</tr>
</table></center>

<br>&nbsp;
<p><a NAME="_Toc434049296"></a><b><font size=+2>Linker</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>eCos generates linker scripts appropriate for the exact
eCos configuration<b> </b>you have chosen. Instructions on how to use this
linker script are provided<b> </b>in the manual <b><i>Getting Started with
eCos</i>.</b></font></dir>
</dir>
<a NAME="_Toc434049297"></a><font size=+1>PowerPC-specific command-line
options</font>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>For a list of available generic linker options, refer
to "Command Language" in <i>Using LD</i> in <b><i>GNUPro Utilities</i></b>.
There is only one PowerPC-specific command-line linker option.</font>
<p><font face="Courier New,Courier"><font size=-1>--mpc860c0[=NUM]</font></font>
<ol>This option is only applicable to MPC860 chips when producing ELF executables
with the GNU linker. It causes the linker to perform a check for problematic
conditional branches and implement a work around.
<p>The problem is that some chips may treat the target instruction as a
no-op, given the following conditions:
<br>&nbsp;
<li>
&nbsp;The processor is an MPC860, version C0 or earlier.</li>

<li>
&nbsp;A forward conditional branch is executed.</li>

<li>
&nbsp;The branch is predicted as not taken.</li>

<li>
&nbsp;The branch is taken.</li>

<li>
&nbsp;The branch is located in the last 5 words of a page.</li>

<li>
&nbsp;The branch target is located on a subsequent page.</li>

<p><br>The optional argument is the number of words that are checked at
the end of each text page. It may be any value from 1 to 10 and defaults
to 5.
<br>The problem is avoided by changing problematic branches to be predicted
as taken.
<br>&nbsp;</ol>
</dir>
</dir>
<a NAME="_Ref372526299"></a><a NAME="_Ref372526330"></a><a NAME="_Toc434049298"></a><b><font size=+2>Debugger</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>This section describes PowerPC-specific features of
the GNUPro Debugger.</font>
<br><font size=+0>For debugging examples, see chapter "Run an eCos test
case" in<i> <b>Getting Started with eCos</b></i></font>
<p><font size=+0>There are two ways for GDB to talk to a PowerPC target.</font></dir>
</dir>

<ol>
<ol>
<li>
<font size=+0>Simulator:</font></li>

<br><font size=+0>eCos may be build for the minimal simulator with RAM
startup. Linking your program against the eCos </font>'<font face="Courier New"><font size=-1>libtarget.a</font></font>'<font size=+0>
library, and with the </font>'<font face="Courier New"><font size=-1>target.ld</font></font>'<font size=+0>
linker script will produce the correct final executable that should be
loaded into the simulator.</font>
<p><b><i><font size=+0>Note:</font></i></b>
<br><font size=+0>Loading binaries into the simulator that were built for
real hardware with RAM startup will not work.</font>
<p><font size=+0>To activate the simulator in GDB, follow the instructions
in the Simulator section later in this document.</font>
<br>&nbsp;
<li>
<font size=+0>Remote target board:</font></li>

<br><font size=+0>To load your program onto the standard evaluation board,
build eCos for the hardware with RAM startup. Provided the board is fitted
with the GDB loader stub ROM, you may connect to the target board in GDB
using the command </font>'<font face="Courier New"><font size=-1>target
remote <i>&lt;devicename></i></font></font>'<font size=+0> where </font>'<i><font face="Courier New"><font size=-1>&lt;devicename></font></font></i>'<font size=+0>
will be a serial device such as </font>'<font face="Courier New"><font size=-1>com2</font></font>'<font size=+0>
(Windows NT) or </font>'<font face="Courier New"><font size=-1>/dev/ttyS1</font></font>'<font size=+0>
(Linux). Then load the code onto the target board by typing </font>'<font face="Courier New"><font size=-1>load</font></font>'<font size=+0>.
After being downloaded, the program can be executed.</font></ol>
</ol>

<dir>
<dir><b><font size=+0><i>Note</i>:</font></b>
<br><font size=+0>When using the remote target, GDB does not accept the
</font>'<font face="Courier New"><font size=-1>run</font></font>'<font size=+0>
command. However, since downloading the program has the side effect of
setting the PC to the start address, you can start your program by typing
</font>'<font face="Courier New"><font size=-1>continue</font></font>'<font size=+0>
(the letter </font>'<font face="Courier New"><font size=-1>c</font></font>'<font size=+0>
works as a shortcut for the </font>'<font face="Courier New,Courier"><font size=-1>continue</font></font>'<font size=+0>
command).</font></dir>
</dir>
<a NAME="_Toc434049299"></a><b><font size=+1>PowerPC-specific command-line
options</font></b>
<hr WIDTH="100%">
<br>&nbsp;
<dir>
<dir><font size=+0>For the available generic debugger options, refer to
<i>Debugging
with GDB</i> in <b><i>GNUPro Debugging Tools</i></b>. There are no PowerPC
specific debugger command-line options.</font></dir>
</dir>
<a NAME="_Ref370778797"></a><a NAME="_Toc386594255"></a><a NAME="_Toc390691984"></a><a NAME="_Toc390692120"></a><a NAME="_Toc401042769"></a><a NAME="_Toc401633243"></a>
<p><a NAME="_Toc434049300"></a><b><font size=+1>Debugging programs with
multiple threads</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>Programs with multiple threads can be debugged using
either the graphic user interface to GDB, GDBTk or the GDB command line
interface. The following describes how to debug multiple threads using
the GDB command line.</font>
<p><font size=+0>In some operating systems, such as eCos, a single program
may have more than one thread of execution. The precise semantics of threads
differ from one operating system to another, but in general the threads
of a single program are akin to multiple processes, except that they share
one address space (that is, they can all examine and modify the same variables).
On the other hand, each thread has its own registers and execution stack,
and perhaps private memory.</font>
<p><font size=+0>GDB provides the following functions for debugging multi-thread
programs</font></dir>
</dir>

<ul>
<ul>
<ul>
<li>
'<font face="Courier New"><font size=-1>thread <i>threadno</i></font></font>'<font size=+0>,
a command to switch among threads</font></li>

<li>
'<font face="Courier New,Courier"><font size=-1>info threads</font></font>'<font size=+0>,
a command to inquire about existing threads</font></li>

<li>
'<font face="Courier New,Courier"><font size=-1>thread apply [<i>threadno</i>][<i>all</i>]
<i>args</i></font></font>'<font size=+0>,
a command to apply a command to a list of threads</font></li>

<li>
<font size=+0>thread-specific breakpoints</font></li>
</ul>
</ul>
</ul>

<dir>
<dir><font size=+0>The GDB thread-debugging facility allows you to observe
all threads while your program runs, but whenever GDB takes control, one
thread in particular is always the focus of debugging. This thread is called
the current thread. Debugging commands show program information from the
perspective of the current thread.</font>
<p><font size=+0>For debugging purposes, GDB associates its own thread
number, always a single integer, with each thread in your program.</font>
<p><font face="Courier New,Courier"><font size=-1>info threads</font></font>
<dir><font size=+0>Display a summary of all threads currently in your program.
GDB displays for each thread (in the following order):</font></dir>
</dir>
</dir>

<ol>
<dir>
<dir>
<ol>
<li>
<font size=+0>The thread number assigned by GDB.</font></li>

<li>
<font size=+0>The target system's thread I.D.</font></li>

<li>
<font size=+0>The current stack frame summary for that thread.</font></li>
</ol>
</dir>
</dir>
</ol>

<dir>
<dir>
<dir><font size=+0>An asterisk '</font><font face="Courier New"><font size=-1>*</font></font>'<font size=+0>
to the left of the GDB thread number indicates the current thread. Use
the following example for clarity.</font></dir>

<dir><font face="Courier New,Courier"><font size=-1><b>(gdb)</b> info threads</font></font>
<br><b><font face="Courier New,Courier"><font size=-1>* 2 thread 2 breakme
()</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>at /eCos/packages/kernel/v1_2_1/tests/thread_gdb.c:91</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>Name: controller,
State: running, Priority: 0, More: &lt;none></font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>1 thread 1 Cyg_HardwareThread::thread_entry
(thread=0x1111aaa2)</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>at /eCos/packages/kernel/v1_2_1/src/common/thread.cxx:68</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>Name: Idle Thread,
State: running, Priority: 31, More: &lt;none></font></font></b></dir>
<font face="Courier New,Courier"><font size=-1>thread <i>&lt;threadno></i></font></font>
<dir><font size=+0>Make thread number </font>'<i><font face="Courier New"><font size=-1>&lt;threadno></font></font></i>'
<font size=+0>the
current thread. The command argument, </font>'<i><font face="Courier New"><font size=-1>&lt;threadno></font></font></i>'<font size=+0>,
is the internal GDB thread number, as shown in the first field of the </font>'<font face="Courier New"><font size=-1>info
threads</font></font>'<font size=+0> display. GDB responds by displaying
the system identifier of the thread you selected, and its current stack
frame summary, as in the following output.</font>
<p><font face="Courier New,Courier"><font size=-1><b>(gdb) </b>thread 2</font></font>
<br><b><font face="Courier New,Courier"><font size=-1>[Switching to thread
2]</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>#0 change_state (id=0,
newstate=0 '\000')</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>at /eCos/kernel/current/tests/bin_sem2.cxx:93</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>93 if (PHILO_LOOPS
== state_changes++)</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>Current language:
auto; currently c++</font></font></b></dir>

<p><br><font face="Courier New,Courier"><font size=-1>thread apply [<i>&lt;threadno></i>][<i>&lt;all></i>]
<i>&lt;args></i></font></font>
<dir><font size=+0>The thread apply command allows you to apply a command
to one or more threads. Specify the numbers of the threads that you want
affected with the command argument </font>'<i><font face="Courier New"><font size=-1>&lt;threadno></font></font></i>'<font size=+0>,
where</font><i><font face="Courier New"><font size=-2> </font></font></i>'<i><font face="Courier New"><font size=-1>&lt;threadno></font></font></i>'<font size=+0>
is the internal GDB thread number, as shown in the first field of the </font>'<font face="Courier New"><font size=-1>info
threads</font></font>'<font size=+0> display. To apply a command to all
threads, use </font>'<font face="Courier New"><font size=-1>thread apply
all args</font></font>'<font size=+0>.</font></dir>
<font size=+0>Whenever GDB stops your program, due to a breakpoint or a
signal, it automatically selects the thread where that breakpoint or signal
happened.</font>
<p><font size=+0>When your program has multiple threads, you can choose
whether to set breakpoints on all threads, or on a particular thread.</font>
<br>&nbsp;
<dir><font face="Courier New"><font size=-1>break <i>&lt;linespec></i>
thread <i>&lt;threadno></i></font></font></dir>
<font size=+0>If </font>'<i><font face="Courier New"><font size=-1>&lt;linespec></font></font></i>'<font size=+0>
specifies source lines, then there are several ways of writing them. Use
the qualifier </font>'<font face="Courier New"><font size=-1>thread <i>&lt;threadno></i></font></font>'<font size=+0>
with a breakpoint command to specify that you only want GDB to stop the
program when a particular thread reaches this breakpoint. </font>'<i><font face="Courier New"><font size=-1>&lt;threadno></font></font></i>'<font size=+0>
is one of the numeric thread identifiers assigned by GDB, shown in the
first column of the </font>'<font face="Courier New,Courier"><font size=-1>info
threads</font></font><font size=+0>' display.</font>
<p><font size=+0>If you do not specify </font>'<font face="Courier New"><font size=-1>thread
<i>&lt;threadno></i></font></font>'<font size=+0>
when you set a breakpoint, the breakpoint applies to all threads of your
program.</font>
<p><font size=+0>You can use the thread qualifier on conditional breakpoints
as well; in this case, place </font>'<font face="Courier New"><font size=-1>thread
<i>&lt;threadno></i></font></font>'<font size=+0>
before the breakpoint condition, as the following example shows.</font>
<br>&nbsp;
<dir><font face="Courier New,Courier"><font size=-1><b>(gdb</b>) break
frik.c:13 thread 28 if bartab > lim</font></font></dir>
<font size=+0>Whenever your program stops under GDB for any reason, all
threads of execution stop; not just the current thread. This allows you
to examine the overall state of the program, including switching between
threads, without worrying that things may change.</font>
<p><font size=+0>Conversely, whenever you restart the program, all threads
start executing. This is true even when single stepping with commands like
</font>'<font face="Courier New"><font size=-1>step</font></font>'<font size=+0>
or </font>'<font face="Courier New"><font size=-1>next</font></font>'<font size=+0>.
In particular, GDB cannot single-step all threads in lockstep. Since thread
scheduling is up to your debugging target</font>'<font size=+0>s operating
system (not controlled by GDB), other threads may execute more than one
statement while the current thread completes a single step. In general
other threads stop in the middle of a statement, rather than at a clean
statement boundary, when the program stops.</font>
<p><font size=+0>You might even find your program stopped in another thread
after continuing or even single stepping. This happens whenever some other
thread runs into a breakpoint, a signal, or an exception before the first
thread completes whatever you requested.</font>
<br>&nbsp;
<br>&nbsp;</dir>
<b><font size=+0>SET SCHEDULER-LOCKING</font></b>
<br>&nbsp;
<dir><font size=+0>For targets that support it, GDB has a new command that
helps to debug</font>
<br><font size=+0>multi-threaded programs. The </font>'<font face="Courier New,Courier"><font size=-1>set
scheduler-locking [on off step]</font></font>'<font size=+0> command allows
the GDB user to exert some control over how threads are scheduled while
debugging.</font>
<p><font size=+0>Normally GDB does not attempt to interfere with thread
scheduling. This means that in the default mode (</font>'<font face="Courier New,Courier"><font size=-1>scheduler-locking
off</font></font>'<font size=+0>), the current thread may be scheduled
out, and a different thread may begin running, at any time (as determined
by the native scheduler). For instance, you may give a GDB command such
as </font>'<font face="Courier New,Courier"><font size=-1>step</font></font>'<font size=+0>
or </font>'<font face="Courier New,Courier"><font size=-1>finish</font></font>'<font size=+0>,
and when the command completes, you may be looking at a different thread.</font>
<p><font size=+0>If you set the scheduler-locking mode to </font>'<font face="Courier New,Courier"><font size=-1>step</font></font>'<font size=+0>,
then GDB will try to interfere with the native scheduler just enough to
prevent another thread from popping up while you debug. Other threads may
get to run sometimes, but whenever a command such as </font>'<font face="Courier New,Courier"><font size=-1>step</font></font>'<font size=+0>
or </font>'<font face="Courier New,Courier"><font size=-1>finish</font></font>'<font size=+0>
completes, you should be looking at the same thread that was running before
the command. Of course, if another thread gets to run and hits a breakpoint,
GDB will still switch you to that thread (so if you don</font>'<font size=+0>t
want that to happen, then disable your breakpoints).</font>
<p><font size=+0>For even greater (and more intrusive) control over the
thread scheduler, GDB provides the mode </font>'<font face="Courier New,Courier"><font size=-1>scheduler-locking
on</font></font>'<font size=+0>. In this mode, the native scheduler is
completely locked, and no thread may run except the current one. Obviously
this will radically change the behavior of your program, and may lead to
deadlock or other unpleasant consequences, so use it with caution.</font>
<p><b><font size=+0>Syntax:</font></b>
<p><font face="Courier New,Courier"><font size=-1>set scheduler-locking
[off on step]</font></font>
<dir><font size=+0>Set mode for locking scheduler during target execution.</font></dir>
<font face="Courier New,Courier"><font size=-1>off</font></font>
<dir><font size=+0>No locking (threads may preempt at any time).</font></dir>
<font face="Courier New,Courier"><font size=-1>on</font></font>
<dir><font size=+0>Full locking (no thread except the current thread may
run).</font></dir>
<font face="Courier New,Courier"><font size=-1>step</font></font>
<dir><font size=+0>The scheduler is locked during every single-step operation.
In this mode, no other thread may run during a step command. However, other
threads may run while stepping over a function call (</font>'<font face="Courier New,Courier"><font size=-1>next</font></font>'<font size=+0>).</font></dir>
</dir>
</dir>
<a NAME="_Toc414871787"></a><a NAME="_Toc434049301"></a><b><font size=+2>Simulator</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>The GNUPro simulator allows execution of a program compiled
for the PowerPC target CPU on any supported host computer. It includes
a simulator module for the target CPU instruction set, memory, and may
also include simulated peripheral devices such as serial I/O and timers.
Altogether, these features allow developers to test their PowerPC programs,
without need for an actual board with that CPU.</font>
<p><font size=+0>The PowerPC simulator is capable of matching the instruction
timing characteristics of different PowerPC CPUs, and can provide detailed
instruction dispatch and cache profiling information. This can be handy
for performance analysis, but is not necessary for simply testing eCos
programs.</font>
<p><font size=+0>The simulator can also model devices, which will eventually
allow eCos programs compiled for hardware targets to be run on the simulator.
This is already possible to do on the simulators for the two other eCos
target CPUs, but no devices have been defined for the PowerPC simulator
in this release.</font></dir>
</dir>
<a NAME="_Toc433446046"></a><a NAME="_Toc434049302"></a><b><font size=+1>Features</font></b>
<hr WIDTH="100%">
<br>&nbsp;
<dir>
<dir><font size=+0>The PowerPC simulator includes support for 32, 32-bit
general-purpose registers and 32, 32-bit floating-point registers, as well
as most special purpose registers.</font>
<p><font size=+0>The current release of eCos only supports the Motorola
MPC860, which does not contain floating-point registers, so these registers
are not currently used.</font>
<p><font size=+0>The user program is provided with a single block of memory
at address </font>'<font face="Courier New"><font size=-1>0x00000000</font></font>'<font size=+0>.
The default size of this block is 1MB, but another size can be specified
at simulator startup.</font></dir>
</dir>
<a NAME="_Toc414871788"></a><a NAME="_Toc433446047"></a>
<p><a NAME="_Toc434049303"></a><b><font size=+1>Simulator-specific command
line options</font></b>
<hr WIDTH="100%">
<br>&nbsp;
<dir>
<dir><font size=+0>Running eCos programs only requires one particular option:</font>
<p><font face="Courier New,Courier"><font size=-1>-o '/iobus/pal@0xf0001000/reg
0xf0001000 32'</font></font>
<ol>&nbsp;<font size=+0>This simulator option defines an IO port in the
simulator memory space which is used by eCos for console output. Pretty
much like a serial port if you will, except that the simulator feeds any
characters written on this IO port to stdout.</font>
<p><font face="Courier New,Courier"><font size=-1><b>C:\> </b>powerpc-eabi-run
-o '/iobus/pal@0xf0001000/reg 0xf0001000 32' hello</font></font>
<br><b><font face="Courier New,Courier"><font size=-1>Hello, eCos world!</font></font></b>
<br>&nbsp;</ol>
<font face="Courier New,Courier"><font size=-1>-o mpc860c0[=NUM]</font></font>
<ol>This option is only applicable to ELF executables for certain MPC860
chips. It causes the simulator to perform a check for "problematic" conditional
branches and stop with an error message if one is executed.
<p>The error message will include the address of the problematic branch.
<p>The problem is that some chips may treat the target instruction as a
no-op, given the following conditions:
<br>&nbsp;
<li>
&nbsp;The processor is an MPC860, version C0 or earlier.</li>

<li>
&nbsp;A forward conditional branch is executed.</li>

<li>
&nbsp;The branch is predicted as not taken.</li>

<li>
&nbsp;The branch is taken.</li>

<li>
&nbsp;The branch is located in the last 5 words of a page.</li>

<li>
&nbsp;The branch target is located on a subsequent page.</li>

<p><br>The optional argument is the number of words that are checked at
the end of each text page. It may be any value from 1 to 10 and defaults
to 5.
<br>&nbsp;</ol>
<font face="Courier New,Courier"><font size=-1>-f <i>&lt;file></i></font></font>
<dir><font size=+0>Merge </font>'<i><font face="Courier New"><font size=-1>&lt;file></font></font></i>'<font size=+0>
into the device tree. Use this as an alternative way to specify the </font>'<font face="Courier New"><font size=-1>-o</font></font>'<font size=+0>
option. For example in eCos, using the supplied file </font>'<font face="Courier New"><font size=-1>BASE_DIR/hal/powerpc/sim/v1_2_1/runtime/tree</font></font>'<font size=+0>
as an argument.</font></dir>
<font size=+0>The following general options, are supported by the simulator:</font>
<p><font face="Courier New,Courier"><font size=-1>--help</font></font>
<dir><font size=+0>Here is a list of the PowerPC-specific options, as printed
by </font>'<font face="Courier New"><font size=-1>--help</font></font>'<font size=+0>:</font>
<br>&nbsp;
<p><font face="Courier New,Courier"><font size=-1><b>C:\> </b>powerpc-eabi-run
-help</font></font>
<br><b><font face="Courier New,Courier"><font size=-1>Usage:</font></font></b>
<dir><b><font face="Courier New,Courier"><font size=-1>psim [ &lt;psim-option>
... ] &lt;image> [ &lt;image-arg> ... ]</font></font></b></dir>
<b><font face="Courier New,Courier"><font size=-1>Where</font></font></b>
<dir><b><font face="Courier New,Courier"><font size=-1>&lt;image> Name
of the PowerPC program to run.</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>&lt;image-arg> Argument
to be passed to &lt;image></font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>&lt;psim-option>
See below</font></font></b></dir>
<b><font face="Courier New,Courier"><font size=-1>The following are valid
&lt;psim-option>s:</font></font></b>
<dir><b><font face="Courier New,Courier"><font size=-1>-c &lt;count> Limit
the simulation to &lt;count> iterations</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-i or -i2 Print instruction
counting statistics</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-I Print execution
unit statistics</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-e &lt;os-emul> specify
an OS or platform to model</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-E &lt;endian> Specify
the endianness of the target</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-f &lt;file> Merge
&lt;file> into the device tree</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-h -? -H give more
detailed usage</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-m &lt;model> Specify
the processor to model (604)</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-n &lt;nr-smp> Specify
the number of processors in SMP simulations</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-o &lt;dev-spec>
Add device &lt;dev-spec> to the device tree</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-r &lt;ram-size>
Set RAM size in bytes (OEA environments)</font></font></b>
<br><b><font face="Courier New,Courier"><font size=-1>-t [!]&lt;trace>
Enable (disable) &lt;trace> option</font></font></b></dir>
</dir>
</dir>
</dir>
<a NAME="_Toc433446048"></a><a NAME="_Toc434049304"></a><b><font size=+1>Using
the simulator</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>An eCos program is normally built with a particular
"download method" in mind, that is, the means by which the program is to
be ultimately loaded into the target hardware. Use the configuration options
in eCos</font>'<font size=+0>s Hardware Abstraction Layer (HAL) package
to support the different download methods. The following table summarizes
the ways in which an eCos image can be prepared for different types of
download.</font>
<p><font size=+0>HAL configuration, for various download methods</font></dir>
</dir>

<center><table BORDER CELLPADDING=7 WIDTH="439" >
<tr>
<td VALIGN=TOP WIDTH="62%" HEIGHT="21"><b><font size=+0>Download method</font></b></td>

<td VALIGN=TOP WIDTH="38%" HEIGHT="21"><b><font size=+0>HAL configuration</font></b></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="62%" HEIGHT="21"><font size=+0>Burn hardware ROM</font></td>

<td VALIGN=TOP WIDTH="38%" HEIGHT="21"><font size=+0>ROM startup</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="62%" HEIGHT="21"><font size=+0>Download to ROM emulator</font></td>

<td VALIGN=TOP WIDTH="38%" HEIGHT="21"><font size=+0>ROM startup</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="62%" HEIGHT="21"><font size=+0>Download to board
with GDB stub</font></td>

<td VALIGN=TOP WIDTH="38%" HEIGHT="21"><font size=+0>RAM startup</font></td>
</tr>

<tr>
<td VALIGN=TOP WIDTH="62%" HEIGHT="21"><font size=+0>Download to simulator
ignoring devices</font></td>

<td VALIGN=TOP WIDTH="38%" HEIGHT="21"><font size=+0>SIM configuration</font></td>
</tr>
</table></center>

<dir>
<dir><font size=+0>The debugging environment for most developers will be
either a<b> </b>hardware board with GDB stubs, or the simulator, in which
case the developer will be<b> </b>able to select a single HAL configuration
(RAM startup for the board,<b> </b>SIM configuration for the simulator).</font>
<p><font size=+0>Simulator clocks and timers sometimes appear to be running
very slowly, even when there are apparently no active threads. Delays that
should only be in seconds can run to minutes. These delays occur because
the eCos kernel idle thread is running intensively, and the simulator emulates
it faithfully. With the SIM configuration, however, the eCos kernel realizes
it is in a simulated environment, and can therefore adjust the clock settings
to be more realistic.</font>
<p><font size=+0>For further information on the PowerPC PSIM simulator,
please refer to</font>
<br>&nbsp;
<dir><font face="Courier New,Courier"><font size=-1><a href="http://sourceware.cygnus.com/psim/">http://sourceware.cygnus.com/psim/</a></font></font></dir>
</dir>
</dir>
<a NAME="_Toc434049305"></a><b><font size=+1>Simulator exceptions within
GDB</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><font size=+0>If you invoke the simulator within GDB, using the </font>'<font face="Courier New"><font size=-1>target
sim</font></font>'<font size=+0> command, you may encounter some ambiguities
when processing signals and exceptions. When an exception is raised in
the simulator, GDB does not known whether the simulated program is intended
to handle the exception, or if GDB is intended to handle it.</font>
<p><font size=+0>For example, suppose you are debugging a ROM monitor in
the simulator invoked from GDB (we</font>'<font size=+0>ll call this GDB1),
and you have downloaded an application to it from a second GDB session
(which we will call GDB2). The second GDB session, GDB2, would simply consider
the simulated target as a remote target and nothing more. Now suppose that
in GDB2 you set a breakpoint in the program. The breakpoint will be physically
set in GDB1. So when the breakpoint is reached, instead of the breakpoint
being handled by the ROM monitor as if it was a real target, the breakpoint
will be interpreted by GDB1 as if you had asked GDB1 to set a breakpoint
in the ROM monitor code. This may not be your desired intention. To solve
this, you can tell GDB1 not to process breakpoints itself, but to let the
simulated target process them.</font>
<p><font size=+0>To do this, use the following command:</font>
<br>&nbsp;
<dir><font face="Courier New"><font size=-1>handle SIGxxxx pass nostop
noprint</font></font></dir>
<font size=+0>where </font>'<font face="Courier New"><font size=-1>SIGxxxx</font></font>'<font size=+0>
is one of the signals listed by GDB when you use the</font>
<br>'<font face="Courier New"><font size=-1>info handle</font></font>'<font size=+0>
command to the GDB console prompt.</font>
<p><font size=+0>For example the command </font>'<font face="Courier New"><font size=-1>handle
SIGTRAP pass nostop noprint</font></font>'<font size=+0> tells GDB to not
stop the simulated target at a breakpoint, or even to print that it has
been stopped. Instead, the command tells GDB to pass the information back
to the program. You can modify the command to use with other signals and
exceptions.</font>
<p><b><font size=+1>Note:</font></b>
<br><font size=+0>If you use the aforementioned command, you will no longer
be able to set breakpoints in the ROM monitor code (as in the example).
You may be able to work around this problem by using conditional breakpoints.
Please consult the GDB manual on how to use conditional-breakpoints.</font>
<p><font size=+0>The ambiguities discussed in this section are not a problem
when you are using the standalone simulator. In such a case, the standalone
simulator is the only target program that can handle the exception.</font>
<br>&nbsp;
<br>&nbsp;</dir>
</dir>
<a NAME="_Toc434049306"></a><b><font size=+3>Appendix A:</font></b> <b><font size=+3>Bibliography</font></b>
<br>
<hr WIDTH="100%">
<dir>
<dir><b><i><font size=+0>The PowerPC (tm) Architecture:A SPECIFICATION
FOR A NEW FAMILIY OF RISC PROCESSORS</font></i></b>
<br>(Published by Morgan Kaufmann Publishers, Inc. San Francisco, California
ISBN 1-55860-316-6 PB)
<p><b><i>PowerPC (tm) Microprocessor Family:The Programming Environments</i></b>
<br>(Published by both IBM (MPRPPCFPE-01) and Motorola (MPCFPE/AD))
<p><b><i>PowerPC MPC823 User's Manual</i></b>
<br>Motorola (MPC823UM/D)
<p><b><i>MPC850 Integrated Communications Microprocessor User's Manual</i></b>
<br>Motorola (MPC850UM/D)
<p><b><i>MPC860 PowerQUICC User's Manual</i></b>
<br>Motorola (MPC860UM/AD)
<p><b><i>Getting Started with eCos</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>eCos User's Guide</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>eCos Reference Manual</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>Getting Started with GNUPro Toolkit</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>GNUPro Compiler Tools</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>GNUPro Debugging Tools</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>GNUPro Libraries</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>GNUPro Utilities</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>GNUPro Tools for Embedded Systems</i></b>
<br>(Sunnyvale: Cygnus Solutions, 1999)
<p><b><i>System V Application Binary Interface</i></b>
<br>(Prentice Hall, 1990)
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;</dir>
</dir>

</body>
</html>
