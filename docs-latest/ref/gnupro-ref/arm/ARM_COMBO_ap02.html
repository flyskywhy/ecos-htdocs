<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (WinNT; U) [Netscape]">
   <title>Multi-processor EmbeddedICE Interface Unit</title>
</head>
<body bgcolor="#FFFFFF">

<h1 CLASS="AppendixTitle">
<a NAME="pgfId-481870"></a>Multi-processor EmbeddedICE<sup><font size=+0>TM</font></sup>
Interface Unit
<hr WIDTH="100%"></h1>
&nbsp;
<p>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;

<p CLASS="BodyAfterHead"><a NAME="pgfId-485600"></a>The GNUPro Toolkit
supports communication using GDB to ARM target platforms that can support
for Multi-processor EmbeddedICE<sup><font size=-2>TM</font></sup> Interface
Unit (In Circuit Emulator).
<h2 CLASS="Heading1">
<a NAME="pgfId-485604"></a>Background
<hr WIDTH="100%"></h2>

<p CLASS="BodyAfterHead"><a NAME="pgfId-485607"></a>ARM provides a device
knows as the Multi-processor EmbeddedICE Interface Unit (hereafter referred
to as the Multi-ICE) which allows debugging at the hardware level. Support
for this device is provided via the Multi-ICE Server, a Windows application
which is provided by ARM on CD-ROM with the Multi-ICE package. The Multi-ICE
Server handles the hardware interface, and responds to commands sent to
it via an ARM supplied Windows DLL.</p>

<p CLASS="BodyAfterHead"><a NAME="pgfId-485615"></a>The GDB Multi-ICE
server is an application which runs on Windows under CygWin. When connected
to by a standard ARM GDB client, this program behaves just like an ARM
target board running GDB remote stubs. As GDB requests come in, they are
translated into corresponding functions and passed on to the Multi-ICE
Server, which in turn passes them on to the actual hardware.</p>

<h2 CLASS="Heading1">
<a NAME="pgfId-482683"></a>Installation
<hr WIDTH="100%"></h2>

<p CLASS="Body"><a NAME="pgfId-482684"></a>The Multi-ICE unit must be
connected to a computer running the Windows NT operating system.</p>

<h3 CLASS="Heading2">
<a NAME="pgfId-482624"></a>Installation of hardware</h3>

<p CLASS="BodyAfterHead"><a NAME="pgfId-485676"></a>For complete hardware
installation instructions refer to the<b> <i>ARM Multi-ICE User Guide</i></b>provided
in the '<tt>docs</tt>' subdirectory of the CD-ROM supplied with the ARM
Multi-ICE package.</p>

<h3 CLASS="Heading2">
<a NAME="pgfId-482626"></a>Installation of software</h3>

<ol>
<li CLASS="Numbered">
&nbsp;Install the software that came with the Multi-ICE onto the computer
that it is attached to. From now on we will refer to this computer as the
host computer.</li>

<li CLASS="NumberedNext">
Install the GNUPro Toolkit on the host computer.</li>

<li CLASS="NumberedNext">
Install the GNUPro Toolkit on the computer you intend to use for development.
This can be the same as the computer attached to the Multi-ICE Interface
Unit, but need not be.</li>
</ol>

<p CLASS="Label"><a NAME="pgfId-486971"></a><b><font size=+1>Note: </font></b>Certain
targets may require jumper modifications, or re-soldered connections. For
more detail, see the <b><i>ARM Multi-ICE User Guide</i></b> and/or target
hardware documentation.</p>

<h3 CLASS="Heading2">
<a NAME="pgfId-485728"></a>Connecting to the Multi-ICE server software
<hr WIDTH="100%"></h3>

<ol>
<li CLASS="Numbered">
Start the ARM Multi-ICE server software:</li>

<br>Start the ARM Multi-ICE server software from the Windows Start menu
on the host computer. You will need to set up a Multi-ICE Server configuration
file for your hardware. Please read the <b><i>Getting Started with eCos</i></b>
manual for configuration file examples for supported target platforms.
Ensure the board is reset and awakened (if applicable) before trying to
make a connection. Use the Multi-ICE server graphical interface to load
the configuration file. Once the Multi-ICE server is happy talking to the
hardware, the hardware graphic will indicate the processor core model connected
to in green. Later, when a connection is established between the GDB Multi-ICE
server and the hardware (ARM supplied) Multi-ICE server, the processor
graphic will turn red.
<li CLASS="NumberedNext">
<a NAME="pgfId-485954"></a>Start the GNUPro '<tt>multi-ice-gdb-server</tt>'
software</li>

<br>Open a DOS window or a bash shell and start the '<tt>multi-ice-gdb-server</tt>'
software on the host computer. If starting a DOS window, ensure the Cygwin
user tools are also on your PATH. You will see output similar to the following:</ol>

<center><table>
<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486189"></a><font face="Courier New,Courier"><font size=-1><b>C:\>
</b>multi-ice-gdb-server.exe
--remote-port 9000 --byte-sex l --config-dialog</font></font></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486191"></a></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486193"></a><b><font face="Courier New,Courier"><font size=-1>Connected
to the Multi-Ice target.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486195"></a></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486197"></a><b><font face="Courier New,Courier"><font size=-1>Targeted
ARM core: ARM7 0</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486199"></a></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486201"></a><b><font face="Courier New,Courier"><font size=-1>Target
characteristics:</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486203"></a><b><font face="Courier New,Courier"><font size=-1>Hardware?:
YES</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486205"></a><b><font face="Courier New,Courier"><font size=-1>Comms
Channel?: YES</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486207"></a><b><font face="Courier New,Courier"><font size=-1>Endian-ness:
LITTLE</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486209"></a><b><font face="Courier New,Courier"><font size=-1>Single-Step
Support: NO</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486211"></a><b><font face="Courier New,Courier"><font size=-1>Load
Size: 32768</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486213"></a><b><font face="Courier New,Courier"><font size=-1>Custom
Load?: NO</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486215"></a></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486217"></a><b><font face="Courier New,Courier"><font size=-1>No
other modules found on debug target.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486219"></a></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486221"></a><b><font face="Courier New,Courier"><font size=-1>GDB
Server starting on port 9000</font></font></b></p>
</td>
</tr>
</table></center>

<ol START=3>
<li CLASS="NumberedNext">
<a NAME="pgfId-486012"></a>Changing the default Multi-ICE settings:</li>

<br>It is probably not necessary to change the settings from the command-line
given in step 2. However, if your configuration has special requirements,
you can configure the connection both to the Multi-ICE Interface Unit and
to the remote GDB. The connection to the Multi-ICE Interface Unit can be
configured with the ARM Multi-ICE server. The configuration of the remote
GDB can be configured by passing arguments to the Multi-ICE GDB server.</ol>

<blockquote>In the command-line given in step 2, the options are interpreted
as follows:</blockquote>

<blockquote>
<dd CLASS="BodyHang2">
<a NAME="pgfId-486057"></a><tt>--remote-port 9000</tt></dd>

<blockquote>
<blockquote>Specifies the TCP port that GDB clients use to connect to this
server.
You can use any available port.</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486060"></a><tt>--byte-sex l</tt></dd>

<blockquote>
<blockquote>Tells GDB to respond with Little-Endian. Some GDB responses
are byte-order (endian-ness) sensitive. The default here is Big Endian,
but since eCos typically runs the hardware in Little Endian mode, this
needs to be specified explicitly.</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486065"></a><tt>--config-dialog</tt></dd>

<blockquote>
<blockquote>Forces the GDB server to bring up the Multi-ICE configuration
dialog when starting. This is required in order to force the Multi-ICE
server to connect properly.</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486069"></a>Other available options include:</dd>
<p>
<dd CLASS="BodyHang2">
<a NAME="pgfId-486071"></a><tt>--debug</tt></dd>

<blockquote>
<blockquote>Setting this turns on GDB protocol tracing - analagous to the
GDB command:
<br>'<tt>set remotedebug 1</tt>'</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486074"></a><tt>--rdi-logging</tt></dd>

<blockquote>
<blockquote>Setting this turns on logging at the RDI level</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486076"></a><tt>--target-port </tt><i><font face="Courier New,Courier"><font size=-1>&lt;port></font></font></i></dd>

<blockquote>
<blockquote>If the target is ID sensitive (the Multi-ICE can actually work
with multiple devices simultaneously, each with their own ID), it may be
specified with this option.</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486080"></a><tt>--stop-others</tt></dd>

<blockquote>
<blockquote>Setting this specifies that a resume stops all the other processors</blockquote>
</blockquote>

<dd CLASS="BodyHang2">
<a NAME="pgfId-486044"></a><tt>--help</tt></dd>

<blockquote>
<blockquote>Produces the following output:</blockquote>
</blockquote>
</blockquote>

<center><table>
<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486016"></a><font face="Courier New,Courier"><font size=-1><b>C:\>
</b>multi-ice-gdb-server
--help</font></font></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486018"></a><b><font face="Courier New,Courier"><font size=-1>--byte-sex
{b,l} - Specify the byte-sex of the target on restart.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486020"></a><b><font face="Courier New,Courier"><font size=-1>--config-dialog
- Post configuration dialog for Multi-ICE DLL.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486022"></a><b><font face="Courier New,Courier"><font size=-1>--debug
- Turn on debugging of remote protocol requests.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486024"></a><b><font face="Courier New,Courier"><font size=-1>--help
- Print out this help message.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486026"></a><b><font face="Courier New,Courier"><font size=-1>--rdi-logging
- Turn on RDI logging.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486028"></a><b><font face="Courier New,Courier"><font size=-1>--remote-port
port - Specify the port to listen for remote connections.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486030"></a><b><font face="Courier New,Courier"><font size=-1>--stop-others
- Execution of target stops other modules.</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen"><a NAME="pgfId-486032"></a><b><font face="Courier New,Courier"><font size=-1>--target-port
port - Specify the port to which the target is attached.</font></font></b></p>
</td>
</tr>
</table></center>

<ol START=4>
<li CLASS="NumberedNext">
<a NAME="pgfId-486284"></a>Test the remote connection:</li>

<br>Run gdb on the development computer by typing the command
<br><tt>'</tt><font face="Courier New,Courier"><font size=-1>arm-elf-gdb
<i>&lt;executable></i></font></font>'
where '<i><font face="Courier New,Courier"><font size=-1>&lt;executable></font></font></i>'
is the program to download and debug. Connect to the Multi-ICE GDB server
by typing the command: '<font face="Courier New,Courier"><font size=-1>target
remote <i>&lt;hostname:port></i></font></font>', where '<i><font face="Courier New,Courier"><font size=-1>&lt;hostname></font></font></i>'
is the IP address/hostname of the host computer and '<i><font face="Courier New,Courier"><font size=-1>&lt;port></font></font></i>'
is the remote port number, 9000 in the above example and 2331 by default.
For example, if the host and development computer are the same, type '<tt>target
remote localhost:9000</tt>'. You can then use GDB debugger commands normally..</ol>

<center><table WIDTH="600" >
<tr>
<td>
<p CLASS="CodeScreen2"><a NAME="pgfId-486288"></a><font face="Courier New,Courier"><font size=-1><b>(gdb)
</b>target
remote localhost:2331</font></font></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen2"><a NAME="pgfId-486290"></a><b><font face="Courier New,Courier"><font size=-1>Remote
debugging using localhost:2331</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen2"><a NAME="pgfId-486292"></a><b><font face="Courier New,Courier"><font size=-1>0x0
in ?? ()</font></font></b></p>
</td>
</tr>

<tr>
<td>
<p CLASS="CodeScreen2"><a NAME="pgfId-486294"></a><b><font face="Courier New,Courier"><font size=-1>(gdb)</font></font></b></p>
</td>
</tr>
</table></center>


<p CLASS="Label"><a NAME="pgfId-486868"></a><b><font size=+1>Note: </font></b>Only
one remote GDB can connect to the Multi-ICE server at the same time. When
you quit the remote GDB, or issue the '<tt>disconnect</tt>' command, the
connection to the Multi-ICE server is dropped and the connection is available
to another remote GDB. If you attempt to make a second connection while
one connection is already established, no error message is generated, the
second connection attempt will just time out.

<p CLASS="Label"><a NAME="pgfId-486882"></a><b><font size=+1>Caution:
</font></b>Some
targets do not respond well to the Multi-ICE JTAG reset request. For these
targets, use of a physical reset (button, power-off, etc.) may be required.

<p CLASS="Note"><a NAME="pgfId-486891"></a>Furthermore it is recommended
that the GDB Multi-ICE server be restarted if the hardware needs to be
reset.
<h2 CLASS="Heading1">
<a NAME="pgfId-486310"></a>eCos thread debugging using Multi-ICE
<hr WIDTH="100%"></h2>

<p CLASS="Body"><a NAME="pgfId-486313"></a>Normally, the Multi-ICE (and
the Multi-ICE GDB server) have no knowledge of threads which might be running
on the target hardware. In the case of an eCos application, some additional
support is provided. If the eCos program has been built with the '<tt>CYGHWR_HAL_ARM_ICE_THREAD_SUPPORT</tt>'
option enabled (found in the eCos Configuration Tool under the ARM architecture-specific
flags), then the Multi-ICE GDB server and the eCos application co-operate
to provide the thread information.</p>

<p CLASS="Label"><a NAME="pgfId-486321"></a><b><font size=+1>Note: </font></b>It
is also required that the following options are also enabled:</p>

<blockquote>CYGDBG_HAL_DEBUG_GDB_INCLUDE_STUBS
<br>CYGDBG_HAL_DEBUG_GDB_THREAD_SUPPORT
<br>CYGDBG_KERNEL_DEBUG_GDB_THREAD_SUPPORT</blockquote>

<blockquote>&nbsp;</blockquote>

<p CLASS="Body"><a NAME="pgfId-486327"></a>When an eCos program is built
with these options, then the server will call into the program in order
to obtain thread information. This can take place at any time and does
not require any explicit action on the eCos application side other than
being compiled with the appropriate options enabled. The GDB requests are
made as anonymous function calls run transparently behind the scenes as
far as the running eCos program is concerned.</p>

<h2 CLASS="Heading1">
<a NAME="pgfId-486334"></a>Rebuilding the GDB Multi-ICE Server
<hr WIDTH="100%"></h2>

<p CLASS="Body"><a NAME="pgfId-486337"></a>The GDB Multi-ICE server is
built using Cygwin. The sources for the server itself can be found in the
'<font face="Courier New,Courier"><font size=-1>src/gdb/multi-ice</font></font>'
subdirectory of the GNUPro tools installation directory. Note that these
sources are not installed by default - ensure you enable the appropriate
option in the installer when installing the build tools.</p>

<p CLASS="Body"><a NAME="pgfId-486343"></a>Ensure the following files
are present in a directory, for example, '<tt>/multi-ice</tt>':</p>

<p CLASS="Body"><a NAME="pgfId-486744"></a></p>

<br>&nbsp;
<table WIDTH="640" HEIGHT="140" >
<tr ALIGN=LEFT>
<td HEIGHT="25">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>Multi-ICE.def</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>host.h</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi_cp.h</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>toolconf.def</font></font></p>
</td>
</tr>

<tr>
<td HEIGHT="25">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>Multi-ICE.dll</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi_err.h</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>toolconf.dll</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi.h</font></font></p>
</td>
</tr>

<tr>
<td HEIGHT="25">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi_hif.h</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>toolconf.h</font></font></p>
</td>

<td WIDTH="24%">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>armtypes.h</font></font></p>
</td>

<td><font face="Courier New,Courier"><font size=-1>rdi100.h</font></font></td>
</tr>

<tr>
<td WIDTH="25%" HEIGHT="25"><font face="Courier New,Courier"><font size=-1>rdi_info.h</font></font></td>

<td HEIGHT="25"><font face="Courier New,Courier"><font size=-1>toolconf.lib</font></font></td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>c150t100.h</font></font></p>
</td>

<td HEIGHT="25">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi150.h</font></font></p>
</td>
</tr>

<tr>
<td HEIGHT="25">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi_rdp.h</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>winrdi.h</font></font></p>
</td>

<td HEIGHT="10">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>findfile.h</font></font></p>
</td>

<td>
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi_conf.h</font></font></p>
</td>
</tr>

<tr ALIGN=LEFT VALIGN=CENTER>
<td HEIGHT="25">
<p CLASS="CellBody"><font face="Courier New,Courier"><font size=-1>rdi_stat.h</font></font></p>
</td>

<td>
<p CLASS="CellBody">&nbsp;</p>
</td>

<td>
<p CLASS="CellBody">&nbsp;</p>
</td>

<td>&nbsp;</td>
</tr>
</table>


<p CLASS="Body"><a NAME="pgfId-486353"></a>Assuming the sources to GDB
are installed in '<tt>/src/gdb</tt>', and you have made an empty directory
to build in called /build:
<ol>
<li CLASS="Numbered">
Start a Cygwin bash shell</li>

<li CLASS="NumberedNext">
<a NAME="pgfId-486357"></a>Run the following commands:</li>
</ol>

<blockquote><tt>bash$ cd /build</tt>
<br><tt>bash$ /src/gdb/configure --target=arm-elf</tt>
<br><tt>bash$ cd multi-ice</tt>
<br><tt>bash$ make MULTI_ICE_INCLUDES="-I/multi-ice" MULTI_ICE_LIBS="-L/multi-ice
-ltoolconf"</tt></blockquote>

<ol START=3>
<li CLASS="NumberedNext">
<a NAME="pgfId-486840"></a>You will now have a multi-ice-gdb-server.exe
executable. To be able to run it you will need to ensure it is installed
in the same directory as Multi-ICE.dll and toolconf.dll. For example:</li>
</ol>

<blockquote><font face="Courier New,Courier"><font size=-1>bash$ mkdir
/gdbmulti</font></font>
<br><font face="Courier New,Courier"><font size=-1>bash$ cp multi-ice-gdb-server.exe&nbsp;
/multi-ice/Multi-ICE.dll \&nbsp;<br>
/multi-ice/toolconf.dll /gdbmulti</font></font></blockquote>

<p CLASS="Body"><a NAME="pgfId-486373"></a>Remember to check that the
cygwin user tools are on your path before running the GDB Multi-ICE server.</p>

<p CLASS="Body"><a NAME="pgfId-482881"></a></p>

</body>
</html>
