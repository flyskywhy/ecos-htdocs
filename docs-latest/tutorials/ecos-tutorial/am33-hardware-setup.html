<HTML
><HEAD
><TITLE
>AM33 STB hardware setup</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.33"><LINK
REL="HOME"
TITLE="Getting Started with eCos"
HREF="ecos-tutorial.html"><LINK
REL="UP"
TITLE="Hardware
setup"
HREF="hardware-setup.html"><LINK
REL="PREVIOUS"
TITLE="Hardware
setup"
HREF="hardware-setup.html"><LINK
REL="NEXT"
TITLE="TX39 hardware setup"
HREF="tx39-hardware-setup.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Getting Started with <SPAN
CLASS="PRODUCTNAME"
><SPAN
CLASS="TRADEMARK"
>eCos</SPAN
><SUP
><FONT
SIZE="-4"
>TM</FONT
></SUP
></SPAN
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="hardware-setup.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. Hardware
setup</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="tx39-hardware-setup.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AM33-HARDWARE-SETUP"
>AM33 STB hardware setup</A
></H1
><P
>The Matsushita AM33 STB System Reference Board may be used
in two modes: via a JTAG debugger, or by means of a <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> stub
ROM.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1744"
>Use with <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> Stub ROM</A
></H2
><P
>The <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> Developer&#8217;s Kit
package comes with a ROM image which provides <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> support
for the Matsushita(R) AM33 STB System Reference Board. To install
the <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> stub ROM requires the use of
the JTAG debugger and the Flash ROM programming code available from
Matsushita. An image of this ROM is also provided at <TT
CLASS="FILENAME"
>loaders/am33-stb/gdbload.bin</TT
> under
the root of your <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> installation.</P
><P
>Ensure that there is a Flash ROM card in MAIN MEMORY SLOT &#60;0&#62;.
Follow the directions for programming a Flash ROM supplied with
the programming software.</P
><P
>The final programming of the ROM will need to be done with
a command similar to the following:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>fdown "gdbload.bin",0x80000000,16,1</PRE
></TD
></TR
></TABLE
></P
><P
>Once the ROM has been programmed, close down the JTAG debugger,
turn the STB off, and disconnect the JTAG cable. Ensure that the
hardware switches are in the following configuration:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>U U D D D U D D

D = lower part of rocker switch pushed in
U = upper part of rocker switch pushed in</PRE
></TD
></TR
></TABLE
></P
><P
>This is also the configuration required by the Flash programming
code, so it should not be necessary to change these.</P
><P
>Restart the STB and the stub ROM will now be able to communicate
with <SPAN
CLASS="APPLICATION"
>GDB</SPAN
>. <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> programs
should be built with RAM startup.</P
><P
>Programs can then be downloaded via a standard RS232 null
modem serial cable connected to the SERIAL1 connector on the STB
front panel (the AM33"s serial port 0). This line is programmed
to run at 38400 baud, 8 data bits, no parity and 1 stop bit (8-N-1)
with no flow control. A gender changer may also be required. Diagnostic output
will be output to <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> using the same
connection.</P
><P
>This procedure also applies for programming ROM startup <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> programs
into ROM, given a binary format image of the program from <B
CLASS="COMMAND"
>mn10300-elf-objcopy</B
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1767"
>Use with the JTAG debugger</A
></H2
><P
>To use <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> from the JTAG debugger,
executables must be built with ROM startup and then downloaded via
the JTAG debugger. For this to work there must be an SDRAM memory
card in SUB MEMORY SLOT &#60;0&#62; and the hardware switches
on the front panel set to the following: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>D U D D D U D D

D = lower part of rocker switch pushed in
U = upper part of rocker switch pushed in</PRE
></TD
></TR
></TABLE
></P
><P
>Connect the JTAG unit and run the debugger as described in
the documentation that comes with it.</P
><P
><SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> executables should be renamed
to have a &#8220;.out&#8221; extension and may then be loaded
using the debugger"s &#8220;l&#8221; or &#8220;lp&#8221; commands.</P
><P
>Diagnostic output generated by the program will be sent out
of the AM33"s serial port 0 which is connected to the SERIAL1
connector on the STB front panel. This line is programmed to run
at 38400 baud, 8 data bits, no parity, and one stop bit (8-N-1)
with no flow control. Connection to the host computer should be
using a standard RS232 null modem serial cable. A gender changer
may also be required.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1776"
>Building the <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> stub ROM
image</A
></H2
><P
><SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> comes with a pre-built <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> stub
ROM image for the AM33-STB platform. This can be found at <TT
CLASS="FILENAME"
>loaders/am33-stb/gdbload.bin</TT
> relative
to the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> installation directory.</P
><P
>If necessary, the ROM image can be re-built as follows:</P
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>On Windows hosts, open a Bash session using
Start-&#62;Programs-&#62;Cygnus eCos-&#62;eCos Development
Environment</P
></LI
><LI
><P
>Create a build directory and cd into it</P
></LI
><LI
><P
>Run (all as one line):<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>&#13;cygtclsh80 <TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/packages/pkgconf.tcl                                        \
  --target=mn10300_am33 --platform stb --startup rom                       \
  --disable-kernel --disable-uitron --disable-libc --disable-libm          \
  --disable-io --disable-io_serial --disable-wallclock --disable-watchdog</PRE
></TD
></TR
></TABLE
>where <TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
> is the
path to the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> installation directory.</P
></LI
><LI
><P
>Edit the configuration file <TT
CLASS="FILENAME"
>pkgconf/hal.h</TT
> in
the build directory tree by ensuring the following configuration
options are set as follows:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>&#13;#define CYGDBG_HAL_DEBUG_GDB_INCLUDE_STUBS
#define CYGDBG_HAL_DEBUG_GDB_BREAK_SUPPORT
#undef  CYGDBG_HAL_DEBUG_GDB_CTRLC_SUPPORT
#define CYGDBG_HAL_DEBUG_GDB_THREAD_SUPPORT
#define CYG_HAL_ROM_MONITOR</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>Run: <B
CLASS="COMMAND"
>make</B
></P
></LI
><LI
><P
>Run: <B
CLASS="COMMAND"
>make -C hal/common/current/current/src/stubrom</B
></P
></LI
><LI
><P
>The file <TT
CLASS="FILENAME"
>hal/common/current/src/stubrom</TT
> will
be an ELF format executable of the ROM image. Use <B
CLASS="COMMAND"
>mn10300-elf-objcopy</B
> to
convert this to the appropriate format for loading into the Matsushita
flash ROM programmer, mode &#8220;binary&#8221; in this case: <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>mn10300-elf-objcopy -O binary hal/common/current/src/stubrom/stubrom stubrom.img</PRE
></TD
></TR
></TABLE
></P
></LI
></OL
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="hardware-setup.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ecos-tutorial.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="tx39-hardware-setup.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Hardware
setup</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="hardware-setup.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>TX39 hardware setup</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>