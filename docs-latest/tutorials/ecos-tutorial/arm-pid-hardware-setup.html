<HTML
><HEAD
><TITLE
>ARM PID
hardware setup</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.33"><LINK
REL="HOME"
TITLE="Getting Started with eCos"
HREF="ecos-tutorial.html"><LINK
REL="UP"
TITLE="Hardware
setup"
HREF="hardware-setup.html"><LINK
REL="PREVIOUS"
TITLE="SPARClite hardware setup"
HREF="sparclite-hardware-setup.html"><LINK
REL="NEXT"
TITLE="ARM
AEB-1 Hardware Setup"
HREF="arm-aeb-hardware-setup.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Getting Started with <SPAN
CLASS="PRODUCTNAME"
><SPAN
CLASS="TRADEMARK"
>eCos</SPAN
><SUP
><FONT
SIZE="-4"
>TM</FONT
></SUP
></SPAN
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sparclite-hardware-setup.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. Hardware
setup</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="arm-aeb-hardware-setup.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="ARM-PID-HARDWARE-SETUP"
>ARM PID
hardware setup</A
></H1
><P
>The optimal environment for <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> is
provided by running <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> stubs on the
PID board. The <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> stubs comprise a minimal
environment for downloading and debugging <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> programs.
Both <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> and the stubs support the PID
fitted with both ARM7T and ARM9 daughterboards. The stubs can be
programmed into either the programmable ROM (U12) or the FLASH (U13).
A pre-built set of <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> stubs is included
for this environment, along with a tool that will program the stubs
into the FLASH memory on the board. Note that some unreliability
has been experienced in downloading files using Angel 1.00. Angel
1.02 appears to be more robust in this application.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1928"
>Installing the stubs into FLASH</A
></H2
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1930"
>Preparing the binaries</A
></H3
><P
>These two binary preparation steps are not strictly necessary
as the <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> distribution ships with precompiled
binaries in the directory loaders/arm-pid relative to the installation
root.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1934"
>Make the GDB modue</A
></H3
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>Configure a minimal <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> system
with all packages except "infra"disabled.</P
></LI
><LI
><P
>Edit &#60;hal/hal.h&#62; to enable
GDB: </P
><P
><TT
CLASS="LITERAL"
>#define  CYGDBG_HAL_DEBUG_GDB_INCLUDE_STUBS
 #undef   CYGDBG_HAL_DEBUG_GDB_BREAK_SUPPORT
 #undef   CYGDBG_HAL_DEBUG_GDB_THREAD_SUPPORT</TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>make;make -C hal/arm/pid/&#60;version&#62;/misc</TT
></P
></LI
></OL
></DIV
><P
> Alternatively run hal/arm/pid/&#60;version&#62;/misc/STUBS_config.
The <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> image is in the file hal/arm/pid/&#60;version&#62;/misc/gdb_module.img</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1949"
>Make the FLASH tool</A
></H3
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>Configure a separate <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> system
with all packages enabled.</P
></LI
><LI
><P
>Change diag chanel to port B (in file pkgconf/hal_arm_pid.h): 
   <TT
CLASS="LITERAL"
>#define CYGHWR_HAL_ARM_PID_DIAG_PORT
    1</TT
></P
></LI
><LI
><P
>make misc</P
></LI
></OL
></DIV
><P
>FLASH tool is in the file hal/arm/pid/&#60;version&#62;/misc/prog_flash.img</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1961"
>Prepare the board for FLASH programming</A
></H3
><P
>Each time a new image is to be programmed in the FLASH, the
jumpers onthe board must be set to allow Angel to run:</P
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>Set jumper 7-8 on LK6   [using the
Angel code in the 16 bit EPROM]</P
></LI
><LI
><P
>Set jumper 5-6 on LK6   [select 8bit ROM mode]</P
></LI
><LI
><P
>Set jumper LK18         [ROM remap - this is
also required for eCos]</P
></LI
><LI
><P
>Set S1 to 0-0-1-1       [20MHz operation]</P
></LI
></OL
></DIV
><P
>Attach a serial cable from Serial A on the PID board to connector
1 on the development system. This is the cable through which the
binaries will be downloaded. Attach a serial cable from Serial B
on the PID board to connector 2 on the development system (or any
system that will work as a terminal). Through this cable, the FLASH
tool will write its instructions (at 38400 baud).</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN1974"
>Program the FLASH</A
></H3
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>Download the stubs image onto the PID board:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>bash$ arm-elf-gdb gdb_module.img
GNU gdb 4.18-ecos-99r1-991015
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are welcome to change it and/or distribute copies of it under certain conditions. Type "show copying" to see the conditions. There is absolutely no warranty for GDB. Type "show warranty" for details.
This GDB was configured as "--host=i586-pc-cygwin32 --target=arm-elf".
(no debugging symbols found)...
(gdb) target rdi s=com1
Angel Debug Monitor for PID (Built with Serial(x1), Parallel, DCC) 1.00
(Advanced RISC Machines SDT 2.10)
Angel Debug Monitor rebuilt on Jan 20 1997 at 02:33:43
Connected to ARM RDI target.
(gdb) load
Loading section .rom_vectors, size 0x44 lma 0x60000
Loading section .text, size 0x1f3c lma 0x60044
Loading section .rodata, size 0x2c lma 0x61f80
Loading section .data, size 0x124 lma 0x61fac
Start address 0x60044 , load size 8400
Transfer rate: 5169 bits/sec.
(gdb) q 
The program is running.  Exit anyway? (y or n) y </PRE
></TD
></TR
></TABLE
>   </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>On a UNIX or Linux system, the serial port must be
 /dev/cua0 or /dev/cua1 instead
of COM1.</P
><P
>Newer versions of Linux will complain about the use of cua
devices. However, the device names are hardcoded in the GDB Angel
support and cannot be exchanged for ttyS  type names. You need to
make sure that the /dev/cua files have the right
permissions:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>$ su Password:
 # chmod o+rw /dev/cua*
 # exit </PRE
></TD
></TR
></TABLE
><P
>The stubs are now located at 0x60000..0x64000</P
></BLOCKQUOTE
></DIV
></LI
><LI
><P
>Now download the FLASH programmer tool<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>&#13;bash$ arm-elf-gdb prog_flash.img 
GNU gdb 4.18-ecos-99r1-991015
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are     welcome to change it and/or distribute copies of it under certain conditions. Type "show copying" to see the conditions. There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "--host=i586-pc-cygwin32 --target=arm-elf".
(gdb) target rdi s=com1
Angel Debug Monitor for PID (Built with Serial(x1), Parallel, DCC) 1.00
(Advanced RISC Machines SDT 2.10)
Angel Debug Monitor rebuilt on Jan 20 1997 at 02:33:43
Connected to ARM RDI target.
(gdb) load
Loading section .rom_vectors, size 0x44 lma 0x40000
Loading section .text, size 0x44a4 lma 0x40044
Loading section .rodata, size 0x318 lma 0x444e8
Loading section .data, size 0x1c8 lma 0x44800
Start address 0x40044 , load size 18888
Transfer rate: 5596 bits/sec.
(gdb) c</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>The FLASH tool will output some text on the board serial
port B at 38400 baud:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>ARM eCos
   FLASH here!
   manuf: 8, device: 40
   Error: Wrong Manufaturer: 08
   ... Please change FLASH jumper</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>This text is repeated until you remove the jumper 7-8
on LK6. Then the output will be:   manuf: 1F, device: A4
   AT29C040A recognised
   About to program FLASH using data at 60000..64000
   *** Press RESET now to abort!</P
></LI
><LI
><P
> 5. You have about 10 seconds to abort the operation
by pressing    reset. After this timeout, the FLASH programming
happens:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>...Programming FLASH 
All done!</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>Quit/kill the GDB process, which will hang.</P
></LI
><LI
><P
> 7. Next time you reset the board, the stub will be
in control,    communicating on Serial A at 38400 baud.</P
></LI
></OL
></DIV
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2000"
>Installing the stubs into ROM</A
></H2
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>Create a raw image:Change directories to
the arm-pid loaders directory at the bash prompt of the <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> Development
Environment:<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>$ cd /Program\ Files/Cygnus\ Solutions/eCos/loaders/arm-pid
Strip the image and generate a binary version:
$ arm-elf-objcopy --strip-all gdb_module.img gdb_module.tmp
$ arm-elf-objcopy -O binary gdb_module.tmp gdb_module.bin</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
>Program the raw image file gdb_module.bin into
ROM referring to the instructions of your ROM programmer.</P
></LI
><LI
><P
>Plug the ROM into socket U12 and install jumper LK6
pins 7-8 to enable the ROM.</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN2011"
>ARM and Thumb interworking</A
></H2
><P
>While GNUPro tools allow ARM and Thumb code to be mixed on
a per-object basis, the <SPAN
CLASS="PRODUCTNAME"
>GDB</SPAN
> library (libtarget.a)
must be compiled in whole for either ARM or Thumb. This is done
by selecting either an ARM platform (pid) or a Thumb platform (pid)
or a Thumb platform (pidT).</P
><P
>Adding &#8216;-mthumb-interwork&#8217; to the architecture
options will allow the library to be linked with the application
code of either ARM or Thumb type - or a mix. See the ARM GNUPro
manuals for details about ARM and Thumb mode interworking.</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sparclite-hardware-setup.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ecos-tutorial.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="arm-aeb-hardware-setup.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>SPARClite hardware setup</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="hardware-setup.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>ARM
AEB-1 Hardware Setup</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>