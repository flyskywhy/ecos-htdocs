<HTML>
<HEAD>
<TITLE>HAL Layout</TITLE>
</HEAD>

<!--#include virtual="../../include/header.html"-->

<H2>HAL Layout [TBD / in progress]</H2>
<HR SIZE=3>


<h3>The HAL Directory Layout</h3>

The eCos HAL consists of four sub-HAL classes. This table gives a
brief description of each class. The links refer to the on-line CVS
tree (specifically to the sub-HALs used by the PowerPC MBX target).

<table cellspacing=2 cellpadding=7 border=0 width=100%>
<tr valign=top bgcolor=#999999>
  <td><b>HAL type</b></td>
  <td><b>Description</b></td>
  <td><b>Functionality overview</b></td>
</tr>

<tr valign=top bgcolor=#dddddd>
  <td>Common HAL <a href="http://sourceware.cygnus.com/cgi-bin/cvsweb.cgi/ecos/packages/hal/common/current?cvsroot=ecos">(hal/common)</a></td>
  <td>Configuration options and functionality shared by all HALs.</td>
  <td>Generic debugging functionality, driver API, eCos/ROM monitor
      calling interface, and tests.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
  <td>Architecture HAL <a href="http://sourceware.cygnus.com/cgi-bin/cvsweb.cgi/ecos/packages/hal/powerpc/arch/current?cvsroot=ecos">(hal/&lt;architecture&gt;/arch)</a></td>
  <td>Functionality specific to the given architecture. Also default
  implementations of some functionality which can be overridden by
  variant or platform HALs.</td>
  <td>Architecture specific debugger functionality (handles single
     stepping, exception-to-signal conversion, etc.),
     exception/interrupt vector definitions and handlers, cache
     definition and control macros, context switching code, assembler
     functions for early system initialization, configuration options,
     and possibly tests. </td>
</tr>
<tr valign=top bgcolor=#dddddd>
  <td>Variant HAL <a href="http://sourceware.cygnus.com/cgi-bin/cvsweb.cgi/ecos/packages/hal/powerpc/mpc8xx/current?cvsroot=ecos">(hal/&lt;architecture&gt;/&lt;variant&gt;)</a></td>
  <td>Some CPU architectures consist of a number variants, for example
     MIPS CPUs come in both 32 and 64 bit versions, and some variants
     have embedded features additional to the CPU core.
</td>
  <td>Variant extensions to the architecture code (cache,
     exception/interrupt), configuration options, possibly drivers for
     variant on-core devices, and possibly tests.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
  <td>Platform HAL <a href="http://sourceware.cygnus.com/cgi-bin/cvsweb.cgi/ecos/packages/hal/powerpc/mbx/current?cvsroot=ecos">(hal/&lt;architecture&gt;/&lt;platform&gt;)</a></td>
  <td>Contains functionality and configuration options specific to the
      platform.
</td>
  <td>Early platform initialization code, platform memory layout
     specification, configuration options (processor speed, compiler
     options), diagnostic IO functions, debugger IO functions,
     platform specific extensions to architecture or variant code
     (off-core interrupt controller), and possibly tests.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
  <td>Auxiliary HAL <a href="http://sourceware.cygnus.com/cgi-bin/cvsweb.cgi/ecos/packages/hal/powerpc/quicc/current?cvsroot=ecos">(hal/&lt;architecture&gt;/&lt;module&gt;)</a></td>
  <td>Some variants share common modules on the core. Motorola's PowerPC
      QUICC is an example of such a module.
</td>
  <td>Module specific functionality (interrupt controller, simple
      device drivers), possibly tests.
</td>
</tr>
</table>



<p><HR SIZE=3>
<h3>File descriptions</h3>

<p>Below is listed the files found in various HALs, with a short
description of what the file contains. When looking in existing HALs,
beware that they do not necessarily follow the below naming scheme -
but if you are writing a new HAL, please try to follow the below as
closely as possible. Still, no two targets are the same, so sometimes
it makes sense to use additional files.</p>

<h4>Common HAL</h4>

<table cellspacing=2 cellpadding=7 border=0 width=100%>
<tr valign=top bgcolor=#999999>
  <td><b>File</b></td>
  <td><b>Description</b></td>
</tr>

<tr valign=top bgcolor=#dddddd>
<td><tt>include/dbg-thread-syscall.h</tt></td>
  <td>Defines the thread debugging syscall function. This is used by
  the ROM monitor to access the thread debugging API in the RAM
  application.  [FIXME: link thread debug description].</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/dbg-threads-api.h</tt></td>
  <td>Defines the thread debugging API. [FIXME: link thread
  debug description].</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/drv_api.h</tt></td>
  <td>Defines the driver API.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/generic-stub.h</tt></td>
  <td>Defines the generic stub features.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_if.h</tt></td>
  <td>Defines the ROM/RAM calling interface API.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_misc.h</tt></td>
  <td>Defines miscellaneous helper functions shared by all HALs.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_stub.h</tt></td>
  <td>Defines eCos mappings of GDB stub features.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/dbg-threads-syscall.c</tt></td>
  <td>Thread debugging implementation.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/drv_api.c</tt></td>
  <td>Driver API implementation. Depending on configuration this
  provides either wrappers for kernel features, or a minimal
  implementation of these features. This allows drivers to be written
  relying only on HAL features.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/dummy.c</tt></td>
  <td>Empty dummy file ensuring creation of libtarget.a.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/generic-stub.c</tt></td>
  <td>Generic GDB stub implementation. [this will likely be replaced
  by the bsp stub in the future]</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/hal_if.c</tt></td>
  <td>ROM/RAM calling interface implementation. Provides wrappers from
  the calling interface API to the eCos features used for the
  implementation.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/hal_misc.c</tt></td>
  <td>Various helper functions shared by all platforms and
  architectures.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/hal_stub.c</tt></td>
  <td>Wrappers from eCos HAL features to the features required by the
  generic GDB stub.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/stubrom/stubrom.c</tt></td>
  <td>The file used to build eCos GDB stub images. Basically a
  cyg_start function with a hardcoded breakpoint.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/thread-packets.c</tt></td>
  <td>More thread debugging related functions.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/thread-pkts.h</tt></td>
  <td>Defines more thread debugging related function.</td>
</tr>
</table>


<h4>Architecture HAL</h4>

<p>Some architecture HALs may add extra files for architecture
specific serial drivers, or for handling interrupts/exceptions if it
makes sense.</p>

<p>Note that many of the definitions in these files are only
conditionally defined - if the equivalent variant or platform headers
provide the definitions, those override the generic architecture
definitions.</p>

<table cellspacing=2 cellpadding=7 border=0 width=100%>
<tr valign=top bgcolor=#999999>
  <td><b>File</b></td>
  <td><b>Description</b></td>
</tr>

<tr valign=top bgcolor=#dddddd>
<td><tt>include/arch.inc</tt></td>
  <td>Various assembly macros used during system initialization.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/basetype.h</tt></td>
  <td>Endian, label, alignment, and type size definitions. These
  override common defaults in CYGPKG_INFRA.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_arch.h</tt></td>
  <td>Saved register frame format, various thread, register and stack
  related macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_cache.h</tt></td>
  <td>Cache definitions and cache control macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_intr.h</tt></td>
  <td>Exception and interrupt definitions. Macros for configuring and
  controlling interrupts. eCos real-time clock control macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/hal_io.h</tt></td>
  <td>Macros for accessing IO devices.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/&lt;arch&gt;_regs.h</tt></td>
  <td>Architecture register definitions.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/&lt;arch&gt;_stub.h</tt></td>
  <td>Architecture stub definitions. In particular the register frame
  layout used by GDB. This may differ from the one used by eCos.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/&lt;arch&gt;.inc</tt></td>
  <td>Architecture convenience assembly macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/&lt;arch&gt;.ld</tt></td>
  <td>Linker macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/context.S</tt></td>
  <td>Functions handling context switching and setjmp/longjmp.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/hal_misc.c</tt></td>
  <td>Execption and interrupt handlers in C. Various other utility
  functions.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/hal_mk_defs.c</tt></td>
  <td>Used to export definitions from C header files to assembler
  header files.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/hal_intr.c</tt></td>
  <td>Any necessary interrupt handling functions.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/&lt;arch&gt;stub.c</tt></td>
  <td>Architecture stub code. Contains functions for translating eCos
  exceptions to UNIX signals and functions for single-stepping.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/vectors.S</tt></td>
  <td>Exception, interrupt and early initialization code.</td>
</tr>
</table>


<h4>Variant HAL</h4>

<p>Some variant HALs may add extra files for variant specific serial
drivers, or for handling interrupts/exceptions if it makes sense.</p>

<p>Note that these files may be mostly empty if the CPU variant can be
controlled by the generic architecture macros. The definitions present
are only conditionally defined - if the equivalent platform headers
provide the definitions, those override the variant definitions.</p>

<table cellspacing=2 cellpadding=7 border=0 width=100%>
<tr valign=top bgcolor=#999999>
  <td><b>File</b></td>
  <td><b>Description</b></td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/var_arch.h</tt></td>
  <td>Saved register frame format, various thread, register and stack
  related macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/var_cache.h</tt></td>
  <td>Cache related macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/var_intr.h</tt></td>
  <td>Interrupt related macros.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/var_regs.h</tt></td>
  <td>Extra register definitions for the CPU variant.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>include/variant.inc</tt></td>
  <td>Various assembly macros used during system initialization.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/var_intr.c</tt></td>
  <td>Interrupt functions if necessary.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/var_misc.c</tt></td>
  <td>hal_variant_init function and any necessary extra functions.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/variant.S</tt></td>
  <td>Interrupt handler table definition.</td>
</tr>
<tr valign=top bgcolor=#dddddd>
<td><tt>src/&lt;arch&gt;_&lt;variant&gt;.ld</tt></td>
  <td>Linker macros.</td>
</tr>
</table>

<h4>Platform HAL</h4>

<p>Extras files for platform specific serial drivers. Extra files
for handling interrupts/exceptions if it makes sense.

<h4>Auxiliary HAL</h4>

<p>Extras files for platform specific serial drivers. Extra files
for handling interrupts/exceptions if it makes sense.

<!--#include virtual="../../include/footer.html"-->
