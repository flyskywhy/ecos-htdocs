<HTML>
<HEAD>
<TITLE>Building a toolchain for use with eCos</TITLE>
</HEAD>

<!--#include virtual="include/header.html"-->

<h1>Building a toolchain for use with eCos</h1>
<HR noshade SIZE=3>

<h2>Introduction</h2>

The eCos source code is designed for compilation with a GNU toolchain. Pre-built toolchains
are available for a number of target architectures and we recommend that such a toolchain
is used where available. Developers targetting one of the other architectures must build a
toolchain themselves at present. This page details the steps required to download toolchain
sources and build them on either a Windows host (assuming <a href="cygwin.html">Cygwin</a>
has already been installed) or a Linux host. Please note that building GNU toolchains under
Windows 95/98/ME has been found to be unreliable. We recommend that users avoid building
the development tools on these systems if possible. Note also, that the instructions presented
here are intended for building a cross toolchain for use with eCos only.

<h2>Downloading source code</h2>

The GNU toolchain sources are made available for download in many
component parts. The following parts are required for use with eCos:

<ul>
<li><a href="http://sources.redhat.com/binutils/">GNU binary utilities</a> - including the GNU assembler (as) and GNU linker (ld)</li>
<li><a href="http://gcc.gnu.org/">GNU compiler collection core</a> - core GCC functionality including the C compliler (gcc)</li>
<li><a href="http://gcc.gnu.org/">GNU compiler collection g++</a> - the GCC C++ compiler (g++)</li>
<li><a href="http://sources.redhat.com/newlib/">Newlib</a> - a C library intended for use with embedded systems</li>
<li><a href="http://sources.redhat.com/gdb/">GDB</a> - the GNU debugger</li>
</ul>

It is recommended that you use a mirror site when downloading each component. This will
result in a faster download, reduced internet congestion and a reduced load on the central
servers.

<h3>GNU binary utilities</h3>

It is recommended that eCos is built with the most recent official
release of the GNU binary utilities (binutils). This is available for
download from the <a href="ftp://ftp.gnu.org/gnu/binutils/">binutils area</a>
of the GNU FTP site or any of its
<a href="http://www.gnu.org/order/ftp.html">mirror sites</a>. You should
download a file with a name of the form binutils-<i>version</i>.tar.bz2 or
click on the following link to download version 2.13.1 directly:

<ul>
<li><a href="ftp://ftp.gnu.org/gnu/binutils/binutils-2.13.1.tar.bz2">binutils-2.13.1.tar.bz2</a> (9.5MB)</li>
</ul>

<h3>GNU compiler collection</h3>

It is recommended that eCos is built with GCC 3.2.1 at present. This is available
for download from the <a href="ftp://ftp.gnu.org/gnu/gcc/">GCC area</a> of
the GNU FTP site or any of its
<a href="http://www.gnu.org/order/ftp.html">mirror sites</a>. Click on each of the following
links to download the core and g++ components of version 3.2.1 directly:

<ul>
<li><a href="ftp://ftp.gnu.org/gnu/gcc/gcc-3.2.1/gcc-core-3.2.1.tar.gz">gcc-core-3.2.1.tar.gz</a> (12.8MB)</li>
<li><a href="ftp://ftp.gnu.org/gnu/gcc/gcc-3.2.1/gcc-g++-3.2.1.tar.gz">gcc-g++-3.2.1.tar.gz</a> (2.5MB)</li>
</ul>

<h3>Newlib</h3>

Newlib provides support for building the run-time elements of C++ within the toolchain.
It is recommended that eCos is built with the the most recent official release of
Newlib. This is available for download from the
<a href="ftp://sources.redhat.com/pub/newlib/">Newlib area</a> of sources.redhat.com or
any of its <a href="http://sources.redhat.com/mirrors.html">mirror sites</a>. You should
download a file with a name of the form newlib-<i>version</i>.tar.gz or click on the
following link to download version 1.11.0 directly:

<ul>
<li><a href="ftp://sources.redhat.com/pub/newlib/newlib-1.11.0.tar.gz">newlib-1.11.0.tar.gz</a> (4.2MB)</li>
</ul>

<h3>GDB</h3>

Instructions for downloading GDB are available via
the <a href="http://sources.redhat.com/gdb/">GDB home page</a>. However,
a graphical user interface for GDB named <i>Insight</i> is also available.
Insight has a separate <a href="http://sources.redhat.com/insight/">home page</a>.
The Insight sources are a superset of the standard GDB sources and it is still possible
to use command-line GDB after building from the Insight sources. We therefore recommend
downloading the most recent official release of Insight rather than standard GDB. Both
Insight and standard GDB are available for download from the
<a href="ftp://sources.redhat.com/pub/gdb/">GDB area</a> of sources.redhat.com or
any of its <a href="http://sources.redhat.com/mirrors.html">mirror sites</a>. You should
download a file with a name of the form insight-<i>version</i>.tar.bz2 or gdb-<i>version</i>.tar.bz2
or click on one of the following links to download directly:

<ul>
<li><a href="ftp://sources.redhat.com/pub/gdb/releases/gdb-5.3.tar.bz2">gdb-5.3.tar.bz2</a> (10.7MB)</li>
<li><a href="ftp://sources.redhat.com/pub/gdb/releases/insight-5.3.tar.bz2">insight-5.3.tar.bz2</a> (17.0MB)</li>
</ul>

The remaining instructions assume that you have downloaded the Insight tarball.
If you choose to download the standard GDB tarball, please adapt the instructions
accordingly.

<h2>Preparing the sources for building</h2>

Once the tools sources have been downloaded, they must be prepared before
building. These instructions assume that the tool sources will be extracted in the <tt>/src</tt> directory hierarchy.
Other locations may be substituted throughout. Ensure that the file system used
has sufficient free space available. The contents of each archive will expand
to occupy approximately six times the space required by the compressed archive itself.

To extract the downloaded sources, you will need to have both the
<i>bzip2</i> and <i>gzip</i> compression utilities. The <i>patch</i> and <i>tar</i>
utilities are also required. All these tools are supplied with most
Linux distributions and with Cygwin.<p>

The following steps should be followed at a <i>bash</i> shell prompt:

<ol>
<li>Create a directory to contain the tool sources, avoiding directory names
containing spaces as these can confuse the build system:<br><br>

<ul><tt>
mkdir -p /src
</tt></ul>
</li><br>

<li>Extract the sources from each downloaded tarball in turn:<br><br>
<ul><tt>
cd /src<br>
bunzip2 &lt; binutils-2.13.1.tar.bz2 | tar xvf -<br>
gunzip &lt; gcc-core-3.2.1.tar.gz | tar xvf -<br>
gunzip &lt; gcc-g++-3.2.1.tar.gz | tar xvf -<br>
gunzip &lt; newlib-1.11.0.tar.gz | tar xvf -<br>
bunzip2 &lt; insight-5.3.tar.bz2 | tar xvf -
</tt></ul></li><br>

<li>Having unpacked the toolchain tarballs, it is now necessary to
apply a number of patches to correct known problems with the pristine
source code. Click on each of the following links to download the
patches:<br><br>

<ul>
<li><a href="binutils-2.13.1-v850-hashtable.patch">binutils-2.13.1-v850-hashtable.patch</a></li>
<li><a href="gcc-3.2.1-arm-multilib.patch">gcc-3.2.1-arm-multilib.patch</a></li>
<li><a href="insight-5.3-tcl_win_encoding.patch">insight-5.3-tcl_win_encoding.patch</a></li>
</ul><br>

Then apply the patches:<br><br>

<ul><tt>
patch -p0 &lt; binutils-2.13.1-v850-hashtable.patch<br>
patch -p0 &lt; gcc-3.2.1-arm-multilib.patch<br>
patch -p0 &lt; insight-5.3-tcl_win_encoding.patch
</tt></ul><br>

If any of the patches fail to apply, you should see if there is some
obvious problem by attempting to apply the patch manually. If this is not
possible, please report the problem to the <a href="../intouch.html">
ecos-discuss</a> mailing list. However, if the <i>patch</i> utility reports the
following message:<br><br>

<ul><tt>
Reversed (or previously applied) patch detected!  Assume -R? [n]
</tt></ul><br>

then type <i>n</i> because this indicates that the patch has already been applied
in the master sources.</li><br>

<li>Finally, since Newlib is compiled as part of the GCC build, it is necessary to move
the required source code into the GCC directory hierarchy:<br><br>

<ul><tt>
mv newlib-1.11.0/newlib gcc-3.2.1<br>
mv newlib-1.11.0/libgloss gcc-3.2.1
</tt></ul></li>
</ol>

<h2>Building the toolchain</h2>

Before attempting to build the tools, ensure that the GNU native compiler tools
directory is on the PATH and precedes the current directory. The following build
procedures will fail if <tt>.</tt> is ahead of the native tools in the PATH.<p>

These instructions assume that the tools
will be built in the <tt>/tmp/build</tt> directory hierarchy and
installed to <tt>/gnutools</tt>. Other locations may be substituted throughout. The appropriate
GNU architecture identifier for the intended eCos target platform should be substituted for
the word <tt><i>TARGET</i></tt> as follows:

<center><table BORDER=0 CELLSPACING=2 CELLPADDING=7>
<tr bgcolor=#999999><td><b>Architecture</b></td><td><b><tt>TARGET</tt></b></td></tr>
<tr bgcolor=#dddddd><td>ARM (including StrongARM, XScale)</td><td><tt>arm-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>Hitachi H8/300H</td><td><tt>h8300-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>Hitachi SuperH</td><td><tt>sh-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>Intel x86</td><td><tt>i386-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>Matsushita AM3x</td><td><tt>mn10300-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>Motorola 68K/ColdFire</td><td><tt>m68k-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>MIPS32</td><td><tt>mipsisa32-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>NEC V850</td><td><tt>v850-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>NEC VR4300</td><td><tt>mips64vr4300-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>PowerPC</td><td><tt>powerpc-eabi</tt></td></tr>
<tr bgcolor=#dddddd><td>Toshiba TX39</td><td><tt>mips-tx39-elf</tt></td></tr>
<tr bgcolor=#dddddd><td>Toshiba TX49</td><td><tt>mips-tx49-elf</tt></td></tr>
</table></center>
<p>
The following steps should be followed at a <i>bash</i> shell prompt:

<ol>
<li>Configure the GNU binary utilities:<br><br>

<ul><tt>
mkdir -p /tmp/build/binutils<br>
cd /tmp/build/binutils<br>
/src/binutils-2.13.1/configure --target=<i>TARGET</i> \<br>
&nbsp;&nbsp;--prefix=/gnutools -v 2&gt;&amp;1 | tee configure.out
</tt></ul><br>

If there are any problems configuring the tools, you can refer to the file
<tt>configure.out</tt> as a permanent record of what happened.</li><br>

<li>Build and install the GNU binary utilities:<br><br>

<ul><tt>
make -w all install 2&gt;&1 | tee make.out
</tt></ul><br>

If there are any problems building the tools, you can refer to the file
<tt>make.out</tt> as a permanent record of what happened.</li><br>

<li>Configure GCC, ensuring that the GNU binary utilities are at the head of the PATH:<br><br>

<ul><tt>
PATH=/gnutools/bin:$PATH ; export PATH<br>
mkdir -p /tmp/build/gcc<br>
cd /tmp/build/gcc<br>
/src/gcc-3.2.1/configure --target=<i>TARGET</i> \<br>
&nbsp;&nbsp;--prefix=/gnutools --enable-languages=c,c++ \<br>
&nbsp;&nbsp;--with-gnu-as --with-gnu-ld --with-newlib \<br>
&nbsp;&nbsp;--with-gxx-include-dir=/gnutools/<i>TARGET</i>/include \<br>
&nbsp;&nbsp;-v 2&gt;&amp;1 | tee configure.out
</tt></ul></li><br>

<li>Build and install GCC:<br><br>

<ul><tt>
make -w all install 2&gt;&1 | tee make.out
</tt></ul></li><br>


<li>Configure Insight:<br><br>

<ul><tt>
mkdir -p /tmp/build/gdb<br>
cd /tmp/build/gdb<br>
/src/insight-5.3/configure --target=<i>TARGET</i> \<br>
&nbsp;&nbsp;--prefix=/gnutools -v 2&gt;&amp;1 | tee configure.out
</tt></ul></li><br>

<li>Build and install Insight:<br><br>

<ul><tt>
make -w all install 2&gt;&1 | tee make.out
</tt></ul></li>
</ol>

Following successful building and installation of each set of tools, the associated build
tree may be deleted to save space if necessary.
The toolchain executable files will be located at <tt>/gnutools/bin</tt>.
This directory should be added to the head of your PATH.

<h2>Troubleshooting</h2>

If you encounter difficulties in building or using the development tools, first check
the <a href="/fom/ecos?file=53">eCos FAQ</a> and the
<a href="../../ml/ecos-discuss">ecos-discuss mailing list archive</a> to see
if the topic has come up before. Initial queries
may be directed to the <a href="../intouch.html">ecos-discuss</a> list. However,
there are other mailing lists which may be more appropriate if a problem is clearly
related to a particular tool:
<ul>
<li><a href="http://sources.redhat.com/ml/binutils/" target="_top">Binutils mailing list</a>
<li><a href="http://sources.redhat.com/ml/gdb/" target="_top">GDB mailing list</a>
<li><a href="http://sources.redhat.com/ml/crossgcc/" target="_top">CrossGCC mailing list</a> (for problems specific to GCC cross-compilation)
<li><a href="http://gcc.gnu.org/lists.html" target="_top">GCC mailing list</a> (for more general GCC problems)
</ul>

Before sending messages to the mailing lists, please
consult the web sites associated with each list, to see if there is
any relevant documentation or FAQs:
<ul>
<li><a href="http://sources.redhat.com/binutils/" target="_top">Binutils home page</a>
<li><a href="http://sources.redhat.com/gdb/" target="_top">GDB home page</a>
<li><a href="http://sources.redhat.com/insight/" target="_top">Insight home page</a>
<li><a href="http://gcc.gnu.org/" target="_top">GCC web site</a>
<li><a href="http://www.objsw.com/CrossGCC/" target="_top">CrossGCC FAQ</a>
</ul>

It is also worth noting that all these mailing lists have searchable archives.

<!--#include virtual="include/footer.html"-->
