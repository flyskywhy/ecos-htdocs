<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Build and run simple applications</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.19"><LINK
REL="HOME"
TITLE="Getting Started with eCosTM"
HREF="ecos-tutorial.html"><LINK
REL="UP"
TITLE="Programming Tutorial"
HREF="programming-tutorial.html"><LINK
REL="PREVIOUS"
TITLE="Run an eCos test case"
HREF="run-an-ecos-test-case.html"><LINK
REL="NEXT"
TITLE="A sample program with two threads"
HREF="a-simple-program-with-two-threads.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Getting Started with <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
><SUP
><FONT
SIZE="-1"
>TM</FONT
></SUP
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="run-an-ecos-test-case.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="a-simple-program-with-two-threads.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="BUILD-AND-RUN-SIMPLE-APPLICATIONS"
>Chapter 16. Build and run simple applications</A
></H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="build-and-run-simple-applications.html#ECOS-HELLO-WORLD"
>eCos hello world</A
></DT
><DT
><A
HREF="a-simple-program-with-two-threads.html"
>A sample program with two threads</A
></DT
></DL
></DIV
><P
>	It is time to write your own <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> application.  You will
	accomplish this in stages: you will start by writing a
	<I
CLASS="EMPHASIS"
>hello world</I
>-style application, and then
	you will write a more complex application that demonstrates the
	creation of threads and the use of
	<TT
CLASS="FUNCTION"
><B
>cyg_thread_delay()</B
></TT
>, and finally you will
	write one that uses clocks and alarm handlers.</P
><P
>	The example programs in this tutorial are included, along with
	a Makefile, in the <TT
CLASS="FILENAME"
>examples</TT
> directory of
	the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> distribution. The <TT
CLASS="FILENAME"
>Makefile</TT
> has
	two variables you will need to adjust:
	<TT
CLASS="REPLACEABLE"
><I
>PKG_INSTALL_DIR</I
></TT
> and 
	<TT
CLASS="REPLACEABLE"
><I
>CC</I
></TT
>.</P
><P
> 
	<TT
CLASS="REPLACEABLE"
><I
>PKG_INSTALL_DIR</I
></TT
> must be set to the
	install tree previously created by <B
CLASS="COMMAND"
>pkgconf.tcl</B
> 
	before you run <B
CLASS="COMMAND"
>make</B
>.</P
><P
>	The <TT
CLASS="REPLACEABLE"
><I
>CC</I
></TT
> variable in the
	<TT
CLASS="FILENAME"
>Makefile</TT
> can be set to compile for the
	MN10300 or the TX39 or the PowerPC.  To tell it which to
	use, you can type <B
CLASS="COMMAND"
>make CC=mn10300-elf-gcc</B
>
	or <B
CLASS="COMMAND"
>make CC=mips-tx39-elf-gcc</B
> or
	<B
CLASS="COMMAND"
>make CC=powerpc-eabi-gcc</B
>.  Another
	approach is to edit the <TT
CLASS="FILENAME"
>Makefile</TT
> and
	remove the lines that refer to other architectures and then
	run <B
CLASS="COMMAND"
>make</B
>.</P
><H1
CLASS="SECT1"
><A
NAME="ECOS-HELLO-WORLD"
>eCos hello world</A
></H1
><P
>	  Type the following into a file called
	  <TT
CLASS="FILENAME"
>hello.c</TT
>:
	</P
><DIV
CLASS="EXAMPLE"
><P
><B
>Example 16-1. eCos hello world program listing</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
> 

/* this is a simple hello world program */
#include &#60;stdio.h&#62;

int main(void)
{
  printf("Hello, eCos world!\n");
  return 0;
}  </PRE
></TD
></TR
></TABLE
></DIV
><P
>	How can you compile this program?  Earlier on, when you ran the
	test case, it had been compiled automatically by the
	<B
CLASS="COMMAND"
>make</B
> sequence, when the kernel and
	other libraries were built.
	</P
><P
>	  To compile a program that is not part of the
	  <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> distribution, assuming your current working directory
	  is also where you built the <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> kernel, you can type this
	  explicit compilation instruction:</P
><P
CLASS="LITERALLAYOUT"
><TT
CLASS="PROMPT"
>$ </TT
><TT
CLASS="USERINPUT"
><B
>gcc -g -I<TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/ecos-work/install/include hello.c -L<TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/ecos-work/install/lib -Ttarget.ld -nostdlib</B
></TT
></P
><P
>	  The compilation instruction above contains some standard
	  <SPAN
CLASS="APPLICATION"
>GCC</SPAN
> options (for example,
	  <TT
CLASS="OPTION"
>-g</TT
> enables debugging), as well as some
	  mention of paths
	  (<TT
CLASS="OPTION"
>-I<TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/ecos-work/install/include</TT
>
	  allows files like <TT
CLASS="FILENAME"
>cyg/kernel/kapi.h</TT
> to
	  be found, and <TT
CLASS="OPTION"
>-L<TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/ecos-work/install/lib</TT
>
	  allows the linker to find <TT
CLASS="OPTION"
>-Ttarget.ld</TT
>).
	</P
><P
>	  The executable program will be called
	  <TT
CLASS="FILENAME"
>a.out</TT
>.
	</P
><P
>You can now run the resulting program in the simulator
	  in <SPAN
CLASS="APPLICATION"
>GDB</SPAN
>, just the way you ran the
	  test case.  The sequence of steps will be the same:</P
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>Run <B
CLASS="COMMAND"
>gdb</B
> specifying
	      <TT
CLASS="OPTION"
>-nw a.out</TT
> on the command line:</P
><P
CLASS="LITERALLAYOUT"
><TT
CLASS="PROMPT"
>$ </TT
><TT
CLASS="USERINPUT"
><B
>gdb -nw a.out</B
></TT
></P
></LI
><LI
><P
>Type <B
CLASS="COMMAND"
>target sim
		--board=stdeval1</B
>  on the MN10300, or
	      <B
CLASS="COMMAND"
>target sim --board=jmr3904</B
> on the
	      TX39, or <B
CLASS="COMMAND"
>target sim -f
		<TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/hal/powerpc/sim/v1_1/runtime/tree</B
>
	      on the PowerPC.</P
></LI
><LI
><P
>Type <B
CLASS="COMMAND"
>load</B
></P
></LI
></OL
></DIV
><P
>	  At this point you are ready to run the usual
	  <SPAN
CLASS="APPLICATION"
>GDB</SPAN
> commands. For example, in
	  this case you can simply type <B
CLASS="COMMAND"
>run</B
> at the
	  <TT
CLASS="PROMPT"
>(gdb) </TT
> prompt and the program will execute
	  and print the string <TT
CLASS="COMPUTEROUTPUT"
>Hello, eCos
	    world!</TT
> on your screen.</P
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="run-an-ecos-test-case.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ecos-tutorial.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="a-simple-program-with-two-threads.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Run an eCos test case</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="programming-tutorial.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>A sample program with two threads</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>