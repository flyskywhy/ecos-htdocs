<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Some implementation details</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.13"><LINK
REL="HOME"
TITLE="eCos Reference Manual"
HREF="ecos-ref.html"><LINK
REL="UP"
TITLE="C and math library overview"
HREF="c-and-math-library-overview.html"><LINK
REL="PREVIOUS"
TITLE="Math library compatibility modes"
HREF="math-library-compatibility-modes.html"><LINK
REL="NEXT"
TITLE="Thread safety"
HREF="c-and-math-library-overview-thread-safety.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>eCos Reference Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="math-library-compatibility-modes.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. C and math library overview</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c-and-math-library-overview-thread-safety.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SOME-IMPLEMENTATION-DETAILS"
>Some implementation details</A
></H1
><P
>	  Here are some details about the implementation which might
	  be interesting, although they do not affect the ISO-defined
	  semantics of the library.
	</P
><P
></P
><UL
><LI
><P
>	      The opaque type returned by <TT
CLASS="FUNCTION"
><B
>clock()</B
></TT
>
	      is called <SPAN
CLASS="TYPE"
>clock_t</SPAN
>, and is implemented as a
	      64 bit integer.  The
	      <TT
CLASS="PARAMETER"
><I
>CLOCKS_PER_SEC</I
></TT
> constant defined
	      in <TT
CLASS="FILENAME"
>time.h</TT
> is 1000.  The value
	      returned by <TT
CLASS="FUNCTION"
><B
>clock()</B
></TT
> is only correct
	      if the kernel is configured with real time clock
	      support, as determined by the
	      <TT
CLASS="PARAMETER"
><I
>CYGVAR_KERNEL_COUNTERS_CLOCK</I
></TT
>
	      configuration option in <TT
CLASS="FILENAME"
>kernel.h</TT
>
	      (see <A
HREF="component-cygpkg-kernel-counters.html#OPTION-CYGVAR-KERNEL-COUNTERS-CLOCK"
>the section called <I
>Option: Provide real-time clock</I
> in Chapter 13</A
>).
	    </P
></LI
><LI
><P
>	      The standard specifies that <TT
CLASS="PARAMETER"
><I
>EOF</I
></TT
>
	      can be any negative integer.  It has been defined as
	      -64.  The rationale for this is that avoiding the -1
	      value can help in debugging certain algorithms in which
	      a number is decremented to zero.  The choice also takes
	      into account that -64 is within the range of a negative
	      8 bit quantity.
	    </P
></LI
><LI
><P
>	      The <SPAN
CLASS="TYPE"
>FILE</SPAN
> type is not implemented as a
	      structure, but rather as a <SPAN
CLASS="TYPE"
>CYG_ADDRESS</SPAN
>.
	    </P
></LI
><LI
><P
>	      The GNU C compiler will place its own
	      <I
CLASS="EMPHASIS"
>builtin</I
> implementations instead of
	      some C library functions. This can be turned off with
	      the <SPAN
CLASS="OPTION"
>-fno-builtin</SPAN
> option.  The functions
	      affected by this are <TT
CLASS="FUNCTION"
><B
>abs()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>cos()</B
></TT
>, <TT
CLASS="FUNCTION"
><B
>fabs()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>labs()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>memcmp()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>memcpy()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>sin()</B
></TT
>, <TT
CLASS="FUNCTION"
><B
>sqrt()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>strcmp()</B
></TT
>,
	      <TT
CLASS="FUNCTION"
><B
>strcpy()</B
></TT
>, and
	      <TT
CLASS="FUNCTION"
><B
>strlen()</B
></TT
>.</P
><P
>	      For faster execution speed you should avoid this option
	      and let the compiler use its builtins, but to allow
	      assertion and tracing support you should use
	      <SPAN
CLASS="OPTION"
>-fno-builtin</SPAN
>.
	    </P
></LI
><LI
><P
>	      <TT
CLASS="FUNCTION"
><B
>memcpy()</B
></TT
> and
	      <TT
CLASS="FUNCTION"
><B
>memset()</B
></TT
> are located in the kernel
	      package, not in the C library package.  This is because
	      the compiler calls these functions, and the kernel needs
	      to resolve them even if the C library is not configured.
	    </P
></LI
><LI
><P
>	      Error codes such as <TT
CLASS="PARAMETER"
><I
>EDOM</I
></TT
> and
	      <TT
CLASS="PARAMETER"
><I
>ERANGE</I
></TT
>, as well as
	      <TT
CLASS="FUNCTION"
><B
>strerror()</B
></TT
>, are implemented in the
	      <I
CLASS="FIRSTTERM"
>error</I
> package.  The error package
	      is separate from the rest of the C and math libraries so
	      that the rest of <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> can use
	      these error handling facilities even if the C library is
	      not configured.
	    </P
></LI
><LI
><P
>	      The implemented <TT
CLASS="FUNCTION"
><B
>rand()</B
></TT
> uses a very
	      simple algorithm that may not produce a good enough
	      distribution for scientific applications. A choice of
	      algorithms will be available in a future version of the
	      C library.
	    </P
></LI
><LI
><P
>	      When <TT
CLASS="FUNCTION"
><B
>free()</B
></TT
> is invoked, heap memory
	      will normally be coalesced.  If the
	      
	      <TT
CLASS="PARAMETER"
><I
>CYGSEM_KERNEL_MEMORY_COALESCE</I
></TT
>
	      configuration parameter is not set, memory will not be
	      coalesced, which might cause programs to fail.
	    </P
></LI
><LI
><P
>	      The <TT
CLASS="FUNCTION"
><B
>getenv()</B
></TT
> function is
	      implemented
	      
	      (unless the <TT
CLASS="PARAMETER"
><I
>CYGPKG_LIBC_ENVIRONMENT</I
></TT
>
	      configuration option is turned off), but there is no shell or
	      <TT
CLASS="FUNCTION"
><B
>putenv()</B
></TT
> function to set the
	      environment dynamically.  The environment is set in a
	      global variable <TT
CLASS="PARAMETER"
><I
>environ</I
></TT
>, declared
	      as:
	    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>&#13;extern char **environ;              // Standard environment definition</PRE
></TD
></TR
></TABLE
><P
>	      Here is a minimal eCos program which demonstrates the
	      use of environments (see also the test case in
	      <TT
CLASS="FILENAME"
>language/c/libc/current/tests/stdlib/getenv.c</TT
>):
	    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>&#13;#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;            // Main header for stdlib functions

extern char **environ;         // Standard environment definition

int
main( int argc, char *argv[] )
{
  char *str;
  char *env[] = { "PATH=/usr/local/bin:/usr/bin",
                  "HOME=/home/fred",
                  "TEST=1234=5678",
                  "home=hatstand",
                  NULL };

  printf("Display the current PATH environment variable\n");

  environ = (char **)&#38;env;

  str = getenv("PATH");

  if (str==NULL) {
    printf("The current PATH is unset\n");
  } else {
    printf("The current PATH is \"%s\"\n", str);
  }
  return 0;
} </PRE
></TD
></TR
></TABLE
></LI
></UL
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="math-library-compatibility-modes.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ecos-ref.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c-and-math-library-overview-thread-safety.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Math library compatibility modes</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c-and-math-library-overview.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Thread safety</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>