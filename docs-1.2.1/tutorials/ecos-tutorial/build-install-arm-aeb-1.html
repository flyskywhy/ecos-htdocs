<HTML
><HEAD
><TITLE
>How to build and install the GDB module on the AEB-1</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.33"><LINK
REL="HOME"
TITLE="Getting Started with eCos"
HREF="ecos-tutorial.html"><LINK
REL="UP"
TITLE="Hardware
setup"
HREF="hardware-setup.html"><LINK
REL="PREVIOUS"
TITLE="ARM7
PID hardware setup"
HREF="arm-hardware-setup.html"><LINK
REL="NEXT"
TITLE="i386Linux
synthetic target setup"
HREF="x1617.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Getting Started with <SPAN
CLASS="PRODUCTNAME"
><SPAN
CLASS="TRADEMARK"
>eCos</SPAN
><SUP
><FONT
SIZE="-4"
>TM</FONT
></SUP
></SPAN
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="arm-hardware-setup.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 10. Hardware
setup</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1617.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="BUILD-INSTALL-ARM-AEB-1"
>How to build and install the GDB module on the AEB-1</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1540"
>Overview</A
></H2
><P
>      The ARM AEB-1 comes with tools in ROM.  These include a simple FLASH
management tool and the Angel (R) monitor.  eCos for the ARM AEB-1
comes with GDB stubs suitable for programming into the onboard FLASH.
GDB is the preferred debug environment for eCos, but Angel must be
used to initially install the GDB stubs.
    </P
><P
>      Once this bootstrapping is done, you can use GDB to load and debug
programs on the AEB-1 board.
    </P
><P
>      The following steps will have you:</P
><P
></P
><UL
><LI
><P
>talk to the AEB-1 board with a terminal emulator (or a real
  terminal!)</P
></LI
><LI
><P
>	  enable ARM's Angel ROM monitor</P
></LI
><LI
><P
>	  use GDB with Angel to download a configuration of eCos with GDB
	  stubs which will act as a ROM monitor</P
></LI
><LI
><P
>	  talk to the AEB-1 with a terminal emulator again, and tell it to
  write the new module to flash
	</P
></LI
><LI
><P
>	  tell the board to use this new monitor, and then hook GDB up to it
  for real debugging
	</P
></LI
></UL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1556"
>Talking to the board</A
></H2
><P
>Connect a terminal or computer's serial port to the ARM AEB-1.  On a
PC with a 9-pin serial port, you can use the cable shipped by ARM with
no modification.
    </P
><P
>      Set the terminal or terminal emulator to 9600N1 (9600 baud, no parity,
1 stop bit).
    </P
><P
>      Reset the board by pressing the little reset button on the top.  You
will see the following text:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	ARM Evaluation Board Boot Monitor 0.01 (19 APR 1998)
	Press ENTER within 2 seconds to stop autoboot
    </PRE
></TD
></TR
></TABLE
><P
>Press ENTER quickly, and you will get the boot prompt:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	Boot:
    </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1564"
>Downloading the GDB stubs</A
></H2
><P
>      Run the angel monitor by typing the following at the Boot: prompt:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    Boot: plugin angel
    Boot: angel
      </PRE
></TD
></TR
></TABLE
><P
>Then exit the terminal emulator and start up gdb with the GDB module:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    $ arm-elf-gdb -nw loaders/arm-aeb/gdb_module.img
    (gdb) set remotebaud 9600
    (gdb) target rdi s=&#60;YOUR SERIAL PORT&#62;
    </PRE
></TD
></TR
></TABLE
><P
>On Windows, the serial port could be com1, com2, etc.  On a UNIX or
Linux system, the serial port would be /dev/cua0 or /dev/cua1.
Examples are:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    (gdb) target rdi s=com1
    (gdb) target rdi s=/dev/cua0
    </PRE
></TD
></TR
></TABLE
><P
>Finally, load the GDB stubs image:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    (gdb) load
    Loading section .rom_vectors, size 0x44 lma 0xc000
    Loading section .text, size 0x3544 lma 0xc044
    Loading section .rodata, size 0x164 lma 0xf588
    Loading section .data, size 0x110 lma 0xf6ec
    Start address 0xc044 , load size 14332
    Transfer rate: 12739 bits/sec.
    </PRE
></TD
></TR
></TABLE
><P
>(Note that the sizes may not exactly match the ones you see on your
system.)
    </P
><P
>      Once the loading is done, quit GDB:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    (gdb) quit
    </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1577"
>Activating the GDB stubs</A
></H2
><P
>Connect a terminal emulator to the board again, reset the board, and
type enter within two seconds to get the Boot: prompt.  This is the
same thing you did at the beginning of this procedure.
    </P
><P
>      Commit the GDB stubs module to flash:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	Boot: flashwrite 4018000 C000 8000
    </PRE
></TD
></TR
></TABLE
><P
>Verify that the eCos/"GDB stubs" module is now added in the list of
modules in the board:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	Boot: rommodules
    </PRE
></TD
></TR
></TABLE
><P
>You should see the following output:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	Header   Base     Limit
	04000004 04000000 040034a8 BootStrap       1.00 (14 Aug 1998) 
	04003a74 04003800 04003bc0 Production Test 1.00 (13 Aug 1998) 
	0400e4f4 04004000 0400e60f Angel           1.02 (12 MAY 1998) 
	0401ac00 04018000 0401aed8 eCos            1.2  (26 Feb 1999) GDB stubs
    </PRE
></TD
></TR
></TABLE
><P
>Now make the eCos/"GDB stubs" module be the default monitor:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>	Boot: plugin eCos
    </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1588"
>Running and debugging an application</A
></H2
><P
>Configure eCos from scratch for the ARM AEB-1 platform, and build your
application.  Remember that the AEB-1 board only has 128K of RAM.
    </P
><P
>      Exit from the terminal emulator (you will not need it anymore for
normal operations), and run gdb:
    </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    $ arm-elf-gdb -nw executable
    (gdb) set remotebaud 38400
    (gdb) target remote &#60;YOUR SERIAL PORT&#62;
    (gdb) load
    </PRE
></TD
></TR
></TABLE
><P
>You can now run your program in the usual way under GDB'S control
    </P
><P
>      Notice that the GDB stub runs at 38400 baud.
    </P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1595"
>Building the GDB stubs</A
></H2
><P
>We provide the GDB stubs image in the directory
loaders/arm-aeb/gdb_module.img, but here are instructions on how to
rebuild them if you should ever need to.
    </P
><DIV
CLASS="PROCEDURE"
><OL
TYPE="1"
><LI
><P
>	  Configure a minimal eCos system with all packages except 'infra'
   disabled.  If you are doing manual configuration, you can do so
   with</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>   tcl /work2/ecc/ecc/pkgconf.tcl                                         \
      --target=arm --platform=aeb --startup=stubs                         \
      --disable CYGPKG_KERNEL --disable CYGPKG_UITRON                     \
      --disable CYGPKG_LIBC --disable CYGPKG_LIBM                         \
      --disable CYGPKG_ERROR --disable CYGPKG_IO                          \
      --disable CYGPKG_IO_SERIAL --disable CYGPKG_DEVICES_WALLCLOCK       \
      --disable CYGPKG_DEVICES_WATCHDOG
	</PRE
></TD
></TR
></TABLE
><P
>   and if you are using the Configuration Tool GUI, you can select the
   ARM AEB platform, with GDB stubs startup, and enable the HAL and
   INFRA packages and disable all other packages.
	</P
></LI
><LI
><P
>Edit &#60;hal/hal.h&#62; to enable GDB:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>    #define  CYGDBG_HAL_DEBUG_GDB_INCLUDE_STUBS
    #undef   CYGDBG_HAL_DEBUG_GDB_BREAK_SUPPORT
    #undef   CYGDBG_HAL_DEBUG_GDB_THREAD_SUPPORT
	</PRE
></TD
></TR
></TABLE
><P
>   you can use the following patch:
	</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>--- pkgconf/hal.h~      Wed Mar 10 13:08:58 1999
+++ pkgconf/hal.h       Thu Mar 11 15:53:16 1999
@@ -356,9 +356,9 @@
 
    }}CFG_DATA */
 
-#undef   CYGDBG_HAL_DEBUG_GDB_INCLUDE_STUBS
+#define  CYGDBG_HAL_DEBUG_GDB_INCLUDE_STUBS
 #undef   CYGDBG_HAL_DEBUG_GDB_BREAK_SUPPORT
-#define  CYGDBG_HAL_DEBUG_GDB_THREAD_SUPPORT
+#undef   CYGDBG_HAL_DEBUG_GDB_THREAD_SUPPORT
 
 /*
  * NOTE:
	</PRE
></TD
></TR
></TABLE
></LI
><LI
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>make misc</PRE
></TD
></TR
></TABLE
><P
>The gdb_module.img file will be built in the directory
hal/arm/aeb/current/misc
	</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1611"
>Alternate way of loading the initial stubs</A
></H2
><P
>Using the AEB-1 module tool, install the GDB stubs from the provided
".UU" file.
    </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>This is an annotated 'terminal' session with the AEB-1
      monitor:</P
></BLOCKQUOTE
></DIV
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>ARM Evaluation Board Boot Monitor 0.01 (19 APR 1998)
Press ENTER within 2 seconds to stop autoboot
Boot: help
Module is BootStrap       1.00 (14 Aug 1998)

Help is available on:
  Help          Modules       ROMModules    UnPlug        PlugIn
  Kill          SetEnv        UnSetEnv      PrintEnv      DownLoad
  Go            GoS           Boot          PC            FlashWrite
  FlashLoad     FlashErase

Boot: download c000
Ready to download. Use 'transmit' option on terminal emulator to download file.

 ... at this point, download the ASCII file "loaders/arm-aeb/gdb_module.img.UU".
 The details of this operation differ depending on which terminal emulator is used.
 It may be necessary to enter "^D" (control+D) when the download completes to
 get the monitor to return to command mode.

Loaded file gdb_module.img.raw at address 0000c000, size = 13905

Boot: flashwrite 4018000 c000 4000

  As above, this command actually programs the FLASH.

Boot: rommodules
Header   Base     Limit
04000004 04000000 040034a8 BootStrap       1.00 (14 Aug 1998)
04003a74 04003800 04003bc0 Production Test 1.00 (13 Aug 1998)
0400e4f4 04004000 0400e60f Angel           1.02 (12 MAY 1998)
0401b608 04018000 0401b844 eCos            1.2  (26 Feb 1999) GDB stubs

  This verifies that the eCos GDB stubs are available in FLASH.

Boot: plugin ecos

  This makes the eCos GDB stubs the default "monitor."  When reset the
  AEB-1 will start the GDB stubs, after the initial 2 second escape
  period.
    </PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="arm-hardware-setup.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ecos-tutorial.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1617.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ARM7
PID hardware setup</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="hardware-setup.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>i386/Linux
synthetic target setup</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>