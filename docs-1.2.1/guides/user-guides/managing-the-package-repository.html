<HTML
><HEAD
><TITLE
>Managing the package repository</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.33"><LINK
REL="HOME"
TITLE="eCos Users
Guide"
HREF="user-guides.html"><LINK
REL="UP"
TITLE="Configuration
and the Package Repository"
HREF="configuration-and-the-package-repository.html"><LINK
REL="PREVIOUS"
TITLE="Modifying the memory
layout"
HREF="modifying-memory-layout.html"><LINK
REL="NEXT"
TITLE="Special Topics"
HREF="special-topics.html"></HEAD
><BODY
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
><SPAN
CLASS="TRADEMARK"
>eCos</SPAN
><SUP
><FONT
SIZE="-4"
>TM</FONT
></SUP
> User&#8217;s
Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="modifying-memory-layout.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="special-topics.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="MANAGING-THE-PACKAGE-REPOSITORY"
>Chapter 8. Managing the package repository</A
></H1
><P
>A source distribution of <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> consists
of a number of packages, such as the kernel, the C library, and
the µITRON subsystems. These are individually versioned
in the tree structure of the source code, to support future distribution
on a per-package basis and to support third party packages whose
versioning systems might be different. Future tools will help manage
the building of an application from a selection of different versions
of different packages. </P
><P
>The presence of the version information in the source tree
structure might be a hindrance to the use of a separate source control
system such as <SPAN
CLASS="PRODUCTNAME"
>CVS</SPAN
> or <SPAN
CLASS="PRODUCTNAME"
><SPAN
CLASS="TRADEMARK"
>SourceSafe</SPAN
><SUP
><FONT
SIZE="-4"
>TM</FONT
></SUP
></SPAN
>.
To work in this way, you can rename all the version components to some
common name (such as &#8220;current&#8221;) thus unifying
the structure of source trees from distinct <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> releases.</P
><P
>The <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> build system will treat
any such name as just another version of the package(s), and support
building in exactly the same way. However, performing this rename
invalidates any existing build trees which referred to the versioned
source tree, so do the rename first, before doing any other work,
and do a complete rebuild afterwards. </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>This chapter is only relevant to people interested in modifying <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> sources or
using their own source control on <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> sources
over multiple releases.</P
></BLOCKQUOTE
></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DETAILED-INFORMATION"
>Package
Structure</A
></H1
><P
>The files in an installed <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> source
tree are organized in a natural tree structure, grouping together
files which work together into <I
CLASS="FIRSTTERM"
>Packages</I
>.
For example, the kernel files are all together in: </P
><P
CLASS="LITERALLAYOUT"
><TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/kernel/v1_2/include/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/kernel/v1_2/src/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/kernel/v1_2/tests/</TT
><br>
	</P
><P
>and µITRON compatibility layer files are in: </P
><P
CLASS="LITERALLAYOUT"
><TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/compat/uitron/v1_2/include/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/compat/uitron/v1_2/src/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/compat/uitron/v1_2/tests/</TT
><br>
	</P
><P
>The feature of these names which is of interest here is the
v1_2 near the end. If you start using <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> after
the Version 1.2.1 release, you might see a different name here, e.g.
v1_3 for version 1.3; if you received pre-release Beta
versions you might have seen v0_2 or v0_3 for
versions 0.2 and 0.3. </P
><P
>It may seem odd to place a version number deep in the path,
rather than having something like <TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/v1_2/...everything...</TT
></P
><P
>or leaving it up to you to choose a different install-place
when a new release of the system arrives. </P
><P
>There is a rationale for this organization: as indicated,
the kernel and the µITRON compatibility subsystem are examples
of software packages. For the first few releases of <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
>,
all the Cygnus packages will move along in step, i.e. Release 1.2.1
will feature Version 1.2.1 of every package, and so forth. But in
future, especially when third party packages become available, it
is intended that the package be the unit of software distribution,
so it will be possible to build a system from a selection of packages
with different version numbers, and even differing versioning <I
CLASS="EMPHASIS"
>schemes</I
>. </P
><P
>Cygnus will be developing tools to manage installation and
use of packages in this way. The current underlying <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> build
engine (<B
CLASS="COMMAND"
>pkgconf</B
>) already supports (but is not limited
to) this version scheme: when choosing which packages to enable
in a build, a choice of available versions is offered. </P
><P
>Many users will have their own source code control system,
version control system or equivalent, and will want to use it with <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> sources.
In that case, since a new release of <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> comes
with different pathnames for all the source files, a bit of work
is necessary to import a new release into your source repository. </P
><P
>One way of handling the import is to rename all the version
parts to some common name, for example &#8220;current&#8221;,
and continue to work. &#8220;current&#8221; is suggested because <B
CLASS="COMMAND"
>pkgconf</B
> recognizes
it and places it first in any list of versions. In the future, Cygnus may
provide a tool to help with this, or an option in the install wizard.
Alternatively, in a POSIX shell environment (Linux or Cygwin on
Windows) use the following command: </P
><P
CLASS="LITERALLAYOUT"
><B
CLASS="COMMAND"
>find . -name v1_2 -type d -printf "mv %p %h/current\n" | sh</B
><br>
	</P
><P
>Having carried out such a renaming operation, your source
tree will now look like this: </P
><P
CLASS="LITERALLAYOUT"
><TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/kernel/current/include/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/kernel/current/src/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/kernel/current/tests/</TT
><br>
	...<br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/compat/uitron/current/include/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/compat/uitron/current/src/</TT
><br>
<TT
CLASS="FILENAME"
><TT
CLASS="REPLACEABLE"
><I
>BASE_DIR</I
></TT
>/compat/uitron/current/tests/</TT
><br>
	</P
><P
>which is a suitable format for import into your own source
code control system. When you get a subsequent release of <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
>,
do the same thing and use your own source code control system to
manage the new source base, by importing the new version from </P
><P
CLASS="LITERALLAYOUT"
>	<TT
CLASS="REPLACEABLE"
><I
>NEW_BASE_DIR</I
></TT
>/kernel/current/include/<br>
	</P
><P
>and so on. </P
><P
>The <SPAN
CLASS="PRODUCTNAME"
>eCos</SPAN
> build tool will now offer
only the &#8220;current&#8221; version of each package; select this
for the packages you wish to use. </P
><P
>Making such a change has implications for any build trees
you already have in use. A configured build tree contains information
about the selected packages and their selected versions. Changing
the name of the &#8220;versioning&#8221; folder in the source
tree invalidates this information, and in consequence it also invalidates
any local configuration options you have set up in this build tree.
So if you want to change the version information in the source tree,
do it first, before investing any serious time in configuring and
building your system. When you create a new build tree to deal with the
new source layout, it will contain default settings for all the
configuration options, just like the old build tree did before you
configured it. You will need to redo that configuration work in
the new tree. </P
><P
>Moving source code around also invalidates debugging information
in any programs or libraries built from the old tree; these will
need to be rebuilt. </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="modifying-memory-layout.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="user-guides.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="special-topics.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Modifying the memory
layout</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="configuration-and-the-package-repository.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Special Topics</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>